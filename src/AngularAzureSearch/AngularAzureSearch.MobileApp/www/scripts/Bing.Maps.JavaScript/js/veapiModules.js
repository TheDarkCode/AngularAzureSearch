window.$MapsNamespace=window.$MapsNamespace||"Microsoft",window[$MapsNamespace]=window[$MapsNamespace]||{},window[$MapsNamespace].Maps=window[$MapsNamespace].Maps||{},window[$MapsNamespace].Maps.initVenueMapsCode=function(){var e=window[$MapsNamespace].Maps.Resources,i=window[$MapsNamespace].Maps,c=i.Gimme,d=i.Globals,nt=i.Point,et=i.PixelReference,t=i.Events,k=i.LocationRect,o=i.Location,u=i.MapTypeId,h=i.LabelOverlay,s=i.Color,tt=i.Polygon,ot=i.Infobox,it=i.TileSource,rt=i.TileLayer,ut=i.QuadKey,l=i.InternalNamespaceForDelay,y=l.Network,w=l.Quirks,ft=l.PRF,a=window[$MapsNamespace].Maps.InternalNamespaceForDelay.Debug,n={},r,p,v,f,b;n.VenueMapConstants={_strokeWeightNormal:"2",_strokeWeightHighlighted:"2",_log_FeatureName:"VenueMaps",_log_Action_LaunchVenueMap:"LaunchVenueMap",_log_Action_CloseVenueMap:"CloseVenueMap",_log_Action_SetFloor:"SetFloor",_log_Action_StoreClick:"StoreClick",_log_Action_FootprintClick:"FootprintClick",_log_Info_NullOrEmptyMetadata:"NullOrEmptyMetadata",_log_Info_InvalidMetadata:"InvalidMetadata",_log_Key_MapId:"mapId",_log_Key_MapType:"mapType",_log_Key_MapView:"mapView",_log_Key_Floor:"floor",_log_Key_YpId:"ypId",_log_Key_BusinessName:"businessName",_log_Key_TargetLod:"targetLod",viewHidden:"hidden",viewHalfImmersed:"halfImmersed",viewFullyImmersed:"fullyImmersed"},n.bind=function(n,t){return function(){return t.apply(n,arguments)}},n._callAsync=function(){var i=arguments[0],t,n,r;if(i){for(t=[],n=1,r=arguments.length;n<r;n++)t[n-1]=arguments[n];window.setTimeout(function(){i.apply(window,t)},1)}},n.addDOMElement=function(n,t,i,r,u){var f=document.createElement(n);return t&&(f.id=t),u&&f.appendChild(document.createTextNode(u)),i&&(f.className=i),r&&r.appendChild(f),f},n.measure=function(n){var t,i;if(!n)return{width:0,height:0};if(t={width:n.offsetWidth,height:n.offsetHeight},!t.width&&!t.height){var r=n.style.visibility,u=n.style.position,f=n.style.top,e=n.style.left;c(n).set_style("visibility","hidden").set_style("position","absolute").set_style("top","-1000px").set_style("left","-1000px"),i=!1,n.offsetParent||(document.body.appendChild(n),i=!0),t={width:n.offsetWidth,height:n.offsetHeight},i&&document.body.removeChild(n),c(n).set_style("visibility",r).set_style("position",u).set_style("top",f).set_style("left",e)}return t},n.is_in_DOM=function(n){for(var t=n;t!==null&&t!==document.body;)t=t.parentNode;return t===document.body},n.guid=function(){function n(){return((1+Math.random())*65536|0).toString(16).substr(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},n.generateLinkToLSVPage=function(n,t){return d.localDetailsUrl.replace("{0}",n).replace("{1}",t).replace("{2}","VENUEM")},n.validateMetadata=function(n){var r,u,e,i,f,t;if(n&&n.Floors&&n.DefaultFloor&&n.Footprint&&n.MapId&&n.Floors[n.DefaultFloor]){r=n.Floors;for(u in r)if(e={key:u,value:r[u]},i=e.value,i&&i.Name&&i.Transform&&i.LodRange&&n.Floors[i.Name]){if(i.Primitives)for(t=0;t<i.Primitives.length;t++)if((f=i.Primitives[t],!i.Primitives[t].X||!i.Primitives[t].Y||i.Primitives[t].X.length<3||i.Primitives[t].Y.length<3||i.Primitives[t].X.length!==i.Primitives[t].Y.length)||i.Primitives[t].YpId&&!i.Primitives[t].Name||f.Id&&f.Id>99999)return!1}else return!1;if(n.Footprint.Polygons&&n.Footprint.Polygons.length){for(t=0;t<n.Footprint.Polygons.length;t++)if(!n.Footprint.Polygons[t].X||!n.Footprint.Polygons[t].Y||n.Footprint.Polygons[t].X.length<3||n.Footprint.Polygons[t].Y.length<3||n.Footprint.Polygons[t].X.length!==n.Footprint.Polygons[t].Y.length)return!1}else return!1;return!0}return!1},n.convertMetadataV2ToV1=function(n){function ut(n){var t,r,u,i;if(arguments.length<2||typeof n!="string")return null;for(t=null,r=1,u=arguments.length;r<u;r++)i=arguments[r],typeof i=="string"&&i.replace(/\s/g,"").length>0&&(t=t?t+n+i:i);return t}function o(n){for(var t in n)if(n.hasOwnProperty(t))return n[t];return null}function d(n){var t=n.longitudes,i=n.latitudes,r=t.length,u,f;n.closed&&r>1&&(u=t[0],f=i[0],(u!==t[r-1]||f!==i[r-1])&&(t.push(u),i.push(f)))}var t,f,a,s,g,v,nt,y,e,tt,u,w,c,b,i,r;if(!n)return null;for(t={},f=n.address,f?(a=f.formattedAddress,t.Address=typeof a=="string"?a:ut(", ",f.addressLine,f.locality,f.adminDistrict,f.countryRegionCode)):t.Address=null,s=n.bbox,t.MinLongitude=s[1],t.MinLatitude=s[0],t.MaxLongitude=s[3],t.MaxLatitude=s[2],g=n.defaultFloor,v2DefaultFloorObject=n.floors[g||1],v=v2DefaultFloorObject.type,t.DefaultFloor=typeof v!="undefined"?v:o(v2DefaultFloorObject.name),nt=t.Floors={},y=n.floors,e=1,tt=y.length;e<tt;e++){var l=y[e],it=l.type,p=o(l.name);u=typeof it!="undefined"?{Name:it,DisplayName:p}:{Name:p,DisplayName:p},w=l.altTypes,typeof w!="undefined"&&(u.AltNames=w),u.Transform=[1,0,0,0,1,0,0,0,1],u.LodRange=[13,20],nt[u.Name]=u;for(var ft=u.Primitives=[],h=l.entities,rt=h.length;rt--;)i=h[rt],typeof i.name!="undefined"&&(r=i.geometry[0],c=typeof i.categoryOverride!="undefined"?i.categoryOverride:i.categoryName,typeof c=="object"&&(c=o(c)),d(r),ft.push({X:r.longitudes,Y:r.latitudes,YpId:i.ypid,Name:o(i.name),CatId:i.categoryId,CatName:c,Id:i.id}))}t.MapId=n.id,b=n.location,t.CenterLatitude=b[0],t.CenterLongitude=b[1],t.Name=o(n.name),t.PhoneNumber=n.phoneNumber,t.MapType=n.type,t.YpId=n.ypid,t.FloorHeader="Level";for(var k=t.Footprint={},et=k.Polygons=[],h=n.floors[0].entities,e=h.length;e--;)i=h[e],i.type==="Footprint"&&(r=i.geometry[0],d(r),et.push({X:r.longitudes,Y:r.latitudes}));return k.Transform=[1,0,0,0,1,0,0,0,1],k.LodRange=[13,20],t},n.populateViewForStyle=function(t,i){switch(i){case n.VEMapStyle.road:default:t.mapTypeId=u.road;break;case n.VEMapStyle.auto:t.mapTypeId=u.auto;break;case n.VEMapStyle.aerial:t.mapTypeId=u.aerial,t.labelOverlay=h.hidden;break;case n.VEMapStyle.hybrid:t.mapTypeId=u.aerial,t.labelOverlay=h.visible;break;case n.VEMapStyle.birdsEye:t.mapTypeId=u.birdseye,t.labelOverlay=h.hidden;break;case n.VEMapStyle.birdsEyeHybrid:t.mapTypeId=u.birdseye,t.labelOverlay=h.visible;break;case n.VEMapStyle.collinsBart:t.mapTypeId=u.collinsBart;break;case n.VEMapStyle.ordnanceSurvey:t.mapTypeId=u.ordnanceSurvey}},n.getMapStyle=function(t,i){var r="\x00";switch(t){case u.road:default:r=n.VEMapStyle.road;break;case u.auto:r=n.VEMapStyle.auto;break;case u.aerial:r=i===h.visible?n.VEMapStyle.hybrid:n.VEMapStyle.aerial;break;case u.birdseye:r=i===h.visible?n.VEMapStyle.birdsEyeHybrid:n.VEMapStyle.birdsEye;break;case u.collinsBart:r=n.VEMapStyle.collinsBart;break;case u.ordnanceSurvey:r=n.VEMapStyle.ordnanceSurvey}return r},n.optimalZoom=function(n,t,i){var h=t.getNorth(),c=t.getSouth(),l=t.getEast(),a=t.getWest(),e=n.getRootElement().clientWidth,s=n.getRootElement().clientHeight,r=n.getTargetZoom(),u=n.tryLocationToPixel(new o(h,a)),f=n.tryLocationToPixel(new o(c,l));if(u&&f&&e&&s&&r){var v=Math.abs(u.y-f.y),y=Math.abs(f.x-u.x),p=r+Math.log(i*s/v)*Math.LOG2E,w=r+Math.log(i*e/y)*Math.LOG2E;return Math.round(Math.min(p,w))}return 17},n.Directory={},n.BreadcrumbEventNames={locked:"locked",unlocked:"unlocked",breadcrumbsChanged:"breadcrumbschanged",pathNodeClicked:"pathnodeclicked",closed:"closed",groupSelectedItemChanged:"groupselecteditemchanged"},n.BreadcrumbManager=function(n,t,i,r,u,f,e){this._map=n,this._bounds=f,this._buildingName=t,this._selectedFloor=i[0],this._zoom=u,this._center=r,this._halfImmersedRange=e,this._floors=i,this._isMultiFloor=i.length>1,this._isDisposed=!1,this._added=!1,this._breadcrumb=null,this._mapStyleChangedHandler=null,this._viewChangedHandler=null,this._closeButtonHandler=null,this._selectionChangedHandler=null,this._componentAddedHandler=null,this._nodeChangedHandler=null,this._showWhenLoaded=!1,this._isLocked=!1,this._init()},n.BreadcrumbManager.prototype={show:function(){this._breadcrumb?(this._updateBreadcrumb(),this._captureMapEvents()):this._showWhenLoaded=!0},hide:function(){this._removeVenueFromBreadcrumb(),this._uncaptureMapEvents()},_raiseEvent:function(n,i){t.invoke(this,n,i)},set__floor:function(n){return this._selectedFloor!==n&&(this._selectedFloor=n,this._breadcrumb&&this._added&&this._isMultiFloor&&this._breadcrumb.selectGroupItem("floor",this._selectedFloor)),n},_dispose:function(){this._uncaptureMapEvents(),this._removeVenueFromBreadcrumb();var n=this._componentAddedHandler;n&&(t.removeHandler(n),this._componentAddedHandler=null),this._breadcrumb=null,this._isDisposed=!0},_captureMapEvents:function(){this._viewChangedHandler||(this._viewChangedHandler=t.addHandler(this._map.getMap(),"viewchangeend",n.bind(this,this._onViewChanged))),this._mapStyleChangedHandler||(this._mapStyleChangedHandler=t.addHandler(this._map,"stylechanged",n.bind(this,this._onStyleChanged)))},_uncaptureMapEvents:function(){t.removeHandler(this._viewChangedHandler),t.removeHandler(this._mapStyleChangedHandler),this._viewChangedHandler=null,this._mapStyleChangedHandler=null},_init:function(){var i,r,u,f;this._isDisposed||(i=this._map.get_Breadcrumb(),i?(r=this._componentAddedHandler,r&&(t.removeHandler(r),this._componentAddedHandler=null),this._breadcrumb=i,this._showWhenLoaded&&(this.show(),delete this._showWhenLoaded)):this._componentAddedHandler||(u=n.bind,f=this._map,this._componentAddedHandler=t.addHandler(f.getMap(),"componentadded",u(this,this._init))))},_attachEventHandlers:function(){this._breadcrumb&&(this._closeButtonHandler=t.addHandler(this._breadcrumb,n.BreadcrumbEventNames.closed,n.bind(this,this._onCloseButtonClicked)),this._selectionChangedHandler=t.addHandler(this._breadcrumb,n.BreadcrumbEventNames.groupSelectedItemChanged,n.bind(this,this._onSelectionChanged)),this._nodeChangedHandler=t.addHandler(this._breadcrumb,n.BreadcrumbEventNames.pathNodeClicked,n.bind(this,this._onBreadcrumbNodeChanged)))},_removeEventHandlers:function(){this._breadcrumb&&(t.removeHandler(this._closeButtonHandler),t.removeHandler(this._selectionChangedHandler),t.removeHandler(this._nodeChangedHandler))},_onBreadcrumbNodeChanged:function(n){var t=n;t.pathNodeLevel==="building"?this._map.SetView({center:this._center,zoom:this._zoom},!0):t.pathNodeLevel==="floor"&&(this._breadcrumb.highlightCrumb(null),this._updateHighlight())},_onCloseButtonClicked:function(n){this._breadcrumb&&this._removeVenueFromBreadcrumb(),this._raiseEvent("closed",n)},_onSelectionChanged:function(n){if(this._breadcrumb){this._breadcrumb.highlightCrumb(null),this._updateHighlight();var t=n;t.groupName==="floor"&&t.newItem!==this._selectedFloor&&(this._selectedFloor=t.newItem,this._raiseEvent("floorchanged",t))}},_onViewChanged:function(){this._updateBreadcrumb(),this._updateHighlight()},_onStyleChanged:function(){this._updateBreadcrumb()},_updateHighlight:function(){var n=this._map.GetTargetZoomLevel();n===this._zoom?this._breadcrumb.highlightCrumb("building"):n>this._zoom&&this._breadcrumb.highlightCrumb(null)},_updateBreadcrumb:function(){this._breadcrumb&&(this._map.IsMercator()?this._updateVisibility():this._removeVenueFromBreadcrumb())},_updateVisibility:function(){if(this._breadcrumb){var n=this._map.GetTargetZoomLevel();n<this._halfImmersedRange.get_from()||!this._bounds.intersects(this._map.GetBounds())?this._removeVenueFromBreadcrumb():n<=this._halfImmersedRange.get_to()?(this._isLocked||(this._breadcrumb.lockToLocation(this._center),this._isLocked=!0),this._addVenueToBreadcrumb(),this._breadcrumb.setVisibility("building",!0),this._isMultiFloor&&this._breadcrumb.setVisibility("floor",!1),this._breadcrumb.hideCloseButton()):(this._isLocked||(this._breadcrumb.lockToLocation(this._center),this._isLocked=!0),this._addVenueToBreadcrumb(),this._breadcrumb.setVisibility("building",!0),this._isMultiFloor&&this._breadcrumb.setVisibility("floor",!0),this._breadcrumb.showCloseButton())}},_addVenueToBreadcrumb:function(){this._breadcrumb&&!this._added&&(this._breadcrumb.addCrumb("element","building",this._buildingName,null,!0),this._isMultiFloor&&this._breadcrumb.addCrumb("group","floor",this._selectedFloor,this._floors,!0),this._breadcrumb.showCloseButton(),this._attachEventHandlers(),this._added=!0)},_removeVenueFromBreadcrumb:function(){this._breadcrumb&&this._added&&(this._breadcrumb.removeCrumb("building"),this._isMultiFloor&&this._breadcrumb.removeCrumb("floor"),this._breadcrumb.hideCloseButton(),this._breadcrumb.unlockFromLocation(),this._removeEventHandlers(),this._isLocked=!1),this._added=!1}},n.DoubleRange=function(n,t){this._fromValue=n,this._toValue=t},n.DoubleRange.prototype={_fromValue:0,_toValue:0,get_to:function(){return this._toValue},get_from:function(){return this._fromValue},get_range:function(){return this.get_to()-this.get_from()}},n.LocationPolygon=function(n,t,i,r){for(var v=n.length,y=new Array(v),f=i[3]*n[0]+i[4]*t[0]+i[5],c=f,e=i[0]*n[0]+i[1]*t[0]+i[2],l=e,s,h,a,p,u=0;u<v;u++)s=i[0]*n[u]+i[1]*t[u]+i[2],h=i[3]*n[u]+i[4]*t[u]+i[5],y[u]=new o(h,s),f<h&&(f=h),c>h&&(c=h),e>s&&(e=s),l<s&&(l=s);a=new o((f+c)/2,(e+l)/2),p=new k(a,l-e,f-c),this.latLongs=y,this.center=a,this.boundingBox=p,this.optimalZoom=function(n){var s=r.getRootElement().clientWidth,h=r.getRootElement().clientHeight,t=r.getTargetZoom(),i=r.tryLocationToPixel(new o(f,e)),u=r.tryLocationToPixel(new o(c,l));if(i&&u&&s&&h&&t){var a=Math.abs(i.y-u.y),v=Math.abs(u.x-i.x),y=t+Math.log(n*h/a)*Math.LOG2E,p=t+Math.log(n*s/v)*Math.LOG2E;return Math.round(Math.min(y,p))}return 18}},n.MapController=function(n){this._map=n,this._shapes={},this._layers={},this._mapEntities={},this._registerEvents()},n.MapController.prototype={_map:null,_layers:null,_shapes:null,_zoomAwareLines:null,_isDisposed:!1,_offscreenPoint:new nt(-1e4,-1e4),getMap:function(){return this._map},IsMercator:function(){return this._map.isMercator()},GetBounds:function(){return this._map.getBounds()},get_Breadcrumb:function(){return this._map.getComponent("breadcrumb")},GetMapStyle:function(){var t=this._map.getMapTypeId(),i=this._map.getOptions(),r=i.labelOverlay;return n.getMapStyle(t,r)},SetMapStyle:function(t){if(t!==this.GetMapStyle()){var i={};n.populateViewForStyle(i,t),this._map.setView(i)}},SetView:function(n){this._map.setView(n)},GetMapWidth:function(){return this._map.getWidth()},GetMapHeight:function(){return this._map.getHeight()},GetTargetZoomLevel:function(){return this._map.getTargetZoom()},AddLayer:function(n,t){this._layers[n]||(t.layerId=n,this._map.entities.push(t),this._layers[n]=t)},RemoveLayer:function(n){this._layers[n]&&(this._map.entities.remove(this._layers[n]),delete this._layers[n])},GetShape:function(n){return this._shapes[n]},AddShapeById:function(n,t){this._addShape(n,t),this._shapes[n]=t},RemoveShapeById:function(n){if(n){var t=this.GetShape(n);t&&t.eroController&&t.eroController.detachFromShape(),this._removeShape(n),delete this._shapes[n]}},_mapEntities:null,_addShape:function(n,t){this._removeShape(n);var i=this._map.entities;i.push(t),this._mapEntities[n]=t},_removeShape:function(n){var i=this._mapEntities[n],t;i&&(t=i.parentCollection,t||(t=this._map.entities),t.remove(i),delete this._mapEntities[n])},get_MapContainer:function(){return this._map?this._map.getRootElement():null},AddPolygon:function(n,t,i,r,u){var f=this._addPolygon2(n,t,i,r,u);return this._shapes[n]=f,f},_addPolygon2:function(n,t,i,r,u){this._removeShape(n);var f=new tt(t,{strokeThickness:i,strokeColor:r,fillColor:u}),e=this._map.entities;return e.push(f),this._mapEntities[n]=f,f},_viewChangeEndHandler:null,_imageryChangedHandler:null,_registerEvents:function(){this._viewChangeEndHandler||(this._viewChangeEndHandler=t.addHandler(this._map,"targetviewchanged",n.bind(this,this._map_ViewChanged))),this._imageryChangedHandler||(this._imageryChangedHandler=t.addHandler(this._map,"imagerychanged",n.bind(this,this._map_ImageryChanged)))},dispose:function(){this._isDisposed||(this._unregisterEvents(),this._isDisposed=!0)},_unregisterEvents:function(){this._viewChangeEndHandler&&(t.removeHandler(this._viewChangeEndHandler),this._viewChangeEndHandler=null),this._imageryChangedHandler&&(t.removeHandler(this._imageryChangedHandler),this._imageryChangedHandler=null)},_raiseEvent:function(n,i){t.invoke(this,n,i)},_map_ViewChanged:function(){this._raiseEvent("viewchanged",new n.MapControllerEventArgs)},_map_ImageryChanged:function(){this._raiseEvent("stylechanged",new n.MapControllerEventArgs)}},n.MapControllerEventArgs=function(n){this._keyCode=n},n.MapControllerEventArgs.prototype={_keyCode:0,get_key:function(){return this._keyCode}},n.MultiscaleTileSource=function(n,t){this._tileWidth=n,this._tileHeight=t},n.MultiscaleTileSource.prototype={_tileWidth:0,_tileHeight:0,get__tileWidth:function(){return this._tileWidth},get__tileHeight:function(){return this._tileHeight},isSame:function(n){return this.get__tileWidth()===n.get__tileWidth()&&this.get__tileHeight()===n.get__tileHeight()&&this.get_uriFormat()===n.get_uriFormat()&&this.get_numberOfTileServers()===n.get_numberOfTileServers()},createTileSource:function(){return new it({width:this.get__tileWidth(),height:this.get__tileHeight(),uriFormat:this.get_uriFormat().replace("{{","{").replace("}}","}"),uriConstructor:n.bind(this,this.getTileUri)})}},n.MercatorModeTileSource=function(t){n.MultiscaleTileSource.apply(this,[n.MercatorModeTileSource._defaultTileSize$1,n.MercatorModeTileSource._defaultTileSize$1]),this._format$1=t,this._numberOfTileServers$1=i.Globals.venueMapsNumberOfMapTileServers||0;var r=i.Globals.venueMapsTileServerSubdomainsX||"",u=i.Globals.venueMapsTileServerSubdomainsY||"";this._subdomains$1=[r.split(","),u.split(",")],n.MercatorModeTileSource._xLength$1=this._subdomains$1.length,n.MercatorModeTileSource._yLength$1=this._subdomains$1[0].length},n.MercatorModeTileSource.prototype=new n.MultiscaleTileSource(0,0),r=n.MercatorModeTileSource.prototype,r._format$1="",r._numberOfTileServers$1=0,r._hasZoomRange$1=!1,r._minZoom$1=0,r._maxZoom$1=0,r.get_tileServerCount=function(){return this._numberOfTileServers$1},r._subdomains$1=null,r.get_hasZoomRange=function(){return this._hasZoomRange$1},r.set_hasZoomRange=function(n){return this._hasZoomRange$1=n,n},r.get_minZoom=function(){return this._minZoom$1},r.set_minZoom=function(n){return this._minZoom$1=n,n},r.get_maxZoom=function(){return this._maxZoom$1},r.set_maxZoom=function(n){return this._maxZoom$1=n,n},r.getTileUri=function(n){return this.get_hasZoomRange()&&(n.levelOfDetail<this.get_minZoom()||n.levelOfDetail>this.get_maxZoom())?null:this.getTileUriFromFormat(n,this.get_uriFormat())},r.getTileUriFromFormat=function(n,t){var u=null,r=ut.fromTileId(n),i;return this.get_numberOfTileServers()===4?(i=r.charAt(r.length-1),u=t.replace("{{quadkey}}",r).replace("{{subdomain}}",(i%this.get_tileServerCount()).toString())):(i=this.tileCoordinatesToSubdomainNumber(n.x,n.y),u=t.replace("{{quadkey}}",r).replace("{{subdomain}}",i)),u},r.tileCoordinatesToSubdomainNumber=function(t,i){return this._subdomains$1[t%n.MercatorModeTileSource._xLength$1][i%n.MercatorModeTileSource._yLength$1]},r.get_uriFormat=function(){return this._format$1},r.set_uriFormat=function(n){return this._format$1=n,n},r.get_numberOfTileServers=function(){return this._numberOfTileServers$1},r.set_numberOfTileServers=function(n){return this._numberOfTileServers$1=n,n},p=n.MercatorModeTileSource,p._defaultTileSize$1=256,p._xLength$1=0,p._yLength$1=0,n.MapCruncherTileSource=function(t,i,r){n.MercatorModeTileSource.apply(this,[t]),this._bounds$2=i,this._lodRange$2=r,this.set_hasZoomRange(!1)},n.MapCruncherTileSource.prototype=new n.MercatorModeTileSource(""),v=n.MapCruncherTileSource.prototype,v._bounds$2=null,v._lodRange$2=null,v.getTileUri=function(t){var i="";return this._tileIsInBounds$2(t.x,t.y,t.levelOfDetail)&&(i=n.MercatorModeTileSource.prototype.getTileUri.apply(this,[t])),i},v._tileIsInBounds$2=function(t,i,r){if(!this._bounds$2)return!0;if(this._lodRange$2&&!(this._lodRange$2.get_from()<=r&&this._lodRange$2.get_to()>=r))return!1;var u=n.TileSystem._tileXYToPixelXY(t,i),f={x:u.x+255,y:u.y+255},e=n.TileSystem.pixelXYToLatLong(u.x,u.y,r),o=n.TileSystem.pixelXYToLatLong(f.x,f.y,r),s=k.fromCorners(e,o);return s.intersects(this._bounds$2)},n.MetadataRequest=function(n){this._options=n},n.MetadataRequest.prototype={options:function(){return this._options},metadata:function(){return this._data},timedOut:function(){return this._timeout},execute:function(){var t=this._options.metadataUriFormat.replace("{0}",this._options.venueMapId);w.useXHR||(t+="&jsonp=microsoftMapsNetworkCallback&jsonso={jsono}"),y.getObjectAsync(t,n.bind(this,this._onWebRequestCompleted),null,this._options.timeout)},_onWebRequestCompleted:function(n,t){if(this._timeout=!t.success,t.success&&n&&typeof n.errorDetails=="undefined")try{this._data=n}catch(i){}else this._data=null;this._options.callback&&this._options.callback(this)}},n.TileSystem=function(){},f=n.TileSystem,f._clip=function(n,t,i){return Math.min(Math.max(n,t),i)},f._mapSize=function(n){return 256<<n},f.pixelXYToLatLong=function(t,i,r){var u=n.TileSystem._mapSize(r),f=n.TileSystem._clip(t,0,u-1)/u-.5,e=.5-n.TileSystem._clip(i,0,u-1)/u;return new o(90-360*Math.atan(Math.exp(-e*2*Math.PI))/Math.PI,360*f)},f._tileXYToPixelXY=function(n,t){return{x:n*256,y:t*256}},f._earthRadius=6378137,f._minLatitude=-85.05112878,f._maxLatitude=85.05112878,f._minLongitude=-180,f._maxLongitude=180,n.ToolTipHelper=function(t){var r=t,u=0,i=document.createElement("div");i.style.cssText="position:absolute;display:block;visibility:hidden;border:solid 1px black;padding:4px;background-color:#FFFFE0;z-index:20;white-space:nowrap;font-family:sans-serif",r.get_MapContainer().appendChild(i);var f=20,e=function(n){var i=r.GetMapWidth(),t=n+f;return t<0&&(t=0),t+u>i&&(t-=t+u-i),t},o=function(n){var i=r.GetMapHeight(),t=n+f;return t<0?t=0:t+40>i&&(t-=t+40-i),t};this.turnOff=function(){i.style.visibility="hidden"},this.turnOn=function(){i.innerHTML&&(i.style.visibility="visible")},this.setPosition=function(n,t){i.style.top=o(n)+"px",i.style.left=e(t)+"px"},this.updateContent=function(t){t?(i.style.zIndex=1e4,i.innerHTML=t,u=n.measure(i).width+10):i.innerHTML=""}},n.VEMapStyle={auto:"u",road:"r",aerial:"a",hybrid:"h",birdsEye:"o",birdsEyeHybrid:"b",collinsBart:"c",ordnanceSurvey:"s"},n.VenueMap=function(r){function li(){ot||(ot=t.addHandler(h,"viewchanged",wi)),st||(st=t.addHandler(h,"stylechanged",gi))}function ai(){t.removeHandler(ot),t.removeHandler(st),ot=null,st=null}function vi(){v&&(v.hide(),t.removeHandler(kt),t.removeHandler(dt),v._dispose(),v=null)}function yi(){var r,i,f;if(!v){for(r=[],i=0;i<ut.length;i++)f=ut[i],r.push(f.displayName);v=new n.BreadcrumbManager(h,u.name,r,u.bestMapView.center,u.bestMapView.zoom,rt,yt),s&&v.set__floor(s.displayName),kt=t.addHandler(v,"floorchanged",nr),dt=t.addHandler(v,"closed",or),v.show()}}function pi(){if(!gt){u.popupHelper.dispose(),u.minipopupHelper.hide();var n=u.id;l=null,s=null,ui(),a&&(a.dispose(),a=null),p&&(t.removeHandler(hi),p.dispose(),p=null),h&&(h.dispose(),h=null),u.directory&&(u.directory.removeFromDOM(),u.directory=null),b&&wt(null),gt=!0}}function wt(n){var i=k.activeVenueMap;i!==n&&(k.activeVenueMap=n,i&&i.detachFromBreadcrumb(),n&&n.attachToBreadcrumb(),t.invoke(y,"activevenuemapchanged",{oldVenueMap:i,newVenueMap:n}))}function wi(){tt()}function bi(n){if(l&&l[n]){var t=l[n];return t.getEntity()}return null}function ki(n){if(l&&l[n]){var t=l[n];t.highlight()}}function di(n){if(l&&l[n]){var t=l[n];t.unhighlight()}}function gi(){tt()}function nr(n){var i=n,t=i.newItem;t!==s.displayName&&(ri(rr(t).name),tt()),u.unselect()}function tr(){var n=h.GetMapStyle(),t;n!=="r"&&n!=="a"&&n!=="h"&&(t="r",n==="o"?t="a":n==="b"&&(t="h"),h.SetMapStyle(t))}function ti(n){ri(n),tt(),s&&v&&v.set__floor(s.displayName)}function ir(){var n=null;return s&&(n=s.name),n}function rr(n){for(var r=n.toLowerCase(),i,t=0;t<u.floors.length;t++)if(i=u.floors[t],i.displayName.toLowerCase()===r)return i;throw Error.argument("floor","the given floor "+at+" does not exist");}function ur(n){for(var r=n.toLowerCase(),i,t=0;t<u.floors.length;t++)if(i=u.floors[t],ii(i,r))return i;throw Error.argument("floor","the given floor "+n+" does not exist");}function ii(n,t){var i,r;if(t=t.toLowerCase(),n.name.toLowerCase()===t)return!0;if(i=n.altNames,typeof i!="undefined")for(r=i.length;r--;)if(i[r].toLowerCase()===t)return!0;return!1}function ri(r){var b,k,v,y,o,p,e;if(!r)throw Error.argumentNull("floor");if(!s||!ii(s,r)){if(b=s&&s.name,s=ur(r),u.popupHelper.hidePopup(),ui(),a&&a.dispose(),k=it.replace("{0}",u.id).replace("{1}",s.name),f.MaxLatitude){var d=f.MaxLatitude,g=f.MinLatitude,tt=f.MinLongitude,ut=f.MaxLongitude;v=i.LocationRect.fromEdges(d,tt,g,ut)}else v=rt;if(a=new n.VenueMapTileLayer("VenueMapTileLayer",h,k,v,new n.DoubleRange(s.zoomRange[0],s.zoomRange[1])),y=[],w.isShapeEventsSupported())for(o=0;o<s.primitives.length;o++)p=s.primitives[o],p.name&&(e=l[p.id],nt.push(t.addHandler(e,"click",hr)),nt.push(t.addHandler(e,"mouseover",cr)),nt.push(t.addHandler(e,"mouseout",lr)),y.push(e));c=y,t.invoke(u,"floorchanged",{oldFloor:b,newFloor:r})}}function fr(){b||(b=!0,tr(),s||ti(u.defaultFloor),tt(),li()),wt(u)}function er(){b&&(b=!1,u.popupHelper.hidePopup(),tt(),ai(),wt(null))}function or(){t.invoke(u,"close",null),u.dispose()}function sr(n){h.SetView(u.bestMapView,!0),t.invoke(u,"footprintclick",n)}function hr(n){t.hasHandler(u,"click")?t.invoke(u,"click",n):u.handleMouseClick(n)}function cr(n){t.hasHandler(u,"mouseover")?t.invoke(u,"mouseover",n):u.handleMouseOver(n)}function lr(n){t.hasHandler(u,"mouseout")?t.invoke(u,"mouseout",n):u.handleMouseOut(n)}function ar(){return ft}function tt(){var f=h.GetTargetZoomLevel(),r,i,e;if(f<ci.zoom||!h.IsMercator()||!b){if(a&&a.hide(),p&&p.hide(),c)for(i=0;i<c.length;i++)c[i].hide();u.popupHelper.hidePopup(),u.minipopupHelper.hide(),r=n.VenueMapConstants.viewHidden}else if(f<lt.zoom){if(a&&a.hide(),p&&p.show(),c)for(i=0;i<c.length;i++)c[i].hide();u.popupHelper.hidePopup(),u.minipopupHelper.hide(),r=n.VenueMapConstants.viewHalfImmersed}else{if(a&&a.show(),p&&p.hide(),c)for(i=0;i<c.length;i++)c[i].show();r=n.VenueMapConstants.viewFullyImmersed}r!==ft&&(e=ft,ft=r,t.invoke(u,"viewchanged",{newView:r,oldView:e}))}function ui(){for(var n=0;n<nt.length;n++)t.removeHandler(nt[n]);if(nt=[],c)for(n=0;n<c.length;n++)c[n].hide();c=null}var u=this,y=r.map,b=!1,k=y.getComponent("venueMaps"),f,ct,ut,at,ni;k||(k={activeVenueMap:null},y.addComponent("venueMaps",k)),f=r.metadata,u._metadata=r.rawMetadata;var vt=0,fi=n.guid(),d=null,h=new n.MapController(y),l={},ft=n.VenueMapConstants.viewHidden,et=0,it=f.TileUriFormat,bt=function(t,i,r,u){var f=new n.LocationPolygon(t,i,r,y);u.center=f.center,u.bounds=f.boundingBox,u.optimalZoom=f.optimalZoom,u.locations=f.latLongs},ei=function(n,t){var r={},u=n.Polygons,i,t;for(r.polygons=[],i=0;i<u.length;i++)t={},bt(u[i].X,u[i].Y,n.Transform,t),r.polygons[i]=t;return r.zoomRange=n.LodRange,r},oi=function(n,t){var i={};return n.Id&&n.Id>0?i.id=n.Id+et*1e5:(i.id=vt.toString(),vt--),bt(n.X,n.Y,t,i),i.businessId=n.YpId,i.name=n.Name,n.CatId?(i.categoryId=n.CatId,i.categoryName=n.CatName):(i.categoryId=fi,i.categoryName=e.getString("L_VenueMaps_Other_Text")),i.description=n.Description,i},si=function(t){var r=t,i={},o,s,f,u,e;if(i.name=r.Name,i.displayName=r.DisplayName,i.altNames=r.AltNames,i.zoomRange=r.LodRange,i.primitives=[],r.Primitives)for(o=r.Primitives,s=r.Transform,f=0;f<o.length;f++)u=oi(o[f],s),u.floor=i,e=new n.VenueMapPolygon(u,h),l[u.id]=e,u.highlight=e.highlight,u.unhighlight=e.unhighlight,i.primitives[f]=u;return i};it||(it=r.tileUriFormat,it||(it="http://embedmap.blob.core.windows.net/{0}/{1}/{{quadkey}}.png"));var ot=null,st=null,kt=null,dt=null,rt=null,a=null,c=null,s=null,v=null,gt=!1,ht=ei(f.Footprint),yt=new n.DoubleRange(13,15),nt=[],pt=[];for(ct=0;ct<ht.polygons.length;ct++)pt=pt.concat(ht.polygons[ct].locations);var rt=i.LocationRect.fromLocations(pt),p=new n.VenueMapFootprint(h,ht,e.getString("L_VenueMaps_ToolTip_Text").replace("{0}",f.Name)),hi=t.addHandler(p,"click",sr),lt={center:rt.center,zoom:yt.get_to()+1},ci={center:lt.center,zoom:yt.get_from()};this.baseMap=y,this.supportedProjections=["r","a","h"],this.popupHelper=new n.PopupHelper(this),this.minipopupHelper=new n.MiniPopupHelper(this),this.directory=new n.Directory(this),this.name=f.Name,this.address=f.Address,this.phoneNumber=f.PhoneNumber,this.id=f.MapId,this.defaultFloor=f.DefaultFloor,this.type=f.MapType,this.floorHeader=f.FloorHeader,this.businessId=f.YpId,this.center=new o(f.CenterLatitude,f.CenterLongitude),this.footprint=ht,this.socialIds=f.SocialIds,ut=[];for(at in f.Floors)f.Floors.hasOwnProperty(at)&&(ut[et]=si(f.Floors[at]),++et);delete et,delete vt,this.floors=ut,ni=n.optimalZoom(y,rt,.8),this.bestMapView={center:lt.center,zoom:Math.max(ni,17)},this.minimumZoomForTileLayer=lt.zoom,this.setBestMapView=function(n,t,i,r){t||(t=.1);var u=n.optimalZoom(t);i&&(u=Math.max(u,i)),r&&(u=Math.min(u,r)),y.setView({center:n.center,zoom:u,animate:!0})},this.select=function(n){u.unselect(),n&&u.highlight(n.id),d=n},this.unselect=function(){d&&u.unhighlight(d.id),d=null},this.handleMouseOver=function(n){u.popupHelper.fetchPopupData(n),n!==d&&u.minipopupHelper.show(n),u.highlight(n.id);var t=document.getElementById(n.id);t&&g(t).add_class("dtrHighlighted")},this.handleMouseOut=function(n){n!==d&&u.unhighlight(n.id);var t=document.getElementById(n.id);t&&g(t).remove_class("dtrHighlighted"),u.minipopupHelper.hide()},this.handleMouseClick=function(n){u.select(n),u.popupHelper.showPopup(n),u.minipopupHelper.hide(),u.directory.select(n);var t=n.optimalZoom(.1);t>y.getZoom()&&y.setView({center:n.center,zoom:t,animate:!0})},this.detachFromBreadcrumb=vi,this.attachToBreadcrumb=yi,this.dispose=pi,this.getEntity=bi,this.highlight=ki,this.unhighlight=di,this.setActiveFloor=ti,this.getActiveFloor=ir,this.show=fr,this.hide=er,this.getActiveView=ar},n.VenueMapFootprint=function(i,r,u){function ut(){t.removeHandler(e),e=null,c(i.get_MapContainer()).set_style("cursor",s);for(var n=0;n<f.length;n++)f[n].setOptions({strokeColor:w,strokeWeight:p,fillColor:b});h.turnOff()}function ft(n){var u,r;for(h.turnOn(),e=t.addHandler(i.getMap(),"mousemove",ot),u=n,et(),r=0;r<f.length;r++)f[r].setOptions({strokeWeight:tt,strokeColor:it,fillColor:rt})}function et(){var n=c(i.get_MapContainer());s=n.get_style("cursor"),s==="pointer"&&(s="default"),n.set_style("cursor","pointer")}function ot(n){var t=i.getMap(),r=t.getWidth()/2+n.getX(),u=t.getHeight()/2+n.getY();h.setPosition(u,r)}function st(n){t.invoke(nt,"click",n)}for(var nt=this,p=n.VenueMapConstants._strokeWeightNormal,tt=n.VenueMapConstants._strokeWeightHighlighted,w=n.VenueMapFootprint.footprintStrokeNormal,it=n.VenueMapFootprint.footprintStrokeHighlighted,b=n.VenueMapFootprint.footprintFillNormal,rt=n.VenueMapFootprint.footprintFillHighlighted,a=r.polygons,o=a.length,y=new Array(o),s="default",f=new Array(o),l,e,v=0;v<o;v++)y[v]=n.guid();try{s=c(i.get_MapContainer()).get_style("cursor")}catch(ht){s="default"}var k=new Array(o),d=new Array(o),g=new Array(o),h=new n.ToolTipHelper(i);h.updateContent(u),l=!1,e=null,this.dispose=function(){this.hide()},this.show=function(){if(!l){for(var n=0;n<a.length;n++)f[n]=i.AddPolygon(y[n],a[n].locations,p,w,b),k[n]=t.addHandler(f[n],"mouseover",ft),d[n]=t.addHandler(f[n],"mouseout",ut),g[n]=t.addHandler(f[n],"click",st);l=!0}},this.hide=function(){if(l){for(var n=0;n<a.length;n++)t.removeHandler(d[n]),t.removeHandler(k[n]),t.removeHandler(g[n]),i.RemoveShapeById(y[n]);e&&(t.removeHandler(e),e=null),h.turnOff()}l=!1}},n.VenueMapFootprint.footprintFillNormal=new s(51,0,0,255),n.VenueMapFootprint.footprintFillHighlighted=new s(51,0,0,255),n.VenueMapFootprint.footprintStrokeNormal=new s(154,255,255,255),n.VenueMapFootprint.footprintStrokeHighlighted=new s(255,0,0,0),n.VenueMapFootprint._lineStyle="solid",n.VenueMapFootprint._lineJoinMode="round",b={},i.VenueMaps=b,b.VenueMapFactory=function(t){var r=t.getComponent("venueMaps");r||(r={activeVenueMap:null},t.addComponent("venueMaps",r)),this.getActiveVenueMap=function(){return r.activeVenueMap},this.create=function(r){var e=function(n,t){function r(t){var r=new RegExp(t+"=([^;]*)"),i=n.match(r);return i&&(i=i[1]),i}t||(t="default");var i=r(t);return i||t==="default"||(t="default",i=r(t)),i||(i=n),i},o=function(n){callback=r.success,callback&&callback(n,r)},u=function(n){callback=r.error,callback&&callback(n,r)},f=e(i.Globals.venueMapsMetadataJsonpUrl,r.environment),s=e(i.Globals.venueMapsTileUrl,r.environment);t.getCredentials(function(i){if(i){f=f.replace("{credentials}",i);var e=new n.MetadataRequest({venueMapId:r.venueMapId,metadataUriFormat:f,timeout:3e4,callback:function(i){var h=r.venueMapId,c=i.options().venueMapId,f,e;h===c&&(f=n.convertMetadataV2ToV1(i.metadata()),e=i.timedOut(),e?u(3):f?n.validateMetadata(f)?o(new n.VenueMap({map:t,metadata:f,rawMetadata:{version:"2.0",data:i.metadata()},tileUriFormat:s})):u(2):u(1))}});e.execute()}else u(1)})},this.getNearbyVenues=function(r){var u=r.callback,f=r.location,e=r.radius;u&&(f&&e?t.getCredentials(function(t){if(t){var o=i.Globals.venueMapsNearbyUrl.replace("{location}",f.latitude+","+f.longitude).replace("{radius}",e).replace("{credentials}",t);y.getObjectAsync(o,function(t){n._callAsync(u,t,r)})}else n._callAsync(u,null,r)}):n._callAsync(u,null,r))}},n.VenueMapPolygon=function(i,r){var e=this,o=n.VenueMapConstants._strokeWeightNormal,w=n.VenueMapConstants._strokeWeightHighlighted,s=n.VenueMapPolygon.polygonStrokeNormal,b=n.VenueMapPolygon.polygonStrokeHighlighted,h=n.VenueMapPolygon.polygonFillNormal,k=n.VenueMapPolygon.polygonFillHighlighted,c=o,l=s,a=h,f=!1,v=i.id,y=r,p=i,tt=i.locations,u=null,d=null,g=null,nt=null;y.RemoveShapeById(v);var it=function(){t.invoke(e,"mouseout",p)},rt=function(){t.invoke(e,"mouseover",p)},ut=function(){t.invoke(e,"click",p)};this.getEntity=function(){return u},this.show=function(){f||(u=y.AddPolygon(v,tt,c,l,a),d=t.addHandler(u,"mouseover",rt),g=t.addHandler(u,"mouseout",it),nt=t.addHandler(u,"click",ut),f=!0)},this.hide=function(){f&&(y.RemoveShapeById(v),t.removeHandler(d),t.removeHandler(g),t.removeHandler(nt),f=!1)},this.highlight=function(){c=w,l=b,a=k,u&&u.setOptions({strokeWeight:w,strokeColor:b,fillColor:k})},this.unhighlight=function(){c=o,l=s,a=h,u&&u.setOptions({strokeWeight:o,strokeColor:s,fillColor:h})}},n.VenueMapPolygon.polygonStrokeNormal=new s(0,158,185,184),n.VenueMapPolygon.polygonStrokeHighlighted=new s(255,0,0,0),n.VenueMapPolygon.polygonFillNormal=new s(0,191,215,217),n.VenueMapPolygon.polygonFillHighlighted=new s(0,236,246,247),n.VenueMapPolygon._lineStyle="solid",n.VenueMapPolygon._lineJoinMode="round",n.VenueMapTileLayer=function(t,i,r,u,f){this._map=i,this._layerId=t,this._tileSource=new n.MapCruncherTileSource(r,u,f),this._layer=new rt({zIndex:n.VenueMapTileLayer.tileLayerZIndex,mercator:this._tileSource.createTileSource()})},n.VenueMapTileLayer.prototype={show:function(){this._added||(this._map.AddLayer(this._layerId,this._layer),this._added=!0)},hide:function(){this._added&&(this._map.RemoveLayer(this._layerId),this._added=!1)},dispose:function(){this.hide()}},n.VenueMapTileLayer.tileLayerZIndex=2,n.PopupHelper=function(t){function h(){e&&(e=!1,o.entities.remove(f))}function l(n){if(n&&n.SearchResponse&&n.SearchResponse.Query&&n.SearchResponse.Query.SearchTerms)var t=n.SearchResponse.Query.SearchTerms;else return;r[t].json=n,r[t].hasCompleted=!0,c()}function c(){var i;if(u){var c=u,h=r[c].json,s=r[c].primitive,l={id:u,polygon:t.getEntity(s.id),visible:!0,showPointer:!0,zIndex:3,title:s.name,description:s.description?"":"No information available."};s.businessId&&(l.titleClickHandler=function(t){window.open(n.generateLinkToLSVPage(s.businessId,s.name)),t.preventDefault()}),h.SearchResponse&&h.SearchResponse.Phonebook&&h.SearchResponse.Phonebook.Results&&(i=h.SearchResponse.Phonebook.Results[0],i&&(l.description=i.Address+", "+i.City+", "+i.StateOrProvince+" "+i.PostalCode+"<br>"+i.PhoneNumber)),f.setLocation(r[c].primitive.center),f.setOptions(l),e||(e=!0,o.entities.push(f)),u=null}}var o=t.baseMap,r={},f=new window[$MapsNamespace].Maps.Infobox(new window[$MapsNamespace].Maps.Location(0,0)),e=!1,u=null,s=function(n){var t=n.businessId,e=n.center.latitude,o=n.center.longitude,f;if(t){if(r[t]&&r[t].hasCompleted)return;var s=i.Globals.venueMapsEroServiceAppId,h=i.Globals.venueMapsEroServiceUrl,u="microsoftMapsVenueMapsPhonebookCallback";window[u]=function(n){l(n)},f=h.replace("{ypid}",t).replace("{query}",t).replace("{appid}",s).replace("{latitude}",e).replace("{longitude}",o).replace("{jsonp}",u).replace("{jsonso}",t),r[t]={},r[t].primitive=n,r[t].hasCompleted=!1,w.useXHR?y.getObjectAsyncCacheFriendly(f,window[u],t):y.getObjectAsyncCacheFriendly(f)}};this.fetchPopupData=s,this.showPopup=function(t){var i=t.businessId;i||(i=n.guid(),r[i]={hasCompleted:!0,primitive:t,json:{searchResponse:null}}),u=i,r[i]?r[i].hasCompleted&&c():s(t)},this.hidePopup=h,this.dispose=function(){h()}},n.MiniPopupHelper=function(n){function f(t){return t.floor.name==n.getActiveFloor()?e(t):!1}function e(n){var h=n.bounds.center.latitude-n.bounds.height/2,c=n.bounds.center.latitude+n.bounds.height/2,l=n.bounds.center.longitude-n.bounds.width/2,a=n.bounds.center.longitude+n.bounds.width/2,v=new window[$MapsNamespace].Maps.Location(h,l),y=new window[$MapsNamespace].Maps.Location(c,a),i=t.tryLocationToPixel(v),r=t.tryLocationToPixel(y);if(i&&r){var f=t.getWidth(),e=t.getHeight(),o={x:-f/2+u.left,y:-e/2+u.top},s={x:f/2-u.right,y:e/2-u.bottom};return!(i.x>s.x||i.y>s.y||r.x<o.x||r.y<o.y)}return!1}var t=n.baseMap,i=new window[$MapsNamespace].Maps.Infobox(new window[$MapsNamespace].Maps.Location(0,0),{title:""}),r=!1,u={top:10,bottom:10,left:10,right:10};this.show=function(u){if(f(u)){var e={visible:!0,showPointer:!1,showCloseButton:!1,zIndex:2,title:u.name,height:50,width:150,polygon:n.getEntity(u.id)};i.setLocation(u.center),i.setOptions(e),r||(r=!0,t.entities.push(i))}},this.hide=function(){r&&(t.entities.remove(i),r=!1)}},n.Directory=function(r){function ri(){var i,t,c,o;if(!ct){b=n.Directory.PrimitiveHelper.buildArray(r),h=new n.Directory.Renderer(r),f=document.createElement("div"),f.id="venuedirectory",s=n.addDOMElement("div","venuedirectory_div1",null,f,null),r.businessId?(i=n.addDOMElement("div","venuetitle","contactcardtitle",s,null),t=n.addDOMElement("a","venuetitleanchor",null,i,r.name),t.href=n.generateLinkToLSVPage(r.businessId,r.name),t.target="_blank"):n.addDOMElement("div","venuetitle","contactcardtitle",s,r.name),n.addDOMElement("div","address",null,s,r.address),c=n.addDOMElement("div","Phoneandyplinks","Phoneandyplinks",s,null),n.addDOMElement("div","directory","headingtext",s,e.getString("L_VenueMaps_Directory_Text")),rt=n.addDOMElement("div","categoriestogglebutton","categoriesbutton",s,null),g(rt).add_event("click",si);var a=n.addDOMElement("div",null,"columnheadertable",s,null),v=n.addDOMElement("table",null,null,a,null),y=n.addDOMElement("tbody",null,null,v,""),u=n.addDOMElement("tr",null,null,y,null),p=n.addDOMElement("td",null,"venuecolumn",u,null);ut=n.addDOMElement("span","sortalphabutton",null,p,e.getString("L_VenueMaps_SortByAlpha_Text")),o=n.addDOMElement("td",null,"levelcolumn",u,null),ft=n.addDOMElement("span","sortfloorbutton",null,o,e.getString("L_VenueMaps_SortByLevel_Text")),g(ut).add_event("click",hi),g(ft).add_event("click",ci),l=n.addDOMElement("div","venuedirectory_div2",null,f,null),l.style.display="none",k=n.addDOMElement("div",null,null,l,null),ct=!0}}function ui(i,r,o){i&&ct&&!n.is_in_DOM(f)&&(w=i,c=r,v=o,ht(st()),rt.innerHTML=v===d.none?e.getString("L_VenueMaps_ShowCategories_Text"):e.getString("L_VenueMaps_HideCategories_Text"),c==a.alphabetical?(ut.className="sortselected",ft.className="sortnormal"):(ut.className="sortnormal",ft.className="sortselected"),w.appendChild(f),g(window.self).add_event("resize",ti),pt=t.addHandler(h,"click",vi),wt=t.addHandler(h,"mouseout",ai),bt=t.addHandler(h,"mouseover",li),u&&gt(u))}function fi(){f&&f.parentNode&&(f.parentNode.removeChild(f),g(window.self).remove_event("resize",ti),t.removeHandler(pt),t.removeHandler(wt),t.removeHandler(bt),pt=null,wt=null,bt=null,u=null)}function ei(n){!n||n<=0||(n<100?(nt=n,ot=null):(ot=n,nt=null),ni(),l.style.display="block")}function gt(n){if(n&&n.id)p(),tt(n);else throw{name:"InvalidArgumentException",message:""};}function p(){if(u){var n=document.getElementById(u.id);n&&g(n).remove_class("dtrSelected")}u=null}function tt(n){var t=document.getElementById(n.id);t&&(oi(t)||(l.scrollTop=t.offsetTop),g(t).add_class("dtrSelected")),u=n}function oi(n){if(w){var t=g(w).get_absolute_pos().y,r=t+w.offsetHeight,f=g(n),i=f.get_absolute_pos().y,u=i+n.offsetHeight,e=i>=t&&i<=r,o=u>=t&&u<=r;return e&&o}return!1}function ni(){var n;if(ot||nt){n=nt?nt*r.baseMap.getHeight():ot;var i=s.offsetHeight,t=n-i-35;t>0&&(l.style.height=t+"px",l.style.overflowY="auto")}}function ti(){var n=u;p(),ni(),n&&tt(n)}function si(n){var i=u,t=null;p(),v===d.byCategory?(v=d.none,t=e.getString("L_VenueMaps_ShowCategories_Text")):(v=d.byCategory,t=e.getString("L_VenueMaps_HideCategories_Text")),n.currentTarget.innerHTML=t,ht(st()),y.collapseAll(),it.collapseAll(),i&&tt(i)}function hi(){var n=u;p(),c=a.alphabetical,ht(st()),ii(),n&&tt(n)}function ci(){var n=u;p(),c=a.floor,ht(st()),ii(),n&&tt(n)}function li(n){t.hasHandler(o,"mouseover")?t.invoke(o,"mouseover",n):o.handleMouseOver(n)}function ai(n){t.hasHandler(o,"mouseout")?t.invoke(o,"mouseout",n):o.handleMouseOut(n)}function vi(n){t.hasHandler(o,"click")?t.invoke(o,"click",n):o.handleMouseClick(n)}function ii(){var n=document.getElementById("sortalphabutton"),t=document.getElementById("sortfloorbutton");c===a.alphabetical?(n.className="sortselected",t.className="sortnormal"):(n.className="sortnormal",t.className="sortselected")}function st(){return v===d.none?c===a.alphabetical?pi():wi():(yi(),c===a.alphabetical?kt().get_root():dt().get_root())}function yi(){var n=y;c===a.alphabetical?(y=kt(),it=dt()):(y=dt(),it=kt()),n!==y&&n&&y.set_expanded_or_collapsed_selections(it.get_expanded_or_collapsed_selections())}function ht(n){if(k!==n){var t=k.parentNode;t.removeChild(k),t.appendChild(n),k=n}}function pi(){return lt||(lt=h.render(et.sortAlphabetical(b))),lt}function wi(){return at||(at=h.render(et.sortByFloor(b))),at}function kt(){return vt||(vt=new n.Directory.GroupView(et.group_Alpha(b),h)),vt}function dt(){return yt||(yt=new n.Directory.GroupView(et.group_Floor(b),h)),yt}var o=this,f=null,w=null,s=null,l=null,ct=!1,b=null,h=null,c=null,v=null,k=null,lt=null,at=null,vt=null,yt=null,y=null,it=null,rt=null,ut=null,ft=null,a=i.VenueMaps.DirectorySortOrder,d=i.VenueMaps.DirectoryGrouping,bi=n.Directory.CategoryViewState,et=n.Directory.PrimitiveHelper,ot=null,nt=null,u=null,pt,wt,bt;if(!r)throw{name:"ArgumentNullException",message:"argument cannot be null"};this.handleMouseClick=function(n){var t=n.primitive;o.select(t),r.select(t),r.popupHelper.showPopup(t),r.minipopupHelper.hide()},this.handleMouseOut=function(n){var t=n.primitive;t&&t!==u&&t.unhighlight(),g(n.eventArgs.currentTarget).remove_class("dtrHighlighted"),r.minipopupHelper.hide()},this.handleMouseOver=function(n){var t=n.primitive;t&&(t.highlight(),r.popupHelper.fetchPopupData(t)),g(n.eventArgs.currentTarget).add_class("dtrHighlighted"),r.minipopupHelper.show(t)},this.select=gt,this.unselect=p,this.createUIElements=ri,this.addToDOM=ui,this.removeFromDOM=fi,this.setHeight=ei,this.isInDOM=function(){return n.is_in_DOM(f)}},n.Directory.PrimitiveHelper=new function(){function t(t){var i=n(t),r=u(i);return f(r)}function n(n){for(var i=[],t=0;t<n.length;t++)i.push(n[t]);return i}function i(n,t){var r=n,u=t,i=r.name.localeCompare(u.name);return i||(i=r.floor.name.localeCompare(u.floor.name)),i}function r(n,t){var r=n,u=t,i=r.floor.name.localeCompare(u.floor.name);return i||(i=r.name.localeCompare(u.name)),i}function u(n){for(var i={},e,r=0;r<n.length;r++){var f=n[r],u=f.categoryId,o=f.categoryName,t;i[u]?t=i[u].tuples:(t=new Array(0),e={categoryId:u,categoryName:o,tuples:t},i[u]=e),t[t.length]=f}return i}function f(n){var t=new Array(0),r=n,i,u;for(i in r)u={key:i,value:r[i]},t[t.length]=u.value;return t.sort(function(n,t){var i=n,r=t;return i.categoryName.localeCompare(r.categoryName)}),t}this.buildArray=function(n){for(var f=[],u,r,t,i=0;i<n.floors.length;i++)for(u=n.floors[i],r=0;r<u.primitives.length;r++)t=u.primitives[r],t&&t.id&&t.name&&f.push(t);return f},this.buildHashTable=function(n){for(var f={},u,r,t,i=0;i<n.floors.length;i++)for(u=n.floors[i],r=0;r<u.primitives.length;r++)t=u.primitives[r],t&&t.id&&t.name&&(f[t.id]=t);return f},this.sortAlphabetical=function(t){var r=n(t);return r.sort(i),r},this.sortByFloor=function(t){var i=n(t);return i.sort(r),i},this.group_Alpha=function(n){for(var u=t(n),r=0;r<u.length;r++)u[r].tuples.sort(i);return u},this.group_Floor=function(n){for(var u=t(n),i=0;i<u.length;i++)u[i].tuples.sort(r);return u}},n.Directory.CategoryViewState={expanded:0,collapsed:1},window[$MapsNamespace].Maps.VenueMaps.DirectorySortOrder={alphabetical:0,floor:1},window[$MapsNamespace].Maps.VenueMaps.DirectoryGrouping={none:0,byCategory:1},n.Directory.GroupView=function(t,i){function w(n){n.preventDefault();var t=n.currentTarget,i=t.id;l(i)}function l(n){var t=r[n],i;i=h[n],t.visible?(i.removeChild(t.root),t.visible=!1):(i.appendChild(t.root),t.visible=!0)}for(var v=this,s=document.createElement("div"),y=s.appendChild(document.createElement("ul")),r={},h={},c,u=0;u<t.length;u++){var f=t[u],e=f.categoryId,p=f.categoryName,o=document.createElement("li");y.appendChild(o),c=n.addDOMElement("div",e,"categorylistitem",o,p),r[e]={root:i.render(f.tuples),visible:!1},h[e]=o,g(c).add_event("click",w)}this.get_root=function(){return s},this.get_expanded_or_collapsed_selections=function(){var t={},n;for(n in r)t[n]=r[n].visible;return t},this.set_expanded_or_collapsed_selections=function(n){var t,i;for(t in n)i=r[t],i.visible!==n[t]&&l(t)},this.collapseAll=function(){var n={},i,r,u;for(i in t)r=t[i],u=r.categoryId,n[u]=!1;v.set_expanded_or_collapsed_selections(n)}},n.Directory.Renderer=function(i){function f(n){t.invoke(u,"mouseover",{eventArgs:n,primitive:r[n.currentTarget.id]})}function e(n){t.invoke(u,"mouseout",{eventArgs:n,primitive:r[n.currentTarget.id]})}function o(n){n.preventDefault();var e=n.currentTarget.parentNode.parentNode.id,f=r[e];i.setActiveFloor(f.floor.name),i.setBestMapView(f,.1,i.minimumZoomForTileLayer),t.invoke(u,"click",{eventArgs:n,primitive:f})}var r=n.Directory.PrimitiveHelper.buildHashTable(i),u=this;this.render=function(t){for(var u=document.createElement("table"),h=n.addDOMElement("tbody",null,null,u,""),i=0;i<t.length;i++){var c=i%2,l=c?"directorytablerow2":"directorytablerow1",r=n.addDOMElement("tr",t[i].id,l,h,null),a=n.addDOMElement("td",null,"venuecolumn",r,null),s=n.addDOMElement("a",null,null,a,t[i].name);s.href="#",n.addDOMElement("td",null,"levelcolumn",r,t[i].floor.displayName),g(r).add_event("mouseenter",f).add_event("mouseleave",e),g(s).add_event("click",o)}return u}},window[$MapsNamespace].Maps.VenueMaps.VenueMapTask=function(n){function u(){n.show(),n.baseMap.setView(n.bestMapView),n.directory.createUIElements(),n.directory.addToDOM(r,0,0)}function f(){n.dispose()}var i=this,r=document.createElement("div"),e=t.addHandler(i,"remove",f),o=t.addHandler(i,"activate",u);this.getTitle=function(){return n.name},this.getPanel=function(){return r}},delete window[$MapsNamespace].Maps.initVenueMapsCode,l.Dynamic&&l.Dynamic.done("Microsoft.Maps.VenueMaps"),ft.end("Module initialized","Microsoft.Maps.VenueMaps",{module:"VenueMaps"})},window[$MapsNamespace].Maps.Map&&window[$MapsNamespace].Maps.initVenueMapsCode&&window[$MapsNamespace].Maps.initVenueMapsCode(),window.$MapsNamespace=window.$MapsNamespace||"Microsoft",window[$MapsNamespace]=window[$MapsNamespace]||{},window[$MapsNamespace].Maps=window[$MapsNamespace].Maps||{},window[$MapsNamespace].Maps.initTraffic=function(){function v(n,t){var f=this,u=n,i=null,e=t||r.trafficUriFormat;this.show=function(){f.getTileLayer(),u.entities.indexOf(i)===-1&&u.entities.push(i)},this.hide=function(){i&&u.entities.indexOf(i)!==-1&&u.entities.remove(i)},this.getTileLayer=function(){if(i===null){var n=new rt({uriConstructor:e,width:256,height:256});i=new tt({mercator:n,opacity:.7,tileDownloadPriority:it.low})}return i}}function ut(t,i,f){function v(n){return document.createTextNode(n)}function y(n){while(n&&n.firstChild)n.removeChild(n.firstChild)}var c=u.NavigationCommon,e=c.createElement,p=t,o=e("div",f.getClassName(),i),l,s,a,h;f.getDomElement=function(){return o},f.setMessage=function(n){y(a),a.appendChild(v(n))},c.addIgnoreEvents(o),this.dispose=function(){c.removeIgnoreEvents(o)},l=e("div","tlGroup",o),s=e("div","tlLegend",l),e("span","tlSlow",s).appendChild(v(n("L_TrafficLegendSlow_Text"))),e("span","tlFast",s).appendChild(v(n("L_TrafficLegendFast_Text"))),h=e("img","tlKey"),h.src=r.imagePath+"Traffic/tl_key.png",h.alt="",s.appendChild(h),a=e("div","tlMessage",l)}function e(n){this.setOptions(n)}function y(){l||(s=s||u.Overlays,s&&(s.registerOverlay("[TrafficLegendControl]",ut),l=!0))}function ft(t){function b(){if(ar(),cr(),l||s){var n=u.getZoom();n>=ct&&(l&&n>=yt&&ur(),s&&di()),e.show(u,ht),st(),yi()}else e.show(u,!1),ti()}function ai(){if(s||l){if(h.areEqual(ni,u.getCenter())&&wt==u.getZoom()&&lt==u.getMapTypeId())return;tt!=-1&&window.clearInterval(tt),tt=window.setInterval(ti,li),sr()?(vt={},window.setTimeout(b,200)):st()}}function vi(){var n=u.getZoom();n>=ct&&b()}function ti(){tt!=-1&&(window.clearInterval(tt),tt=-1),it!=-1&&(window.clearInterval(it),it=-1)}function yi(){(s||l)&&(it!=-1&&window.clearInterval(it),it=window.setInterval(vi,pt))}function pi(n){dt(rt);var t=n.target,r=t.getInfobox(),i=t.incident;kt(i),y.push(r),rt=i}function wi(){if(rt){var n=rt.pushpin;rt.infoboxTimeout=window.setTimeout(ot(ut,dt,rt),500)}}function bi(n){var t=n.target,i=t.getPushpin(),r=i.incident;kt(r)}function ki(n){var t=n.target,i=t.getPushpin(),r=i.incident;dt(r)}function kt(n){n.infoboxTimeout&&(window.clearTimeout(n.infoboxTimeout),n.infoboxTimeout=0)}function dt(n){n&&(kt(n),y.remove(n.infobox))}function di(){ft=new v(u,gi()),ft.show()}function ii(n){var e,o,h,t,r;if(lr(n),u.getZoom()>=yt&&(e=et[n],e))for(y||(y=new k,u.entities.push(y)),o=e.length,h=u.getTheme();o--;)if(t=e[o],vr(t)){var c={width:22,height:18,icon:t.severity==4?si:hi},s=ir(t.point),i=new nt(s,c);y.push(i),r=new d(s,{title:rr(t.type),description:tr(t),actions:nr(s),pushpin:i,showCloseButton:!1,width:350,height:250}),t.pushpin=i,t.infobox=r,i.incident=t,h?y.push(r):t.handlers=[f.addHandler(i,"mouseover",ot(ut,pi)),f.addHandler(i,"mouseout",ot(ut,wi)),f.addHandler(r,"mouseenter",ot(ut,bi)),f.addHandler(r,"mouseleave",ot(ut,ki))]}}function ot(n,t){return function(){t&&t.apply(n,arguments)}}function ri(){var o=[],e=u.getBounds(),t=u.getZoom(),n=2,i,r,f,s,c;for(t>=yt&&t<8?n=7:t>=8&&(t<9?n=6:t<10?n=5:t<11&&(n=3)),i={north:at(e.getNorth(),n)+n,south:at(e.getSouth(),n),east:at(e.getEast(),n)+n,west:at(e.getWest(),n)},r=i.south;r<i.north;r+=n)for(f=i.west;f<i.east;f+=n)s=new h(Math.min(r+n,90),f+n),c=new h(r,f),o.push(new g.fromLocations(s,c));return o}function ui(n){return[n.getSouth(),n.getWest(),n.getNorth(),n.getEast()].join(",")}function gi(){var n=r.trafficUriFormat,t="tc="+Math.floor((new Date).getTime()/(pt*.8));return n+(n.indexOf("?")==-1?"?":"&")+t}function fi(t){return t=t.replace("/Date(","").replace(")/",""),t=new Date(parseInt(t,10)),c.formatDate(t,n("L_TrafficPopupDateFormat_Text"))}function nr(t){return[{id:"trafficZoomIncident",label:n("L_TrafficPopupZoomToIncident_Text"),eventHandler:function(n){n.preventDefault(),u.setView({center:t,zoom:15})}},{id:"trafficCenterMap",label:n("L_TrafficPopupCenterMapHere_Text"),eventHandler:function(n){n.preventDefault(),u.setView({center:t})}}]}function tr(t){var u="trafficheader",f="trafficdata",e="traffictimedata",s="trafficlabel",r=":&nbsp;",i=[];return i.push(p(u,n("L_TrafficPopupSeverity_Text")+r)),i.push(p(f,fr(t.severity))),t.description&&(i.push(p(u,n("L_TrafficPopupDescription_Text")+r)),i.push(p(f,o.encodeHtml(t.description.replace("&amp;","&"))))),t.detour&&(i.push(p(u,n("L_TrafficPopupDetour_Text")+r)),i.push(p(f,o.encodeHtml(t.detour.replace("&amp;","&"))))),t.lane&&(i.push(p(u,n("L_TrafficPopupLane_Text")+r)),i.push(p(f,o.encodeHtml(t.lane.replace("&amp;","&"))))),t.start&&(i.push(p(s,n("L_TrafficPopupStartTime_Text")+r)),i.push(p(e,o.encodeHtml(fi(t.start))))),t.end&&(i.push(p(s,n("L_TrafficPopupEstEndTime_Text")+r)),i.push(p(e,o.encodeHtml(fi(t.end))))),i.join("")}function ir(n){var i=null,t=n.coordinates;return t&&t.length==2&&(i=new h(t[0],t[1])),i}function rr(t){var r;switch(t){case i.construction:r="L_TrafficScheduledConstruction_Text";break;case i.other:r="L_TrafficOtherNews_Text";break;case i.congestion:r="L_TrafficCongestion_Text";break;case i.accident:r="L_TrafficAccident_Text";break;case i.disabledVehicle:r="L_TrafficDisabledVehicle_Text";break;case i.hazard:r="L_TrafficRoadHazard_Text";break;case i.alert:r="L_TrafficUnScheduledContruction_Text";break;case i.planned:r="L_TrafficPlannedEvent_Text";break;case i.massTransit:r="L_TrafficMassTransit_Text";break;case i.weather:r="L_TrafficWeather_Text";break;case i.misc:r="L_TrafficMiscellaneous_Text"}return r&&n(r)||""}function ur(){for(var t=ri(),i=t.length,f=er(),r,n;i--;)r=t[i],n=ui(r),ei(n)?function(t){u.getCredentials(function(i){var r=ci.replace("{bounds}",t).replace("{sev}",f).replace("{credentials}",i);w.getObjectAsync(r,function(n,t){hr(n,t)},n,3e4)})}(n):ii(n)}function at(n,t){return n+=180,Math.floor(n-n%t-180)}function fr(t){return t=Math.min(Math.max(t-2,0),2),n(["L_TrafficSeverityMinor_Text","L_TrafficSeverityModerate_Text","L_TrafficSeveritySerious_Text"][t])}function er(){var n="",t=Math.round(u.getZoom());return t<=8?n="4":t==9?n="3,4":t==10&&(n="2,3,4"),n}function p(n,t){return['<div class="',n,'">',t,"<\/div>"].join("")}function ei(n){var t=vt[n],i=new Date;return!t||i-t>pt}function or(){var t=!0,n;return u.isMercator()||(n=u.getMode(),t=n&&n.canReprojectTileLayers&&n.canReprojectTileLayers()),t}function sr(){var n=!1,t=u.getZoom(),i=u.getMapTypeId(),r,f;if(i!=lt&&(i==a.birdseye||lt==a.birdseye)?n=!0:t!=wt&&t<=10&&(n=!0),!n&&t>ct)for(r=ri(),f=r.length;f--;)if(ei(ui(r[f]))){n=!0;break}return ni=u.getCenter(),lt=i,wt=t,n}function hr(n,t){if(!s&&!l||!n||n.statusCode!=200||!t||!t.success){st(!0);return}var i=t.userData;bt=vt[i]=new Date,et[i]=n.resourceSets&&n.resourceSets[0].resources||[],ii(i),st()}function cr(){ft&&ft.hide(),ft=null}function lr(n){var t,u,i,r;if(n&&y&&(t=et[n],t))for(u=t.length;u--;)i=t[u],r=i.pushpin,r&&(oi(i),y.remove(r),y.remove(r.getInfobox()),i.pushpin=null)}function ar(){var i,n,t;if(y){for(i in et)for(n=et[i],t=n&&n.length||0;t--;)oi(n[t]);u.entities.remove(y),y=null}}function oi(n){var t=n.handlers,i;if(t){for(i=t.length;i--;)f.removeHandler(t[i]);n.handlers=null}}function vr(n){var t=!0;switch(n.type){case i.congestion:t=!1;break;case i.massTransit:t=n.severity!=1;break;case i.weather:t=n.severity>2}return t}function st(t){var f,r,i;if(ht&&(s||l)){if(f=u.overlays,r=f&&u.overlays.getNamedEntity("overlaysBR").getNamedEntity("trafficlegend"),!r){window.setTimeout(st,500);return}or()?t?i=n("L_TrafficUnavailable_Text"):u.getZoom()<ct?i=n("L_TrafficZoomIn_Text"):bt&&(i=n("L_TrafficUpdated_Text")+" "+c.formatDate(bt,n("L_TrafficUpdatedTimeFormat_Text"))):i=n("L_TrafficNotAvailableInOblique_Text"),r.setMessage(i||"")}}var ut=this,u=t,ft,s,l,ht=!0,gt=r.imagePath+"/Traffic/",si=gt+"poi_traffic_red.png",hi=gt+"poi_traffic_yellow.png",et={},vt={},y,ci=r.trafficIncidentsJs,ct=r.trafficMinZoom,yt=r.trafficMinIncidentsZoom,li=r.trafficExpiry,pt=r.trafficRefresh,tt=-1,it=-1,ni,wt,lt,bt,rt;f.addHandler(u,"viewchangeend",ai),this.getIsOn=function(){return s||l},this.show=function(){s&&l||(s=l=!0,b())},this.hide=function(){(s||l)&&(s=l=!1,b())},this.showFlow=function(){s||(s=!0,b())},this.hideFlow=function(){s&&(s=!1,b())},this.showIncidents=function(){l||(l=!0,b())},this.hideIncidents=function(){l&&(l=!1,b())},this.showLegend=function(){ht=!0,b()},this.hideLegend=function(){ht=!1,b()}}var t=window[$MapsNamespace].Maps,p=t.Resources,n=p.getString,r=t.Globals,u=t.InternalNamespaceForDelay,o=u.IOSec,w=u.Network,s=u.Overlays,b=u.PRF,k=t.EntityCollection,f=t.Events,d=t.Infobox,h=t.Location,g=t.LocationRect,a=t.MapTypeId,nt=t.Pushpin,tt=t.TileLayer,it=t.TileDownloadPriority,rt=t.TileSource,i,c,l;typeof t.Traffic=="undefined"&&(t.Traffic={}),i={accident:1,congestion:2,disabledVehicle:3,massTransit:4,misc:5,other:6,planned:7,hazard:8,construction:9,alert:10,weather:11},c={formatDate:function(n,t){function r(n){return n<10?"0"+n:n.toString()}function s(n,t){for(var f=0,i=!1,u,r=0,e=n.length;r<e;r++){u=n.charAt(r);switch(u){case"'":i?t.push("'"):f++,i=!1;break;case"\\":i&&t.push("\\"),i=!i;break;default:t.push(u),i=!1}}return f}for(var i=[],e=/dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z/g,f,o=0;;){var h=e.lastIndex,u=e.exec(t),c=t.slice(h,u?u.index:t.length);if(o+=s(c,i),!u)break;if(o%2==1){i.push(u[0]);continue}switch(u[0]){case"dd":i.push(r(n.getDate()));break;case"d":i.push(n.getDate());break;case"MM":i.push(r(n.getMonth()+1));break;case"M":i.push(n.getMonth()+1);break;case"yyyy":i.push(n.getFullYear());break;case"yy":i.push(r(n.getFullYear()%100));break;case"y":i.push(n.getFullYear()%100);break;case"hh":f=n.getHours()%12||12,i.push(r(f));break;case"h":f=n.getHours()%12||12,i.push(f);break;case"HH":i.push(r(n.getHours()));break;case"H":i.push(n.getHours());break;case"mm":i.push(r(n.getMinutes()));break;case"m":i.push(n.getMinutes());break;case"ss":i.push(r(n.getSeconds()));break;case"s":i.push(n.getSeconds());break;case"tt":i.push(n.getHours()<12?"AM":"PM");break;case"t":i.push(n.getHours()<12?"A":"P")}}return i.join("")}},t.Traffic.TrafficLayer=v,e.prototype={_className:"TrafficLegend",getDomElement:function(){return null},getClassName:function(){return this._className},setOptions:function(n){if(n){var t=!1;typeof n.className=="string"&&(this._className=n.className,t=!0),t&&f.invoke(this,"entitychanged",{entity:this})}},toString:function(){return"[TrafficLegendControl]"}},e.show=function(n,t){var u,i,r;y(),u=n.overlays,u?(i=u.getNamedEntity("overlaysBR"),r="trafficlegend",t?i.getNamedEntity(r)||i.addNamedEntity(r,new e):i.removeNamedEntity(r)):f.addHandler(n,"overlayscreationstart",function(){e.show(n,t)})},l=!1,y(),t.Traffic.TrafficManager=ft,delete window[$MapsNamespace].Maps.initTraffic,u.Dynamic&&u.Dynamic.done("Microsoft.Maps.Traffic"),b.end("Module initialized","Microsoft.Maps.Traffic",{module:"Traffic"})},window[$MapsNamespace].Maps.Map&&window[$MapsNamespace].Maps.initTraffic&&window[$MapsNamespace].Maps.initTraffic(),window.$MapsNamespace=window.$MapsNamespace||"Microsoft",window[$MapsNamespace]=window[$MapsNamespace]||{},window[$MapsNamespace].Maps=window[$MapsNamespace].Maps||{},window[$MapsNamespace].Maps.initBingTheme=function(){var t=window[$MapsNamespace].Maps,c=t.Globals,i=t.Events,r=t.Gimme,p=t.Map,e=t.Pushpin,u=t.Point,o=t.Polygon,v=t.Color,l=t.Location,s=t.Infobox,y=t.InfoboxType,w=r.Helper.contains,f=t.InternalNamespaceForDelay,n=t.EntityState,h=t.PinFocusBehavior,a=f&&f.PRF;(function(){t.Themes=t.Themes||{},t.Themes.BingTheme=function(){function st(){f instanceof e?g():f instanceof o&&vt(),f=null}function ti(n,t){d[n]=t}function ii(t,i){var u={},r,f;return t=t||"bluepin",i=i||n.none,r=d[t],r&&(u={width:r.width,height:r.height,anchor:r.anchor.clone()},r.textOffset&&(u.textOffset=r.textOffset.clone()),f=ut(),u.className="pin"+r.iconStyle+" "+f,u.url=ct(r,f,i)),u}function ct(n,t,i){var r=n.icons,u=n.iconStyle;return r?r[t+it(i)]||r[t]||r.defaultIcon:(ht=c.bingThemeIconUrlFormat,ht.replace("{iconStyle}",u).replace("{imageryStyle}",t).replace("{state}",it(i)))}function it(t){return t&n.selected?"_s":t&n.highlighted?"_h":""}function g(){var i,r,u;f&&(i=f.trueEntity,r=f,f=null,i.setOptions({state:n.none}),r._shrink&&r._shrink.reverse(),r._shrink=null,a(r),u=i.getInfobox(),i.temporary&&(t.entities.remove(i),u&&t.entities.remove(u)),u&&a(u))}function lt(t){var u,s;if(f!=t){st(),f=t,u=t.trueEntity,u.setOptions({state:u.getState()|n.selected});var e=t.getWidth(),o=t.getHeight(),i=.5;t.iconData&&t.iconData.animatePins!==!1&&(t._shrink=r.Effects.Storyboard.create([t],{x:0,y:0,width:e,height:o,p:0},{x:(1-i)*e/2,y:(1-i)*o/2,width:i*e,height:i*o,p:1},function(n,i){t.overrideOptions=i,a(t)},300,null,null,wt),t._shrink.begin()),s=t.trueEntity.getInfobox(),s&&a(s)}}function ri(n){var t=n.target,i=t.trueEntity.getInfobox(),r;i&&(lt(t),r=t.trueEntity)}function ui(n){var t=n.target;nt(t,!0)}function fi(i){var r=t.getOptions(),u=i.target,f=u.trueEntity,o=!1,c;if(f&&f.getState()!==n.none&&g(),r.pinFocusBehavior&h.zoom){var s=f.getLocation(),l=t.getCenter(),e=t.getBounds();e.contains(s)||(o=!0,b=function(){r.pinFocusBehavior&h.highlight&&nt(u,!0)},c=Microsoft.Maps.LocationRect.fromLocations([e.getNorthwest(),e.getSoutheast(),s]),t.setView({bounds:c,padding:10,userInitiated:!1}))}o||(b=null),r.pinFocusBehavior&h.highlight&&nt(u,!0),kt(function(){var n=t.getRootElement();n.scrollTop=n.scrollLeft=0})}function at(t){var i=t.target,r=i.trueEntity;r.getState()===n.highlighted&&nt(t.target,!1)}function nt(t,i){var r=t.trueEntity,u;i?r.setOptions({state:r.getState()|n.highlighted}):r.setOptions({state:r.getState()&~n.highlighted}),u=r.getInfobox(),!u||r.getState()&n.selected||a(u),a(t)}function ei(t,i,r){var e=r.iconData,h=null;if(e){var l=ut(),s=i.overrideOptions||{},a=s.p>.5,c=t.getZIndex()+e.zIndex,o=t.getState();o&n.selected&&i!=f?lt(i):o&n.selected||i!=f||g(),o&n.selected&&a?c+=dt:o&n.highlighted&&(c+=gt),h={icon:ct(e,l,o),typeName:"pushpin pin"+e.iconStyle+" "+l+" "+it(o),anchor:new u(e.anchor.x-(s.x||0),e.anchor.y-(s.y||0)),width:s.width||e.width,height:s.height||e.height,textOffset:e.textOffset,text:a?"":t.getText()||"",id:t.getId(),draggable:t.getDraggable(),visible:t.getVisible(),useTransform3d:t.getUseTransform3d(),zIndex:c,state:t.getState(),location:t.getLocation()}}else h=lr(t);et(i,h)}function oi(n,t){return proxyEntity=new e(n.getLocation()),proxyEntity.iconData=t.iconData=si(n),proxyEntity}function si(n){for(var r=n.getIcon(),u=(n.getTypeName()||"").split(" "),t,f=u.length,i;f--;)if(i=u[f],d[i]){t=i;break}return t||r&&r!=c.pushpinImageUrl||(t="bluepin"),d[t]}function vt(){var i,t;f&&(i=f.trueEntity,i.setOptions({state:n.none}),a(f),t=f.trueEntity.getInfobox(),t&&a(t)),f=null}function li(t){var i,r;f!=t&&(st(),f=t,i=t.trueEntity,i.setOptions({state:i.getState()|n.selected}),r=t.trueEntity.getInfobox(),r&&a(r))}function ai(n){var t=n.target;t.trueEntity.getInfobox()&&li(t)}function vi(n){yt(n.target,!0)}function yi(n){yt(n.target,!1)}function yt(t,i){var r=t.trueEntity,u;i?r.setOptions({state:r.getState()|n.highlighted}):r.setOptions({state:r.getState()&~n.highlighted}),u=t.trueEntity.getInfobox(),u&&a(u),t&&a(t)}function pi(n,t,i){return t?hi:i.getStrokeColor()}function wi(n,t){var i=ut();et(t,{strokeColor:pi(i,n.getState(),n),visible:n.getVisible(),strokeThickness:n.getStrokeThickness(),strokeDashArray:n.getStrokeDashArray(),fillColor:n.getFillColor(),locations:n.getLocations()})}function bi(n){var t=new o(n.getLocations());return t.pointerEvents=n.pointerEvents,t}function rr(n){rt.push(n)}function ur(n){var i=n.measure(),u,t;n.overrideOptions={width:gi,height:null,typeName:"Infobox2 hiddenInfobox"},a(n),u=n.measure(),n.overrideOptions&&n.overrideOptions.width&&(n.overrideOptions.width=Math.max(nr,Math.min(u.width,tr))),a(n),t=n.measure(),r.Effects.Storyboard.create([n],{width:i.width,height:i.height-18,p:0},{width:t.width,height:t.height,p:1},function(t,i){n.overrideOptions=i,a(n)},300,null,null,wt).begin()}function fr(t,i){var k=t.getPushpin(),d=t.getPolygon(),r=i.overrideOptions||{},f=r.p>.5,e=r.p>.95,p=!1,s=36,w=-25,h=!1,b=null,c,l,o,a,v;for(e?(w=0,s=-2):!f&&r.height&&(s=54),c=k||d,l=new u(w,s),c?(o=c.getState(),h=o!=n.none&&t.getVisible(),o&n.selected&&!i.overrideOptions?(i.overrideOptions={},window.setTimeout(function(){ur(i)},100)):o&n.selected||!i.overrideOptions||(i.overrideOptions=null)):(f=t.typeName&&t.typeName===y.mini?!1:!0,e=t.getShowPointer(),h=t.getVisible(),p=t.getShowCloseButton(),l=t.getOffset(),b=t.getWidth()),a={typeName:r.typeName||(f?"Infobox2":"MiniInfobox2"),title:t.getTitle(),titleIsPlaintext:t.getTitleIsPlaintext(),width:r.width||b,height:!e&&r.height||null,description:t.getDescription(),titleAction:t.getTitleAction(),titleClickHandler:f?t.getTitleClickHandler():null,offset:l,zIndex:r?ki:di,actions:t.getActions(),showPointer:e,showCloseButton:p,visible:h,htmlContent:t.getHtmlContent(),location:t.getLocation(),clip:!1},v=rt.length;v--;)rt[v](t,i,a);et(i,a)}function er(n){for(var t=(n.getTypeName()||"").split(" "),i=!0,r=t.length,u;r--;)if(t[r]=="notheme"){i=!1;break}return i&&(u=new s(n.getLocation())),u}function or(n,u){t=n,ot=u,u.showDualMapTypeSelector!==!1&&(u.showDualMapTypeSelector=!0),u.showBreadcrumb!==!1&&(u.showBreadcrumb=!0),r(t.getRootElement()).add_class(bt()),pt(),i.addHandler(t,"click",cr),r(window).add_event("resize",k),i.addHandler(t,"resize",k),k(),i.addHandler(t,"imagerychanged",sr),i.addHandler(t,"viewchangeend",hr)}function sr(){a(t.entities)}function hr(){b&&(b(),b=null)}function cr(n){n.mouseMoved||n.targetType!="map"||(g(),vt())}function ut(){switch(t.getImageryId()){case"Aerial":case"EnhancedBirdseye":case"NativeBirdseye":return"dark";default:return"light"}}function k(n){n=typeof n=="number"?n:0;var u=t.getComponent("breadcrumb");if(u!=null){if(n>50)return;w&&(i.removeHandler(w),w=null),setTimeout(function(){var i=r(t.getRootElement()).select(".pathContainer").get_relative_pos().x,f=r(t.getRootElement()).select(".NavBar_zoomControlContainer").get_relative_pos().x,e=f-i-30;i>0&&f>0?u.setWidth(e):k(n+1)},100)}else w||(w=i.addHandler(t,"componentadded",k))}function pt(){if(t.overlays){if(t.overlays.setOptions({className:t.overlays.getClassName()+" stylev2"}),ot.showMapTypeSelector===!1){var n=t.overlays.get(0);n&&n.setOptions({className:n.getClassName()+" hidden"})}tt&&i.removeHandler(tt)}else tt=i.addHandler(t,"overlayscreationstart",pt)}function wt(n){return r.Effects.Easing.Exponential.ease_in_out(n,4)}function a(n){i.invoke(n,"entitychanged",{entity:n})}function ft(n){var i=n.entity,t;i.changing||(t=i.trueEntity,t&&a(t))}function lr(n){var r={},t,i;for(t in n)i=n[t],typeof i=="function"&&t.indexOf("get")==0&&(t=t.charAt(3).toLowerCase()+t.substr(4),r[t]=i.call(n));return r}function et(n,t){var r=!1,a=t.location&&n.getLocation&&!l.areEqual(n.getLocation(),t.location),f=t.locations&&n.getLocations,e,s,o,i;if(f)for(e=n.getLocations(),s=t.locations,f=e.length!==s.length,o=e.length;!f&&o--;)f=!l.areEqual(e[o],s[o]);for(i in t){var v="get"+i.substring(0,1).toUpperCase()+i.substring(1),h=typeof n[v]=="function"?n[v]():null,c=t[i];if(i=="anchor"||i=="textOffset"||i=="offset"?r=!u.areEqual(h,c):i=="strokeColor"?r=h.toHex()!=c.toHex():i=="location"||(r=h!=c),r)break}if(r||a||f){n.changing=!0,r&&n.setOptions(t),a&&n.setLocation(t.location),f&&n.setLocations(t.locations),n.changing=!1;return}}function ar(t,r){var u,f,l=r.eventHandlers,c,h;if(t instanceof e?(u=oi(t,r),f=ni):t instanceof o?(u=bi(t,r),f=ci):t instanceof s&&(u=er(t,r),f=ir),u){if(u.trueEntity=t,u.pointerEvents=t.pointerEvents,u.themeReference=r,f)for(c in f)l.push(i.addHandler(u,c,f[c]));t.getState&&t.getInfobox&&(h=t.getState(),l.push(i.addHandler(t,"entitychanged",function(){var i=t.getState(),r=i!=h&&!(i===(n.selected&n.highlighted)&&h===n.selected||i===n.selected&&h===(n.selected&n.highlighted));h=i,r&&a(t.getInfobox())})))}return u}function vr(n,t,i){var u=t.appliedTheme,f=!1,r;return u!=p&&(u&&u._unhookFromEntity(n,t),t.appliedTheme=p,t.eventHandlers=[],t.proxyEntity=ar(n,t),f=!0),r=t.proxyEntity,r&&(i.updateEntity||f)&&(n instanceof o?wi(n,r,t,i):n instanceof e?ei(n,r,t,i):n instanceof s&&fr(n,r,t,i)),r||n}function yr(n,t){var r=t.eventHandlers,u;if(r)for(u=r.length;u--;)i.removeHandler(r[u])}function bt(){return"BingTheme"}var p=this,w,pr=r("body"),tt,t,ot,f=null,b=null,kt=r.Effects.Animation.requestAnimationFrame,dt=2e3,gt=1e3,ht=null,d={micro:{width:16,height:16,anchor:new u(8,8),iconStyle:0,zIndex:0},bluepin:{width:28,height:28,anchor:new u(14,14),textOffset:new u(0,0),iconStyle:55,zIndex:1},locationpin:{width:29,height:29,anchor:new u(14,14),textOffset:new u(0,0),iconStyle:"location",zIndex:2},userpin:{width:28,height:28,anchor:new u(14,14),textOffset:new u(0,0),iconStyle:"user",zIndex:3}},ni={mouseover:ui,mouseout:at,focus:fi,blur:at,click:ri,entitychanged:ft},hi=new v(255,0,0,0),ci={mouseover:vi,mouseout:yi,click:ai,entitychanged:ft},ki=3e3,di=3100,gi="auto",nr=250,tr=400,rt=[],ir={entitychanged:ft};p.registerInfoboxRenderHandler=rr,p._attachToMap=or,p._preRenderEntity=vr,p._unhookFromEntity=yr,p.registerIconData=ti,p.getPinIcon=ii,p.getThemeName=bt}})(),delete window[$MapsNamespace].Maps.initBingTheme,f&&f.Dynamic&&f.Dynamic.done("Microsoft.Maps.Themes.BingTheme"),a&&a.end("Module initialized","Microsoft.Maps.Themes.BingTheme",{module:"BingTheme"})},window[$MapsNamespace].Maps.Map&&window[$MapsNamespace].Maps.initBingTheme&&window[$MapsNamespace].Maps.initBingTheme(),window.$MapsNamespace=window.$MapsNamespace||"Microsoft",window[$MapsNamespace]=window[$MapsNamespace]||{},window[$MapsNamespace].Maps=window[$MapsNamespace].Maps||{},window[$MapsNamespace].Maps.initAdvancedShapes=function(){function e(n){var u=this,t,r;if(e.baseConstructor.call(u,n),n&&n.bubble===!0){this._bubble=!0;function f(n){n&&n.eventName&&i.invoke(u,n.eventName,n)}for(t=["mousedown","mouseup","mouseover","mouseout","click","rightclick","dblclick"],r=t.length;r--;)this._eventsHandlers.push([t[r],f])}}function o(n,t){n&&n.length&&(this._locationsArrays=n[0]&&typeof n[0].latitude=="number"?[n]:n),this.setOptions(t)}function l(n,t){this._locationRect=n,this.setOptions(t)}function it(n){function e(n,i){var e=null,r=n[t],o,f;return r&&(o=r.harmony,o&&(f=r.path,f&&(e=f.nativeShape,o.removePath(f),r.path=null)),r.updateEntity=r.updateEntity||i.update,r.isDrawn=!1),u.isEventsSupported()&&e?{doms:[e]}:null}function r(n){var i=n[t];return i||(i={},n[t]=i),i}var f=n,i="cm"+h.getNext(),t=i+"_etr";this.shouldDraw=function(n,t){var f=n.getVisible()&&(t.linear||t.animationEnd||c.animateShapes),e,i,u;return f&&(e=r(n),i=e.boundingRect,(t.update||!i)&&(u=n.getRings(),e.boundingRect=i=u&&u.length>0?p.fromLocations(u[0]):null),f=i&&t.currentBounds.intersects(i)),f},this.update=function(n,t){var s=t.viewportSize,o=r(n),a,l,w,e,b,tt,it,v,rt,ut,ft,et,y,p,nt;if(t.update=o.updateEntity||t.update,o.updateEntity=!1,a=o.harmony,!a&&t.parentDom&&(l=t.parentDom.harmony,l||(l=g("div","position:absolute;width:"+s.width+"px;height:"+s.height+"px;left:"+-(s.width/2)+"px;top:"+-(s.height/2)+"px;"+c.safariRenderHack),t.parentDom.harmony=l,w=t.parentDom,w.firstChild?w.insertBefore(l,w.firstChild):w.appendChild(l)),a=u.getContext(l),l.className="MicrosoftMapDrawing",o.harmony=a),e=o.path,b=!1,e&&k.areEqual(o.previousSize,s)||(a.setSize(s.width,s.height),o.previousSize=s,b=!0),e||(e=a.createPath(),e.id=i+"path"+h.getNext(),o.path=e,t.update=!0),t.update&&(tt=n.getStrokeColor(),e.strokeStyle=tt.toHex(),e.strokeOpacity=tt.getOpacity(),e.lineWidth=n.getStrokeThickness(),e.dashArray=n.getStrokeDashArray(),it=n.getFillColor(),e.fillStyle=it.toHex(),e.fillOpacity=it.getOpacity()),!t.linear||!o.points||b)for(rt=n.getRings(),o.ringPoints=[],o.offsetLeft=t.parentOffsetLeft,o.offsetTop=t.parentOffsetTop,v=rt.length;v--;)o.ringPoints[v]=f.tryLocationToPixel(rt[v]);if(!t.linear||t.animationEnd||t.update||b){for(ut=o.ringPoints,e.beginPath(),ft=o.offsetLeft-s.width/2,et=o.offsetTop-s.height/2,v=ut.length;v--;)if(y=ut[v],y&&y.length)for(p=y[0],e.moveTo(p.x-ft,p.y-et),nt=1;nt<y.length;nt++)p=y[nt],e.lineTo(p.x-ft,p.y-et);e.data||e.moveTo(0,0),e.stroke(),o.isDrawn||(a.renderPath(e),o.isDrawn=!0)}return u.isEventsSupported()?{doms:[e.nativeShape],type:d.polygon}:null},this.remove=e,this.dispose=function(n){delete n[t]}}function rt(n){function e(n,i){var e=null,r=n[t],o,f;return r&&(o=r.harmony,o&&(f=r.path,f&&(e=f.nativeShape,o.removePath(f),r.path=null)),r.updateEntity=r.updateEntity||i.update,r.isDrawn=!1),u.isEventsSupported()&&e?{doms:[e]}:null}function f(n){var i=n[t];return i||(i={},n[t]=i),i}var i=n,r="cm"+h.getNext(),t=r+"_etr";this.shouldDraw=function(n,t){var r=n.getVisible()&&(t.linear||t.animationEnd||c.animateShapes),u,i;return r&&(u=f(n),i=u.boundingRect,(t.update||!i)&&(u.boundingRect=i=n.getEllipse()),r=i&&t.currentBounds.intersects(i)),r},this.update=function(n,t){var b=t.viewportSize,w=f(n),ot,tt,ht,e,at,vt,yt,nt;if(t.update=w.updateEntity||t.update,w.updateEntity=!1,ot=w.harmony,!ot&&t.parentDom&&(tt=t.parentDom.harmony,tt||(tt=g("div","position:absolute;width:"+b.width+"px;height:"+b.height+"px;left:"+-(b.width/2)+"px;top:"+-(b.height/2)+"px;"+c.safariRenderHack),t.parentDom.harmony=tt,ht=t.parentDom,ht.firstChild?ht.insertBefore(tt,ht.firstChild):ht.appendChild(tt)),ot=u.getContext(tt),tt.className="MicrosoftMapDrawing",w.harmony=ot),e=w.path,at=!1,e&&k.areEqual(w.previousSize,b)||(ot.setSize(b.width,b.height),w.previousSize=b,at=!0),e||(e=ot.createPath(),e.id=r+"path"+h.getNext(),w.path=e,t.update=!0),t.update&&(vt=n.getStrokeColor(),e.strokeStyle=vt.toHex(),e.strokeOpacity=vt.getOpacity(),e.lineWidth=n.getStrokeThickness(),e.dashArray=n.getStrokeDashArray(),yt=n.getFillColor(),e.fillStyle=yt.toHex(),e.fillOpacity=yt.getOpacity()),!t.linear||!w.center||at){var a=t.parentOffsetLeft-b.width/2,v=t.parentOffsetTop-b.height/2,st=n.getEllipse();nt=i.tryLocationToPixel(st.center);var pt=i.tryLocationToPixel(new s(st.getNorth(),st.center.longitude-st.width/2)),wt=i.tryLocationToPixel(new s(st.getSouth(),st.center.longitude+st.width/2)),bt=pt.x<nt.x?Math.abs(nt.x-pt.x):Math.abs(wt.x-nt.x);w.center=nt;var it=.5522847498,ct=[nt.x-bt,nt.x,nt.x+bt],lt=[pt.y,nt.y,wt.y],y,p,o,l,rt,ut,ft,et;y=ct[1],p=lt[0],o=ct[2],l=lt[1],rt=y+(o-y)*it,ut=p,ft=o,et=l-(l-p)*it,e.beginPath(),e.moveTo(y-a,p-v),e.curveTo(rt-a,ut-v,ft-a,et-v,o-a,l-v),y=o,p=l,o=ct[1],l=lt[2],rt=y,ut=p+(l-p)*it,ft=o+(y-o)*it,et=l,e.curveTo(rt-a,ut-v,ft-a,et-v,o-a,l-v),y=o,p=l,o=ct[0],l=lt[1],rt=y-(y-o)*it,ut=p,ft=o,et=l+(p-l)*it,e.curveTo(rt-a,ut-v,ft-a,et-v,o-a,l-v),y=o,p=l,o=ct[1],l=lt[0],rt=y,ut=p-(p-l)*it,ft=o-(o-y)*it,et=l,e.curveTo(rt-a,ut-v,ft-a,et-v,o-a,l-v),e.stroke(),w.isDrawn||(ot.renderPath(e),w.isDrawn=!0)}return u.isEventsSupported()?{doms:[e.nativeShape],type:d.polygon}:null},this.remove=e,this.dispose=function(n){delete n[t]}}var n=window[$MapsNamespace].Maps,ut=n.Globals,i=n.Events,p=n.LocationRect,s=n.Location,t=n.InternalNamespaceForDelay,h=t.IdGenerator,nt=t.PRF,tt=n.EntityCollection,w=n.Polygon,c=t.Quirks,a=t.Common,b=t.CompositeMode,u=t.Harmony,k=t.Size,d=t.EventTargetType,ft=a.stopPropagation,g=a.createElement,v=a.extend,y,r,f;v(e,tt),y=e.prototype,y.setOptions=function(n,t){var r=e.superClass.setOptions.call(this,n,!0),u,f;if(this._bubble&&n.bubble!==!1)for(u=this.getLength();u--;)f=this.get(u),f.setOptions&&(r=f.setOptions(n,!0)||r);return r&&!t&&i.invoke(this,"entitychanged",{entity:this}),r},y.toString=function(){return"[AdvancedShapes.EntityCollection]"},n.EntityCollection=e,v(o,w),r=o.prototype,r.setRings=function(n){this._locationsArrays=n,i.invoke(this,"entitychanged",{entity:this})},r.getRings=function(){return this._locationsArrays},r.setLocations=function(n){this._locationsArrays=[n],i.invoke(this,"entitychanged",{entity:this})},r.getLocations=function(){var n=this._locationsArrays;return n&&n.length?n[0]:null},r.setOptions=function(n,t){var r=o.superClass.setOptions.call(this,n,!0);return r&&!t&&i.invoke(this,"entitychanged",{entity:this}),r},r.toString=function(){return"[AdvancedShapes.Polygon]"},n.Polygon=o,v(l,w),f=l.prototype,f.setEllipse=function(n){this._locationRect=n,i.invoke(this,"entitychanged",{entity:this})},f.getEllipse=function(){return this._locationRect},f.setLocations=function(n){this._locationRect=p.fromLocations(n),i.invoke(this,"entitychanged",{entity:this})},f.getLocations=function(){var n=this._locationRect;return[n.getNorthwest(),new s(n.getNorth(),n.getEast()),n.getSoutheast(),new s(n.getSouth(),n.getWest())]},f.toString=function(){return"[AdvancedShapes.Ellipse]"},n.Ellipse=l,new function(){var n=[],t=[],i=function(i,r){var u=null,f;if(r instanceof o){for(f=n.length;f--;)n[f]===i&&(u=t[f]);u||(u=new it(i),n.push(i),t.push(u))}return u};b.registerEntityRenderer(i,{priority:0})},new function(){var n=[],t=[],i=function(i,r){var u=null,f;if(r instanceof l){for(f=n.length;f--;)n[f]===i&&(u=t[f]);u||(u=new rt(i),n.push(i),t.push(u))}return u};b.registerEntityRenderer(i,{priority:0})},delete window[$MapsNamespace].Maps.initAdvancedShapes,t.Dynamic&&t.Dynamic.done("Microsoft.Maps.AdvancedShapes"),nt.add("AdvancedShapes initialized")},window[$MapsNamespace].Maps.Map&&window[$MapsNamespace].Maps.initAdvancedShapes&&window[$MapsNamespace].Maps.initAdvancedShapes(),window.$MapsNamespace=window.$MapsNamespace||"Microsoft",window[$MapsNamespace]=window[$MapsNamespace]||{},window[$MapsNamespace].Maps=window[$MapsNamespace].Maps||{},window[$MapsNamespace].Maps.initDirectionsCode=function(){function wr(n){this._map=n,this._task=null,this._sessionState={}}function ft(t){function r(n){n&&n.disambiguation&&(i._disambiguation=n.disambiguation),i._uniqueId===null&&(i._uniqueId=ft._uniqueWaypointId++)}function u(t){if(t){var r=!1;t.address&&t.address.formattedAddress&&(t.latitude&&t.longitude&&((!i._location||i._location&&(i._location.latitude!==t.latitude||i._location.longitude!==t.longitude))&&(r=!0),i._location=new l(t.latitude,t.longitude),i._geoLocation=new l(t.latitude,t.longitude)),i._address!==t.address.formattedAddress&&(r=!0),i._shortAddress!==t.address.shortFormattedAddress&&(r=!0),i._shortAddress=t.address.shortFormattedAddress,i._address=t.address.formattedAddress,i._exactLocation=!0,i._inputType=t.inputType,r&&n.invoke(i,"changed",{waypoint:i})),t.disambiguation&&(i._inputType=t.inputType,i._disambiguation=t.disambiguation,i._location||(r=!0)),r&&i._geocoded()}}var i=this;i.setOptions=function(t){var u,f;t&&(u=!1,r(t),typeof t.address=="string"&&i._address!==t.address&&(i._address=t.address,i._disambiguation=null,u=!0),t.location&&!l.areEqual(t.location,i._location)&&(i._location=t.location,u=!0),t.geoLocation&&!l.areEqual(t.geoLocation,i._geoLocation)&&(i._geoLocation=t.geoLocation,u=!0),typeof t.isViapoint=="boolean"&&(i._isViapoint=t.isViapoint,u=!0),(t.pushpin&&t.pushpin instanceof ct||t.pushpin===null)&&(i._pushpin=t.pushpin,u=!0),typeof t.shortAddress=="string"&&(i._shortAddress=t.shortAddress,i._disambiguation=null,u=!0),typeof t.exactLocation=="boolean"&&(i._exactLocation=t.exactLocation,u=!0),typeof t.disambiguationContainer=="object"&&(i._disambiguationContainer=t.disambiguationContainer,u=!0),t.businessDetails&&(f=t.businessDetails,typeof f.businessName=="string"&&(i._businessName=f.businessName,u=!0),typeof f.phoneNumber=="string"&&(i._phoneNumber=f.phoneNumber,u=!0),typeof f.entityId=="string"&&(i._entityId=f.entityId,u=!0),typeof f.entityLink=="string"&&(i._entityLink=f.entityLink,u=!0),typeof f.website=="string"&&(i._website=f.website,u=!0)),u&&n.invoke(i,"changed",{waypoint:i}))},i.clear=function(){i._address="",i._shortAddress="",i._locationIdentifier="",i._location=null,i._geoLocation=null,i._businessName="",i._phoneNumber="",i._exactLocation=!0,i._disambiguationContainer=null,i._disambiguation=null,i._entityId="",i._entityLink="",i._website="",i._inputType=null,i._isViapoint=i._isViapoint,n.invoke(i,"cleared",{waypoint:i})},i._updateWaypoint=function(n){n&&(n.failed||u(n))},i._reverseGeocoded=function(){n.invoke(i,"reverseGeocoded",{waypoint:this})},i._geocoded=function(){n.invoke(i,"geocoded",{waypoint:this})},r(t),i.setOptions(t)}function yf(t,i){function s(n,t,i,r,u){i.visible=!1,i.id=n;var e=new lu(t,i),o=new ii;return o.init(f,e,t,r,u),e.ZoomAwarePolyline=ii,e}function e(n){var t=u.getOptions();return n===rt.walk?u.cloneOptions(t.walkingPolylineOptions):n===rt.ferry||n===rt.bus||n===rt.train||n===rt.airline||n===rt.other?u.cloneOptions(t.transitPolylineOptions):u.cloneOptions(t.drivingPolylineOptions)}var r=this,f=t,u=i;r._displayedRoutes={},r.updateRouteOnMapControl=function(n,t,i){for(var tt=n.length,f,b,s,d,y,g,h,nt,l,c,a=0;a<tt;a++)if(f=n[a],!r._displayedRoutes[f.legKey])for(b=f.subLegs.length,s=0;s<b;s++)if(!r._displayedRoutes[f.subLegs[s].subLegKey]){var v=f.subLegs[s].routePath,p=[],k=u.getOptions().routeMode;if(k!==o.transit)w.decodeRoute(v,!0),d=k===o.walking?rt.walk:rt.auto,p[0]=r.addPolyline(f.subLegs[s].subLegKey,v,e(d),t,f.legKey,f.subLegs[s].subLegKey);else for(w.decodeRoute(v,!1),y=wt._splitTransitRoutes(f.itineraryItems,v),g=y.length,h=0;h<g;h++)f.itineraryItems[h].startPathIndex!==f.itineraryItems[h].endPathIndex&&(nt=f.itineraryItems[h].iconType,l=null,f.itineraryItems[h]&&f.itineraryItems.length===y.length&&(l=e(nt),i&&(c=l.strokeColor.clone(),c.a=c.getOpacity()<.5?c.a+80:c.a-80,l.strokeColor=c)),p[p.length]=r.addPolyline(f.subLegs[s].subLegKey+"_"+h,y[h],l,t,f.legKey,f.subLegs[s].subLegKey))}},r.clearRoute=function(t){var o,i,e,s,c,u,l,h;if(t)for(r._removeAllTemporaryRoutes(),o=t.length,i=0;i<o;i++){e=r._displayedRoutes;for(s in e)if(c=e[s],c.subLegKey===t[i]||c.parentLegKey===t[i]){for(u=c.polylines,l=u.length,h=0;h<l;h++)f.entities.remove(u[h]),n.invoke(this,"polylineRemoved",{polyline:u[h]});delete r._displayedRoutes[s]}}else{e=r._displayedRoutes;for(s in e)for(u=e[s].polylines,o=u.length,i=0;i<o;i++)f.entities.remove(u[i]),n.invoke(this,"polylineRemoved",{polyline:u[i]});r._displayedRoutes={}}},r._removeAllTemporaryRoutes=function(){var e=r._displayedRoutes,t,i,u,o,n;for(t in e)if(i=e[t],i.temporaryRoute){for(u=i.polylines,o=u.length,n=0;n<o;n++)f.entities.remove(u[n]);delete r._displayedRoutes[t]}},r.addPolyline=function(t,i,f,e,o,h){for(var p=i.decodedLatitudes.length,w=new Array(p),v,c,y,a=0;a<p;a++)w[a]=new l(i.decodedLatitudes[a],i.decodedLongitudes[a]);return v=s(u.PolylinePrefixId+t,w,f,i.decodedRegions,i.zoomLevels.split(",")),r._displayedRoutes[h]?(y=r._displayedRoutes[h].polylines,y[y.length]=v):(c=new hr,c.polylines=[],c.parentLegKey=o,c.polylines[0]=v,c.subLegKey=h,c.temporaryRoute=e,r._displayedRoutes[h]=c),n.invoke(this,"polylineAdded",{polyline:v,tempararyPolyline:e}),v},r.dispose=function(){r.clearRoute(null,!1)}}function fu(n,o,s,h){function tt(n){return b?t._convert24HourTo12Hour(n):n}function it(n){return n?u.getString("L_TimePM_Text"):u.getString("L_TimeAM_Text")}function ut(){var u=y(k),f=u.innerHTML,r=t.getDateFromStringInSupportedFormat(f,p.TransitDateFormat),i=n.getOptions().transitOptions.transitTime;i instanceof Date||(i=new Date),r&&(i=new Date(r.getFullYear(),r.getMonth(),r.getDate(),i.getHours(),i.getMinutes(),i.getSeconds())),n.setOptions({transitOptions:{transitTime:i}}),h&&h(i)}function d(i){var r=n.getOptions().transitOptions.transitTime,e,u,f;r instanceof Date||(r=new Date),e=r.getHours()>=12^i,w&&(w.innerHTML=it(e)),u=parseInt(l.value,10),!isNaN(u)&&u>=0&&u<=23?(b&&(u=t._convert12HourTo24Hour(u,e)),r.setHours(u)):l.value=tt(r.getHours()).toString(),f=parseInt(a.value,10),!isNaN(f)&&f>=0&&f<=59?r.setMinutes(f):a.value=r.getMinutes().toString(),n.setOptions({transitOptions:{transitTime:r}}),h&&h(r)}var b=p.TransitTimeUse12Hour,rt=n._getPrefixId(),k=rt+o,c=n.getOptions().transitOptions.transitTime,g,nt,l,a,w;c instanceof Date||(c=new Date),g=f("label",k,"transitDateContainer transitDateTimeBox transitCalendarOpener",s,t.getDateInSupportedFormat(c)),nt=v==="ja-jp",di.InitCalendar(k,g,c,nt,r(self,ut)),l=f("input","hourInput","transitDateTimeBox transitTimeBox",s,""),l.value=tt(c.getHours()).toString(),l.setAttribute("type","text"),l.setAttribute("maxlength",2),l.setAttribute("size",2),f("label","","transitTimeSeperator",s,":"),a=f("input","minuteInput","transitDateTimeBox transitTimeBox",s,null),a.value=(c.getMinutes()<10?"0":"")+c.getMinutes().toString(),a.setAttribute("type","text"),a.setAttribute("maxlength",2),a.setAttribute("size",2),w=null,b&&(w=e("amPmSwitch","transitDateTimeBox",s),w.innerHTML=it(c.getHours()>=12),i(w).add_event("click",r(self,function(){d(!0)}))),i(l).add_event("change",d),i(a).add_event("change",d)}function ui(n,i){function u(n){var i=r._state.getOptions(),u=i.transitOptions,t;if(i.routeMode===o.transit){n||(n={});switch(u.timeType){case et.departure:default:n.limit="D";break;case et.arrival:n.limit="A";break;case et.lastAvailable:n.limit="LT"}t=u.transitTime,t instanceof Date||(t=new Date),n.time=""+t.getFullYear()+(t.getMonth()+1<10?"0":"")+(t.getMonth()+1)+(t.getDate()<10?"0":"")+t.getDate()+(t.getHours()<10?"0":"")+t.getHours()+(t.getMinutes()<10?"0":"")+t.getMinutes(),n.sri=i.routeIndex,n.maxr=r._state.getOptions().maxRoutes,p.TransitAdvancedOptions&&(n.opt=i.routeOptimization)}}function f(n){var u="",t=n.getDisambiguationResult(),i;return t?(t.dependentLocation.latitude||t.dependentLocation.longitude)&&(u=t.dependentLocation.latitude.toFixed(c)+","+t.dependentLocation.longitude.toFixed(c)):(i=r._state.getPreviousWaypoint(n._uniqueId),i&&i.getLocation()&&(u=i.getLocation().latitude.toFixed(c)+","+i.getLocation().longitude.toFixed(c))),u}var r=this;r._map=n,r._state=i,r.generateGetDirectionsLink=function(n,t,i){for(var f={},e="",l=t.length,c=!1,o,s,h,u=0;u<l;u++)u>0&&(e+="~"),o=t[u],e+=r._getStopPointParam(o),o.getLocation()||o.getDisambiguationResult()||(c=!0);for(f.w=e,e="",u=0;u<n.length;u++)u>0&&(e+="|"),s=n[u],e+=s[0].toString()+"~"+s[1].toString();return f.d=e,e="",r._addRouteOptionsLink(f,!0),c&&(f.bb=r._generateMapBoundingBoxLink(),r.addUserLocation(f)),typeof VEShell!="undefined"&&(h=r._getQueryParam(null,null),h&&(f.q=h)),r._addPermalinkAdditionalParams(f,i),f},r.generateNearbyArterialsLink=function(n,t){var i={},u=n.latitude.toFixed(c)+","+n.longitude.toFixed(c)+",";return i.w=u,i.m="8",r._addPermalinkAdditionalParams(i,t),i},r.generateReverseGeocodeLink=function(n,t){var i={},u;return i.m="7",u=n.latitude.toFixed(c)+","+n.longitude.toFixed(c)+",",i.w=u,r._addPermalinkAdditionalParams(i,t),i},r.generateGetTransitScheduleLink=function(n,t){var i={m:"9",stopIds:n.join(","),transitType:2};return u(i),r._addPermalinkAdditionalParams(i,t),i},r.generateResolveWaypointLink=function(n,t,i,u,e){var o={},s,h;return o.w="a."+n.getAddress(),i?t?o.prew=t.latitude.toFixed(c)+","+t.longitude.toFixed(c):o.start="1":(s=n._uniqueId===r._state.stoppoints[0]._uniqueId,o.start=s?"1":"0",s||(h=f(n),h&&(o.prew=h))),o.bb=r._generateMapBoundingBoxLink(),r.addUserLocation(o),u>=0&&(o.si=u),r._addPermalinkAdditionalParams(o,e),o},r.addUserLocation=function(){},r._addPermalinkAdditionalParams=function(n){var r="",f=t.parseQueryString().form,e,o,u,i;f&&(n.FORM=f);for(e in n)r+=n[e].toString();for(o=r.length,u=0,i=0;i<o;i++)u+=r.charCodeAt(i);kt.useXHR||(n.jsonso="d"+u,n.jsonp="microsoftMapsNetworkCallback"),n.mkt=v,b.ishttpsenabled&&(n.s="1")},r._getStopPointParam=function(n){var t="",i;return n.isViapoint()&&(t+="v."),i=n.getLocation(),i?(t+=i.latitude.toFixed(c),t+=",",t+=i.longitude.toFixed(c),r._state.getOptions().routeMode!==o.transit&&n._locationIdentifier&&(t+=",",t+=n._locationIdentifier)):t+="a."+n.getAddress(),t},r._generateMapBoundingBoxLink=function(){var t="",n;return r._map&&(n=r._map.getBounds(),t+=n.getNorth().toFixed(c)+","+n.getEast().toFixed(c),t+="~",t+=n.getSouth().toFixed(c)+","+n.getWest().toFixed(c)),t},r._addRouteOptionsLink=function(n,t){var i=r._state.getOptions(),f,e;switch(i.routeMode){case o.walking:n.mode="W";break;case o.transit:n.mode="T";break;case o.driving:default:n.mode="D"}f="",i.routeMode===o.driving?(f+=i.routeOptimization+"~",f+=i.avoidTraffic?"1":"0",f+="~0~",n.rtop=f):r._state.getOptions().routeMode===o.transit&&u(n),t&&(n.u=r._state.getOptions().distanceUnit===it.miles?"0":"1"),i.routeAvoidance!==s.none&&(e=i.routeAvoidance,(e&s.avoidExpressTrain)===s.avoidExpressTrain&&(e|=s.avoidBulletTrain),n.av=e)},r._getQueryParam=function(n,t){var s="",o=r._state.getAllWaypoints(),i,f,u,e;return o&&(i=o[0],f=i.getAddress(),!f&&i.getLocation()&&(f=ki.replace("{0}",i.getLocation().latitude.toFixed(c)).replace("{1}",i.getLocation().longitude.toFixed(c))),u=o[o.length-1],e=u.getAddress(),!e&&u.getLocation()&&(e=ki.replace("{0}",u.getLocation().latitude.toFixed(c)).replace("{1}",u.getLocation().longitude.toFixed(c))),n&&t&&(i._uniqueId===n._uniqueId?f=ki.replace("{0}",t.latitude.toFixed(c)).replace("{1}",t.longitude.toFixed(c)):u._uniqueId===n._uniqueId&&(e=ki.replace("{0}",t.latitude.toFixed(c)).replace("{1}",t.longitude.toFixed(c)))),s=f+"~"+e),s}}function st(r){function ut(n){for(var f=0;f<n.length;f++){var u=n[f].transitLine,i=ir,r=rr;u&&(u.lineColor&&(i=u.lineColor),u.lineTextColor&&(r=u.lineTextColor),i===ir&&r!==rr&&(i=t.getLuminance(r)<gu?ur:fr),i!==ir&&r===rr&&(r=t.getLuminance(i)<hf?ur:fr),Math.abs(t.getLuminance(i)-t.getLuminance(r))<50&&(i=fr,r=ur),u.lineColor=i,u.lineTextColor=r)}}function ft(){var n=p.DefaultMode;return typeof VEShell!="undefined"&&typeof u.sessionState.defaultRouteMode=="string"&&(n=u.sessionState.defaultRouteMode),n}function g(n){var i=u.routes[n].routeLegs,r;if(i&&i.length){for(u.summary[n].northEast=i[0].summary.northEast,u.summary[n].southWest=i[0].summary.southWest,r=1;r<i.length;r++){var t=i[r].summary,f=u.summary[n].northEast.latitude>t.northEast.latitude?u.summary[n].northEast.latitude:t.northEast.latitude,e=u.summary[n].southWest.latitude<t.southWest.latitude?u.summary[n].southWest.latitude:t.southWest.latitude,o=u.summary[n].northEast.longitude>t.northEast.longitude?u.summary[n].northEast.longitude:t.northEast.longitude,s=u.summary[n].southWest.longitude<t.southWest.longitude?u.summary[n].southWest.longitude:t.southWest.longitude;u.summary[n].northEast=new l(f,o),u.summary[n].southWest=new l(e,s)}u.updateBoundingBoxWithBuffer(u.summary[n].northEast,u.summary[n].southWest)}}function w(n){if(n==null)return null;var t={};for(key in n)t[key]=typeof n[key]!="object"||n[key]instanceof Date||n[key]instanceof l||n[key]instanceof window[$MapsNamespace].Maps.Color||n[key]instanceof Array||key==="itineraryContainer"||key==="directionsTask"?n[key]&&n[key].clone?n[key].clone():n[key]:w(n[key]);return t}function h(n){return typeof f[n]=="object"?w(f[n]):f[n]}function nt(n,t){if(t&&typeof t=="object"){n==null&&(n=t),typeof t.routeIndex=="undefined"&&(typeof t.transitOptions!="undefined"||typeof t.routeMode!="undefined")&&(t.routeIndex=0);for(key in t)typeof t[key]!="undefined"&&(typeof n[key]!="object"||n[key]==null||n[key]instanceof Date||n[key]instanceof l||key==="itineraryContainer"||key==="directionsTask"||typeof t[key]!="object"||t[key]instanceof Date||t[key]instanceof l?((typeof n[key]==typeof t[key]||typeof n[key]=="undefined"||n[key]==null)&&((key==="routeMode"&&n[key]!==t[key]||key==="avoidTraffic"&&n[key]!==t[key]||key==="routeOptimization"&&n[key]!==t[key]||key==="routeAvoidance"&&n[key]!==t[key]||key==="timeType"&&n[key]!==t[key]||key==="distanceUnit"&&n[key]!==t[key])&&(key==="routeMode"&&u.stoppoints.length>2&&t[key]===o.transit?t[key]=n[key]:k()),key==="routeIndex"&&typeof t[key]=="number"?u.routes&&u.routes.length>0&&(t[key]>u.routes.length-1&&(t[key]=0),u.currentRouteLegs=u.routes[t[key]].routeLegs):key==="maxRoutes"&&(typeof t[key]!="number"||t[key]>du||t[key]<1)?t[key]=n[key]:key==="timeType"&&v!=="ja-jp"&&t[key]===et.lastAvailable?t[key]=n[key]:key==="routeAvoidance"&&v!=="ja-jp"&&t[key]>=s.avoidExpressTrain?t[key]=n[key]:key==="routeOptimization"&&v!=="ja-jp"&&(t[key]===ot.minimizeMoney||t[key]===ot.minimizeTransfers||t[key]===ot.minimizeWalking)&&(t[key]=n[key]),n[key]=t[key]),key==="transitTime"?(!t[key]instanceof Date&&(n[key]=null),k()):(key==="itineraryContainer"||key==="directionsTask")&&(n[key]=t[key])):nt(n[key],t[key]))}}function k(){u.summary=null,u.currentRouteLegs.length=0,u.routes=null}var u=this,e,rt,d,y,f;u.saveUserLocationEnabled=!1,u.stoppoints=[],u.inlineImagesCache=[],u.currentRouteLegs=[],u.summary=null,u.isLandingPage=!1,u.routes=null,u.sessionState=r,st._uniquePrefixId++,e=st._uniquePrefixId,u.TransitStepPinPrefixId=uf+e+"_",u.SteppinPrefixId=nf+e+"_",u.StoppointPinPrefixId=tf+e+"_",u.DisambiguationPinPrefixId=rf+e+"_",u.PolylinePrefixId=ff+e+"_",u.ItineraryPrefixId=lf+e+"_",rt="0",u.directionsStartTime=null,u.distanceUnitFromCookie="",d=u.distanceUnitFromCookie?u.distanceUnitFromCookie===bi?it.miles:it.kilometers:p.DistanceUnitMiles?it.miles:it.kilometers,y={routeAvoidance:s.none,avoidTraffic:pu,routeOptimization:ot.shortestTime,routeMode:ft(),routeIndex:0,maxRoutes:3,transitOptions:{transitTime:null,timeType:et.departure,showTransitStopSchedule:null,scheduleName:null},routeDraggable:!0,distanceUnit:d,itineraryContainer:null,waypointPushpinOptions:{height:48,width:44,anchor:new tt(38,41),textOffset:new tt(-10,4),draggable:p.WaypointDragging,hoverIcon:b.directionsImagePath+"pins/POI_flag_hover.png",icon:b.directionsImagePath+"pins/POI_flag_start.png",visible:ht?!1:!0},middleWaypointIcon:b.directionsImagePath+"pins/POI_flag_middle.png",lastWaypointIcon:b.directionsImagePath+"pins/POI_flag_end.png",stepPushpinOptions:{width:14,height:14,visible:!1,anchor:new tt(6,7),draggable:!1,icon:b.directionsImagePath+"pins/POI_step.png"},viapointPushpinOptions:{height:27,width:27,anchor:new tt(13,13),draggable:!0,visible:ht?!1:!0,icon:b.directionsImagePath+"pins/POI_dd-via-large.png"},drivingPolylineOptions:{strokeColor:new a.Color(nr,br,kr,dr),strokeThickness:tr},walkingPolylineOptions:{strokeColor:new a.Color(nr,au,vu,yu),strokeThickness:tr,strokeDashArray:"5 4"},transitPolylineOptions:{strokeColor:new a.Color(nr,br,kr,dr),strokeThickness:tr},autoUpdateMapView:!0,autoDisplayDisambiguation:!0,displayStepWarnings:!0,displayTrafficAvoidanceOption:!0,displayPreItineraryItemHints:!0,displayPostItineraryItemHints:!0,displayManeuverIcons:!0,displayDisclaimer:!1,displayWalkingWarning:!0,displayRouteSelector:!0,disambiguationPushpinOptions:{hoverIcon:b.directionsImagePath+"pins/poi_desktop_default_selected.png",icon:b.directionsImagePath+"pins/poi_desktop_default.png",width:28,height:28,visible:ht?!1:!0,anchor:new tt(14,14),textOffset:new tt(0,5)},displayRouteModeOptions:!1,displayWaypointDisambiguation:!1,displayLandingPage:!1},f=w(y),u.cloneOptions=w,u.resetDirectionState=function(n){var t,i;n?(n.removeAllWaypoints&&u._removeAllStoppoints(),n.resetRequestOptions&&(t=u.getRenderOptions(),f=w(y),u.setOptions(null,t)),n.resetRenderOptions&&(i=u.getRequestOptions(),f=w(y),u.setOptions(i,null))):(f=w(y),u._removeAllStoppoints()),k()},u.getOptions=function(){return f},u.getRenderOptions=function(){return{displayRouteModeOptions:f.displayRouteModeOptions,displayWaypointDisambiguation:f.displayWaypointDisambiguation,displayLandingPage:f.displayLandingPage,disambiguationPushpinOptions:h("disambiguationPushpinOptions"),directionsTask:f.directionsTask,itineraryContainer:f.itineraryContainer,waypointPushpinOptions:h("waypointPushpinOptions"),stepPushpinOptions:h("stepPushpinOptions"),middleWaypointIcon:f.middleWaypointIcon,lastWaypointIcon:f.lastWaypointIcon,viapointPushpinOptions:h("viapointPushpinOptions"),drivingPolylineOptions:h("drivingPolylineOptions"),walkingPolylineOptions:h("walkingPolylineOptions"),transitPolylineOptions:h("transitPolylineOptions"),autoDisplayDisambiguation:f.autoDisplayDisambiguation,displayStepWarnings:f.displayStepWarnings,displayPreItineraryItemHints:f.displayPreItineraryItemHints,displayPostItineraryItemHints:f.displayPostItineraryItemHints,displayManeuverIcons:f.displayManeuverIcons,displayRouteSelector:f.displayRouteSelector,displayTrafficAvoidanceOption:f.displayTrafficAvoidanceOption,displayWalkingWarning:f.displayWalkingWarning,displayDisclaimer:f.displayDisclaimer,autoUpdateMapView:f.autoUpdateMapView}},u.getRequestOptions=function(){return{routeIndex:f.routeIndex,routeMode:f.routeMode,routeAvoidance:f.routeAvoidance,routeOptimization:f.routeOptimization,avoidTraffic:f.avoidTraffic,distanceUnit:f.distanceUnit,maxRoutes:f.maxRoutes,transitOptions:h("transitOptions"),routeDraggable:f.routeDraggable}},u.setOptions=function(){for(var n,t=0;t<arguments.length;t++)n=arguments[t],n&&typeof n=="object"&&(typeof n.singleton!="undefined"&&(y.singleton=n.singleton),nt(f,n))},u.saveSessionRouteMode=function(){typeof VEShell!="undefined"&&typeof f.routeMode=="string"&&(u.sessionState.defaultRouteMode=f.routeMode)},u.getShellDirectionsTask=function(){var t=null,n;return typeof VEShell!="undefined"&&(n=f.directionsTask,t=n&&n.taskProvider),t},u.updateBoundingBoxWithBuffer=function(n,t){var i=gr*(n.latitude-t.latitude),r=gr*(n.longitude-t.longitude);n.latitude+=i,t.latitude-=i,n.longitude+=r,t.longitude-=r},u.addStoppoint=function(t,i){i===undefined?this.stoppoints[this.stoppoints.length]=t:this.stoppoints.splice(i,0,t),n.invoke(this,"waypointAdded",{waypoint:t})},u.updateRouteModeAndUnitBasedOnRouteResult=function(n){if(n)switch(n.requestedRouteMode){case 2:f.routeMode=o.walking;break;case 4:f.routeMode=o.transit;break;default:f.routeMode=o.driving}n.distanceUnit&&(f.distanceUnit=n.distanceUnit===bi?it.miles:it.kilometers)},u.removeModifiedLegs=function(n){for(var e=f.routeIndex,o=[],c,h,l,i,a,s,r,t=0;t<u.currentRouteLegs.length;t++){for(c=!1,i=0;i<u.stoppoints.length-1;i++)if((h=u.stoppoints[i],!h.isViapoint())&&(s=e+"~"+h._uniqueId+"~"+u.getNextWaypoint(h._uniqueId)._uniqueId,u.routes[e].routeLegs[t].legKey===s)){c=!0;break}c||(r=u.routes[e].routeLegs[t].legKey,o[o.length]=r,u.removeLeg(r),t--)}if(n&&n.length>0)for(t=0;t<u.currentRouteLegs.length;t++){for(l=!1,i=0;i<n.length;i++)if(a=n[i],s=e+"~"+u.stoppoints[a[0]]._uniqueId+"~"+u.stoppoints[a[1]]._uniqueId,u.routes[e].routeLegs[t].legKey===s){l=!0;break}l&&(r=u.routes[e].routeLegs[t].legKey,o[o.length]=r,u.removeLeg(r),t--)}return o},u.getUnavailableRouteWaypointIndexes=function(){for(var a=0,h=[],c,n,r,l,e,t,o,s,f,i=0;i<u.stoppoints.length-1;i++)if(c=!1,n=u.stoppoints[i],!n.isViapoint()){if(r=u.getNextWaypoint(n._uniqueId),u.routes)for(l=u.routes[a].routeLegs,e=0;e<l.length;e++)if(t=l[e],o=t.subLegs.length,t.legKey===a+"~"+n._uniqueId+"~"+r._uniqueId&&n.getLocation()&&r.getLocation()&&t.subLegs[0].actualStart.latitude===n.getLocation().latitude&&t.subLegs[0].actualStart.longitude===n.getLocation().longitude&&t.subLegs[o-1].actualEnd.latitude===r.getLocation().latitude&&t.subLegs[o-1].actualEnd.longitude===r.getLocation().longitude&&(!u.getAllViaInLeg||o===u.getAllViaInLeg(n._uniqueId).length+1)){c=!0;break}if(!c){for(s=new Array(2),s[0]=i,f=i+1;f<u.stoppoints.length;f++)if(u.stoppoints[f]._uniqueId===r._uniqueId){s[1]=f;break}h[h.length]=s}}return h},u.getStoppointIndex=function(n){for(var t=0;t<u.stoppoints.length;t++)if(n===u.stoppoints[t]._uniqueId)return t;return-1},u.getStoppointByIndex=function(n){for(var t=0;t<u.stoppoints.length;t++)if(t===n)return u.stoppoints[t];return null},u.getAllStoppointIds=function(){for(var t=[],n=0;n<u.stoppoints.length;n++)t[n]=u.stoppoints[n]._uniqueId;return t},u.getAllWaypoints=function(){for(var t=[],n=0;n<u.stoppoints.length;n++)u.stoppoints[n].isViapoint()||(t[t.length]=u.stoppoints[n]);return t},u.getViaCount=function(){var t=0,i,n;if(u.stoppoints)for(i=u.stoppoints.length,n=0;n<i;n++)u.stoppoints[n].isViapoint()&&t++;return t},u.removeEmptyWaypoints=function(){var e=!1,r,t,f;if(u.stoppoints.length>2)for(r=0;r<u.stoppoints.length;r++)if(t=u.stoppoints[r],t){if(f=i.Helper.index_of(u.stoppoints,t),t.isViapoint()&&e){f>=0&&(u.stoppoints.splice(f,1),n.invoke(u,"waypointRemoved",{waypoint:t})),r--;continue}!r||t.getAddress()||t.getLocation()?e=!1:(f>=0&&(u.stoppoints.splice(f,1),n.invoke(u,"waypointRemoved",{waypoint:t})),r--,e=!0)}u.removeModifiedLegs(null)},u.getStoppointById=function(n){for(var t=0;t<u.stoppoints.length;t++)if(u.stoppoints[t]._uniqueId===n)return u.stoppoints[t];return null},u.getPreviousStopPoint=function(n){for(var i=null,t=1;t<u.stoppoints.length;t++)u.stoppoints[t]._uniqueId===n&&(i=u.stoppoints[t-1]);return i},u.getPreviousWaypoint=function(n){for(var r=null,f=!1,i,t=0;t<u.stoppoints.length;t++){if(i=u.stoppoints[t],i._uniqueId===n){f=!0;break}i.isViapoint()||(r=u.stoppoints[t])}return f?r:null},u.getNextStoppoint=function(n){for(var i=null,t=0;t<u.stoppoints.length-1;t++)u.stoppoints[t]._uniqueId===n&&(i=u.stoppoints[t+1]);return i},u.getNextWaypoint=function(n){for(var r=null,f=!1,i,e,t=0;t<u.stoppoints.length-1;t++)if(u.stoppoints[t]._uniqueId===n){for(i=t+1;i<u.stoppoints.length;i++)if(e=u.stoppoints[i],!e.isViapoint()){r=u.stoppoints[i];break}f=!0;break}return f?r:null},u.getRouteLegByLegKey=function(n){for(var t=0;t<u.currentRouteLegs.length;t++)if(u.currentRouteLegs[t].legKey===n)return u.currentRouteLegs[t];return null},u.removeStoppoint=function(t,i){for(var e=!1,o=-1,f,s,r=0;r<u.stoppoints.length;r++){if(f=u.stoppoints[r],e=f.isViapoint(),f._uniqueId===t){u.stoppoints.splice(r,1),n.invoke(u,"waypointRemoved",{waypoint:f});break}e||(o=r)}if(!e&&i)for(r=o+1;r<u.stoppoints.length;r++)if(u.stoppoints[r].isViapoint())s=u.stoppoints[r],u.stoppoints.splice(r,1),n.invoke(u,"waypointRemoved",{waypoint:s}),r--;else break;u.removeModifiedLegs(null)},u.reverseWaypoints=function(){var n,t,i;for(u.removeAllViaPoint&&u.removeAllViaPoint(),n=u.stoppoints.length,t=0;t<n-1;t++)i=u.stoppoints[n-1],u.stoppoints.splice(n-1,1),u.stoppoints.splice(t,0,i)},u.addInlineImages=function(n){if(n)for(var t in n)u.inlineImagesCache[t]=n[t]},u.addRoutes=function(n,t){var s,r,i;if(t&&t.length!==0){if(f.routeMode===o.transit||!u.routes)for(n||f.routeMode!==o.transit||(n=[],n[0]=[0,1]),u.routes=new Array(t.length),i=0;i<t.length;i++)u.routes[i]={},u.routes[i].routeLegs=[];for(s=f.routeIndex,(u.stoppoints.length>2||u.routes&&s>=u.routes.length)&&u.setOptions({routeIndex:0}),u.currentRouteLegs=u.routes[f.routeIndex].routeLegs,r=0;r<t.length;r++)for(i=0;i<t[r].routeLegs.length;i++){var h=n[i],c=h[0],l=h[1],e=t[r].routeLegs[i];e.legKey=r+"~"+u.stoppoints[c]._uniqueId+"~"+u.stoppoints[l]._uniqueId,e.startWaypointLocation=u.stoppoints[c].getLocation(),e.endWaypointLocation=u.stoppoints[l].getLocation(),u.addLegAndUpdateWaypoints(t[r].routeLegs[i],r),f.routeMode===o.transit&&ut(t[r].routeLegs[i].itineraryItems)}}},u.addLegAndUpdateWaypoints=function(n,t){var a,v,o,r,f,h;u.summary||(u.summary=new Array(0)),u.summary[t]||(u.summary[t]={},u.summary[t].distance=0,u.summary[t].time=0,u.summary[t].timeWithTraffic=0),u.summary[t].distance+=n.summary.distance,u.summary[t].time+=n.summary.time,u.summary[t].timeWithTraffic+=n.summary.timeWithTraffic;for(var y=n.legKey.split("~"),c=0,i=0,i=0;i<u.stoppoints.length;i++){if(u.stoppoints[i]._uniqueId===parseInt(y[1])){u.routes[t].routeLegs.splice(c,0,n);break}u.stoppoints[i].isViapoint()||c++}for(a=0;i<u.stoppoints.length-1;i++)if(n.subLegs[a++].subLegKey=t+"~"+u.stoppoints[i]._uniqueId+"~"+u.stoppoints[i+1]._uniqueId,!u.stoppoints[i+1].isViapoint())break;for(v=n.subLegs[0].subLegKey.split("~")[1],o=u.getStoppointById(parseInt(v)),o.setOptions({location:new l(n.subLegs[0].actualStart.latitude,n.subLegs[0].actualStart.longitude)}),o._locationIdentifier=n.subLegs[0].startLocationIdentifier,i=0;i<n.subLegs.length;i++){var p=n.subLegs[i].subLegKey.split("~")[2],e=u.getStoppointById(parseInt(p)),s=e.getAddress();s&&(r=n.itineraryItems,r.length>0&&(f=r[r.length-1].formattedText,f=f.replace(new RegExp("<WaypointName>.*<\/WaypointName>","gi"),"<WaypointName>"+s+"<\/WaypointName>"),f=f.replace(new RegExp("<EndLocation>.*<\/EndLocation>","gi"),"<EndLocation>"+s+"<\/EndLocation>"),r[r.length-1].formattedText=f)),h={location:new l(n.subLegs[i].actualEnd.latitude,n.subLegs[i].actualEnd.longitude)},e.isViapoint()&&(h.address=n.subLegs[i].endDescription),e.setOptions(h),e._locationIdentifier=n.subLegs[i].endLocationIdentifier}g(t)},u.removeLeg=function(n){for(var r=parseInt(n.split("~")[0]),t,e,f=0;f<u.currentRouteLegs.length;f++)if(t=u.currentRouteLegs[f],t.legKey===n){u.summary[r].distance-=t.summary.distance,u.summary[r].time-=t.summary.time,u.summary[r].timeWithTraffic-=t.summary.timeWithTraffic,e=i.Helper.index_of(u.currentRouteLegs,t),e>=0&&u.currentRouteLegs.splice(e,1),g(r);break}},u.persistResolvedWaypoint=function(n,t){var e={failed:!1,invalidCredentials:!1},r,f,i;if(n[wi]&&(r=n[wi][0],r&&r.length===t.length))for(f=0;f<u.stoppoints.length;f++)for(i=0;i<t.length;i++)u.stoppoints[f]._uniqueId===t[i]&&r[i]&&(r[i].failed?e.failed=!0:r[i].invalidCredentials?e.invalidCredentials=!0:u.stoppoints[f]._updateWaypoint(r[i]));return e},u.validateAndUpdateWhatOnlyWaypointDisambiguation=function(){var i,t,e;if(this.stoppoints.length)for(i=this.stoppoints[0],t=1;t<this.stoppoints.length;t++){var n=this.stoppoints[t],r=n.getDisambiguationResult(),u=r?r.dependentLocation:null,f=i.getLocation();r&&n._inputType===pr.whatOnly&&u&&(!f||u.latitude.toFixed(c)!==f.latitude.toFixed(c)||u.longitude.toFixed(c)!==f.longitude.toFixed(c))&&(e=n.getAddress(),n.clear(),n.setOptions({address:e})),i=n}},u._getPrefixId=function(){var n="";return f.itineraryContainer&&f.itineraryContainer.id?(n=f.itineraryContainer.id,f.singleton||(n+=e+"_")):n=u.ItineraryPrefixId,n},u._removeAllStoppoints=function(){while(u.stoppoints.length){var t=u.stoppoints[u.stoppoints.length-1];u.stoppoints.pop(t),n.invoke(u,"waypointRemoved",{waypoint:t})}k()},u.dispose=function(){k(),u._removeAllStoppoints(),f=null,y=null,u.inlineImagesCache=null}}function ni(s,a,v){function ki(){var t=!1,n=p.getShellDirectionsTask();return n&&(t=n.get_isPermalinkRequest()&&!n.get_isBackButtonRequest()),t}function fr(t){var i=t.waypoint;d.push(n.addHandler(i,"changed",r(w,sr))),d.push(n.addHandler(i,"reverseGeocoded",r(w,hr))),di(i),n.invoke(rt,"waypointAdded",{waypoint:i})}function or(t){var i=t.waypoint;bi(i),n.invoke(rt,"waypointRemoved",{waypoint:i}),i.dispose()}function sr(n){var t=n.waypoint;it&&!k&&(et.clearRoute(null,!1),tt&&(tt._removePushpins(p.SteppinPrefixId),tt._removePushpins(p.StoppointPinPrefixId),tt._removePushpins(p.TransitStepPinPrefixId),tt.createPushpins(p.getAllWaypoints())),it._waypointChanged(t)),di(t),ut!==-1&&p.isRoutableLatLongAvailableForAllStopPoints&&p.isRoutableLatLongAvailableForAllStopPoints()&&tr(p.stoppoints)}function di(n){n._address&&!n._location&&p.getOptions().displayLandingPage?ti.resolveWaypoint(g,n,null,-1,null,w._permalinkHelper):!n._address&&n._location&&ti.reverseGeocode(g,n._location,r(w,nr),r(w,nr),n,w._permalinkHelper)}function nr(n,t){var i="",r="",u;n&&(i=n.formattedAddress,r=n.shortFormattedAddress),i||(u=t.getLocation(),i=u.latitude.toFixed(c)+","+u.longitude.toFixed(c),r=i),t.setOptions({address:i,shortAddress:r}),t._reverseGeocoded()}function hr(n){var t=n.waypoint;k&&k.updateReverseGeocodedText(t),it&&it.updateReverseGeocodedText(t)}function ot(t,i){var r=!1;return n.hasHandler(rt,t)&&(n.invoke(rt,t,i),r=i.handled),r}function cr(n){ot("mouseEnterStep",n)||(k&&k._onMouseEnterStepUnhandled(n),tt&&p.getOptions().routeMode!==o.transit&&tt.displayStepPushpin(n.location,n.stepNumber))}function lr(n){ot("mouseLeaveStep",n)||(k&&k._onMouseLeaveStepUnhandled(n),tt&&p.getOptions().routeMode!==o.transit&&tt.hideStepPushpin())}function ar(n){!ot("itineraryStepClicked",n)&&g&&(g.setView({center:n.location,zoom:16}),p.getOptions().routeMode!==o.transit&&tt&&tt.displayStepPushpin(n.location,n.stepNumber))}function vr(n){lt&&window.clearTimeout(lt),lt=window.setTimeout(r(w,function(){if(lt=null,!ot("mouseEnterRouteSelector",n)&&g){et.clearRoute(null,!1);var t=p.routes[n.routeIndex].routeLegs;et.updateRouteOnMapControl(t,!0,!1),et.updateRouteOnMapControl(p.currentRouteLegs,!0,!0),tt&&tt.createTransitStepPushpins&&tt.createTransitStepPushpins(t)}}),wu)}function yr(n){if(lt){window.clearTimeout(lt),lt=null;return}if(!ot("mouseLeaveRouteSelector",n)&&g){et.clearRoute(null,!1),et.updateRouteOnMapControl(p.currentRouteLegs,!1,!1);var t=p.currentRouteLegs;tt&&tt.createTransitStepPushpins&&tt.createTransitStepPushpins(t)}}function pr(n){ot("routeSelectorClicked",n)||(p.setOptions({routeIndex:n.routeIndex}),w._setViewPortForSelectedRoute(),typeof VEShell!="undefined"&&VEShell.Logging.get_instance().logSubmit(n.containerElement.id),wi())}function wr(t){k.createRouteSelectorItem&&!ot("beforeRouteSelectorRender",t)&&k.createRouteSelectorItem(t.containerElement,t.routeLeg,t.routeIndex),delete t.handled,n.invoke(rt,"afterRouteSelectorRender",t)}function br(t){ot("beforeStepRender",t)||k.createSingleItineraryStep(t.step,t.prevStep,t.stepIndex,t.routeLegIndex,t.containerElement,t.lastStep),delete t.handled,n.invoke(rt,"afterStepRender",t)}function kr(t){!ot("beforeWaypointRender",t)&&k._createNewWaypoint&&k._createNewWaypoint(t.waypoint,t.containerElement),delete t.handled,n.invoke(rt,"afterWaypointRender",t)}function dr(t){ot("beforeSummaryRender",t)||(k._directionsPanel.appendChild(t.containerElement),k.createRouteSummary(t.summary,t.routeLegIndex,t.containerElement)),delete t.handled,n.invoke(rt,"afterSummaryRender",t)}function gr(n){ot("itineraryCreated",n)}function bt(i,u,f,e){p.getOptions().displayLandingPage&&(gt(),pi(),it?it.dispose():(it=new gi(g,tt,w._permalinkHelper,p),d.push(n.addHandler(rt,"beforeDisambiguationRender",it._createWaypointDisambiguation)),d.push(n.addHandler(it,"updateDirections",r(w,w.setDirections))),d.push(n.addHandler(it,"optionsChanged",r(w,function(n){!n.clearResultsPage&&(k||n.refreshLandingPage)?w.setDirections():(n.refreshLandingPage||k)&&(n.clearResultsPage&&!n.refreshLandingPage?(gt(),kt(),it.createLandingPushpins(),it._setFocus()):bt(!0,!0,"")),typeof DirectionsShell!="undefined"&&DirectionsShell.DirectionShellUtility.updatePageTitle&&DirectionsShell.DirectionShellUtility.updatePageTitle(!0)})))),i&&(kt(),it.createLandingPushpins()),it._createLandingPage(f,e),t._reRenderDirectionsPanel(p._getPrefixId()),n.invoke(rt,"landingPageUpdated",{updateHistory:u}),window.setTimeout(it._setFocus,100))}function nu(t){t.failed?(w._setViewPortForSelectedRoute(),w.setDirections()):(p.getViaCount()>0&&p.setOptions({avoidTraffic:!1}),p.setOptions({routeIndex:0}),w.setDirections()),n.invoke(rt,"dragDropCompleted",{})}function tu(n){ir(n.cordinates)}function yt(t,i){var c=p.getOptions(),f=c.routeMode,r,s,e;if(t===h.invalidCredentials)r=u.getString("L_InvalidCredentials_Text");else if(t===h.tooFar)r=u.getString("L_DirectionsTripLengthTooLong_Text"),f===o.walking?r=u.getString("L_WalkingDirectionsTripLengthTooLong_Text"):f===o.transit&&(r=u.getString("L_TransitTripLengthTooLong_Text"));else if(t===h.timeout||t===h.cacheMiss||t===h.searchServiceFailed||t===h.unknownError)r=u.getString("L_RouteErrorServerBusy_Text"),f===o.walking?r=u.getString("L_WalkingRouteErrorServerBusy_Text"):f===o.transit&&(r=u.getString("L_TransitRouteErrorServerBusy_Text"));else if(t!==h.success)switch(f){case o.driving:r=u.getString("L_DrivingDirectionNotAvailable_Text");break;case o.walking:r=u.getString("L_WalkingDirectionNotAvailable_Text");break;case o.transit:r=u.getString("L_TransitDirectionNotAvailable_Text")}if(t===h.waypointDisambiguation?r=u.getString("L_WaypointDisambiguationError_Text"):t===h.hasEmptyWaypoint?r=u.getString("L_EmptyWaypointError_Text"):t===h.atleastTwoWaypointsRequired?r=u.getString("L_AtleastTwoWaypointsRequiredError_Text"):t===h.firstOrLastStoppointIsVia?r=u.getString("L_FirstOrLastStoppointIsViaError_Text"):t===h.exceedMaxWaypointLimit&&(r=u.getString("L_ExceedMaxWaypointLimitError_Text").replace("{0}",dt)),f===o.transit)switch(t){case h.dataSourceNotFound:case h.cannotFindNearbyRoad:r=u.getString("L_TransitNotAvailableWarning_Text");break;case h.noSolution:r=u.getString("L_TransitDirectionNoSolution_Text");break;case h.exceedMaxWaypointLimit:r=u.getString("L_ExceedMaxTransitWaypointLimitError_Text");break;case h.noAvailableTransitTrip:r=u.getString("L_TransitDirectionNoAvailableTransitTrip_Text");break;case h.outOfTransitBounds:r=u.getString("L_TransitDirectionOutOfTransitBounds_Text");break;case h.transitStopsTooClose:case h.walkingBestAlternative:r=u.getString("L_TransitDirectionTooClose_Text")}r&&typeof gi!="undefined"&&bt(!0,!0,r,t),t!==h.success&&(s=!1,e={},t===h.waypointDisambiguation&&(s=iu(i),s?n.invoke(rt,"disambiguationAdded",{waypoint:i,waypointIndex:p.getStoppointIndex(i._uniqueId)}):e.waypoint=i),s||(e.responseCode=t,e.message=r,n.invoke(rt,"directionsError",e)))}function iu(t){var s=!1,h=p.getOptions(),o,l,u;if(h.autoDisplayDisambiguation&&t){var c=t.getDisambiguationContainer(),f=p._getPrefixId(),a=h.routeMode;c||(fi.createDirectionPanel(h.itineraryContainer,f,a),c=i("#"+f+vi).element()),o={waypoint:t,containerElement:c},ot("beforeDisambiguationRender",o)?s=o.handled:(at||(at=new eu(g,tt,!0,!0,p,w._permalinkHelper),d.push(n.addHandler(at,"selected",r(w,ru)))),l=o.containerElement,u=null,l&&(u=i("#"+f+"DisambiguationContainer").element(),u?u.innerHTML="":u=e(f+"DisambiguationContainer","MicrosoftMap dd_disambgContainer",l)),at.addDisambiguationControl(u,t),s=!0)}return s}function ru(n){var r,t,u;ot("disambiguationSuggestionSelected",n)||(r=n.waypoint,t=i("#"+p._getPrefixId()+"DisambiguationContainer").element(),t&&t.parentNode&&t.parentNode.removeChild(t),u=n.newWaypointOptions,r.clear(),r.setOptions(u),w.setDirections())}function ai(n){var i,t;if(p.getAllWaypoints().length<2)return n?yt(h.atleastTwoWaypointsRequired):bt(!0,!0,""),!1;for(i=p.stoppoints.length,t=0;t<i;t++)if(!p.stoppoints[t].getLocation()&&!p.stoppoints[t].getAddress())return n?yt(h.atleastTwoWaypointsRequired,p.stoppoints[t]):bt(!0,!0,""),!1;if(p.stoppoints[0].isViapoint()||p.stoppoints[i-1].isViapoint())return yt(h.firstOrLastStoppointIsVia),!1;for(p.validateAndUpdateWhatOnlyWaypointDisambiguation(),count=p.stoppoints.length,t=0;t<count;t++)if(!p.stoppoints[t].getLocation()){if(p.stoppoints[t].getDisambiguationResult())return yt(h.waypointDisambiguation,p.stoppoints[t]),!1;break}return!0}function uu(i,r){var v,u,e,y,s,c,l,a,f,b;if(t.toggleTaskProgressIndicator(!1,p),v=!0,u=h.success,r&&r.success&&i){e="d_none",y=hi();switch(p.getOptions().routeMode){case o.driving:e="d_driving";break;case o.walking:e="d_walking";break;case o.transit:e="d_transit"}li({at:e,TS_hr:y}),s=r.userData,c=s[0],p.removeModifiedLegs(c),l=p.persistResolvedWaypoint(i,s[1]),l.invalidCredentials?u=h.invalidCredentials:l.failed&&(u=h.searchServiceFailed),ai()&&(p.saveUserLocationEnabled&&DirectionsShell.DirectionShellUtility.storeAnonymousLocations(p.stoppoints),a=i.routeResults,a&&(f=a[0],f.routeResponseCode===h.success?(v=!1,p.addInlineImages(f.inlineImageCache),p.addRoutes(c,f.routes),p.updateRouteModeAndUnitBasedOnRouteResult(f),b=p.getOptions().routeIndex,(p.stoppoints.length>2||p.routes&&b>=p.routes.length)&&p.setOptions({routeIndex:0}),w._setViewPortForSelectedRoute(),wi(),typeof DirectionsShell!="undefined"&&DirectionsShell.DirectionShellUtility.updatePageTitle&&DirectionsShell.DirectionShellUtility.updatePageTitle(),pt.end("Directions Completed","setDirections"),li({TS_prc:hi()}),n.invoke(rt,"directionsUpdated",{routeSummary:p.summary,route:p.routes})):(u=f.routeResponseCode,f.invalidCredentials&&(u=h.invalidCredentials))))}else u=r&&!r.success?h.timeout:h.unknownError;u!==h.success&&yt(u),ut=-1}function hu(n,i){var r,u;t.toggleTaskProgressIndicator(!1,p),r=h.success,i&&i.success&&n?(u=n.TransitInfoByStopId&&n.TransitInfoByStopId[0],lu(u)):r=i&&!i.success?h.timeout:h.unknownError,r!==h.success&&yt(r),ut=-1}function cu(){w.setDirections()}function pi(){i("#"+p._getPrefixId()+yi).set_html("")}function lu(n){function rt(n,t,i){for(var e=ut(t,i),f,u=0;u<r.childNodes.length;u++)if(f=r.childNodes[u],f.departure&&f.departure.getTime()>e.departure.getTime()){n.insertBefore(e,f);return}n.appendChild(e)}function ut(n,r){var l=t._parseCustomDateTime(r.departure),o=f("tr"),u,s,h,a,v,c;return o.departure=l,u=f("td",null,null,o),a=n.AbbreviatedName,a.length<=7?(s=u,u.className="dd_schCell1",h=f("td",null,"dd_schSubTitle",o)):(s=e(null,null,u),h=e(null,"dd_schSubTitle",u),u.colSpan=2),v=i(s).add_class("dd_stopTitle"),s.appendChild(document.createTextNode(n.AbbreviatedName)),h.appendChild(document.createTextNode(r.headsign)),t._isTransitTrainLineAgencyId(n.AgencyId)&&t._addTransitTrainLineLinkElements(h,"MSAF","dd_schTransitBuyTickets"),c=f("td",null,"dd_stopTime",o),c.appendChild(document.createTextNode(t._getFormattedTime(l))),o}function ft(n){f("span",v+"MessageContainer","dd_messageContainer",r,n)}var v=p._getPrefixId(),r,d,et,y,w,s,k,o,c,l,nt,a,tt;gt(),pi(),it&&it.dispose(),r=i("#"+v+yi).element(),d=p.getOptions().transitOptions.scheduleName||u.getString("L_TransitDefaultTitle_Text"),e(null,"dd_stopHeader",r).appendChild(document.createTextNode(d)),et=e(null,null,r),y=e(null,"dd_calendarContainer",r),fu(p,"ScheduleTime",y,null),i(t._addInputElement(v+"UpdateSchedule","button goButton",y,u.getString("L_TransitUpdateSchedule_Text"),"Submit","")).add_event("click",cu),w=e(null,"dd_schHeader",r),e(null,"dd_schHeaderRoutes",w).appendChild(document.createTextNode(u.getString("L_TransitScheduleRoutes_Text"))),e(null,"dd_schHeaderDeparts",w).appendChild(document.createTextNode(u.getString("L_TransitScheduleDeparts_Text")));var ot=f("table",null,null,r),st=f("tbody",null,null,ot),b=h.success,g=!1;for(s=0;s<n.length;s++){if(k=n[s],b==h.success&&(b=k.responseCode),o=k.scheduleTimeInfo,o)for(c=0;c<o.length;c++)for(l=o[c],nt=l.Line,a=0;a<l.Trips.length;a++)tt=l.Trips[a],g=!0,rt(st,nt,tt);o&&g||ft(u.getString("L_TransitScheduleUnavailable_Text"))}return b}function wi(){g&&(pt.start("resultPage-Route"),et.clearRoute(null,!1),et._removeAllTemporaryRoutes(),ht&&n.invoke(rt,"beforeRouteRender",{}),et.updateRouteOnMapControl(p.currentRouteLegs,!1,!1),tt&&tt.createAllPushpins(p.currentRouteLegs,p.stoppoints),pt.end("Directions-route","resultPage-Route"));var i=p.getOptions();!ht&&i.itineraryContainer&&(pt.start("resultPage-itinerary"),typeof bt!="undefined"&&bt(!1,!1,""),gt(),pi(),k=vt.getNewResultsPage(g,tt,w._permalinkHelper,p),d.push(n.addHandler(k,"updateDirections",r(w,w.setDirections))),d.push(n.addHandler(k,"mouseEnterStep",r(w,cr))),d.push(n.addHandler(k,"mouseLeaveStep",r(w,lr))),d.push(n.addHandler(k,"itineraryStepClicked",r(w,ar))),d.push(n.addHandler(k,"beforeStepRender",r(w,br))),d.push(n.addHandler(k,"beforeWaypointRender",r(w,kr))),d.push(n.addHandler(k,"beforeSummaryRender",r(w,dr))),d.push(n.addHandler(k,"beforeRouteSelectorRender",r(w,wr))),d.push(n.addHandler(k,"mouseEnterRouteSelector",r(w,vr))),d.push(n.addHandler(k,"mouseLeaveRouteSelector",r(w,yr))),d.push(n.addHandler(k,"routeSelectorClicked",r(w,pr))),d.push(n.addHandler(k,"setMapView",r(w,function(){w._setViewPortForSelectedRoute()}))),d.push(n.addHandler(k,"itineraryCreated",r(w,gr))),ii=n.addHandler(g,"viewchangeend",r(w,au)),d.push(ii),ri=n.addHandler(g,"tiledownloadcomplete",r(w,vu)),d.push(ri),k.createResultsPage(),t._reRenderDirectionsPanel(p._getPrefixId()),pt.end("Directions-itinerary","resultPage-itinerary"),n.invoke(rt,"itineraryUpdated",{}))}function au(){g.isDownloadingTiles()||ur()}function vu(){ur()}function tr(n){var u=p.getOptions(),t;if(u.autoUpdateMapView&&!(ei||ht)&&!ki()){var i=[],f=n.length,r=!0;for(t=0;t<f;t++)if(n[t]&&n[t].getLocation())i[t]=n[t].getLocation();else{r=!1;break}r&&ir(i)}}function ir(n){var e,o,s,t,i,r,u,f,h;if(g)if(e=n.length,e)if(e===1)o=n[0],s={center:new l(o.latitude,o.longitude),zoom:ef},g.setView(s);else{for(t=n[0].clone(),i=new l(t.latitude,t.longitude),f=1;f<e;f++)r=n[f].latitude,u=n[f].longitude,t.latitude>r&&(t.latitude=r),t.longitude>u&&(t.longitude=u),i.latitude<r&&(i.latitude=r),i.longitude<u&&(i.longitude=u);p.updateBoundingBoxWithBuffer(i,t),h=oi.fromEdges(i.latitude,t.longitude,t.latitude,i.longitude),g.setView({bounds:h})}else return}function kt(){g&&(et.clearRoute(null,!1),tt&&tt.removeAllPushpins())}function bi(t){for(var i=d.length;i--;)t&&d[i].target===t&&(n.removeHandler(d[i]),d.pop(d[i])),t||n.removeHandler(d[i]);t||(d=[])}function gt(){k&&(k.dispose(),bi(k),k=null)}function hi(){return(new Date).getTime()}function yu(n){ct&&ct.beginBatchedAction(ni,n)}function li(n){ct&&ct.logBatchedEvent(ni,n)}function ur(){li({TS_mvrc:hi()}),pu(),ii&&n.removeHandler(ii),ri&&n.removeHandler(ri)}function pu(){ct&&(ct.computeTotalDuration(ni,rr,"TS_td"),ct.endBatchedAction(ni))}var w=this,rt=a,p=new st(v),g=s,ct,wt,et,si,ni,rr;w.options=null,w._eros=null;var it=null,k=null,lt=null,at=null;w._permalinkHelper=new ui(g,p);var ut=-1,d=[],tt=null,ii=null,ri=null;g&&(ct=g.getComponent("analyticsProxy"),typeof su!="undefined"&&(wt=new su(g)),typeof ci!="undefined"&&(tt=new ci(g,p,wt),d.push(n.addHandler(tt,"disambiguationPushpinsAdded",r(w,tu)))),et=new yf(g,p),typeof ou!="undefined"&&(si=new ou(tt,et,p,g,w._permalinkHelper,wt),d.push(n.addHandler(si,"dropCompleted",r(w,nu))))),d.push(n.addHandler(p,"waypointAdded",r(w,fr))),d.push(n.addHandler(p,"waypointRemoved",r(w,or))),w.setDirections=function(i){var c,f,e,u,o,s,h;nt.isRequestCompleted(ut)||(nt.abortRequest(ut),t.toggleTaskProgressIndicator(!1,p)),c=!1,c=i?ai(i.needsTwoWaypoints):ai(!1),s=p.getOptions(),c?(yu({TS_rsth:hi()}),p.directionsStartTime&&(li({TS_bc:p.directionsStartTime}),p.directionsStartTime=null),pt.start("setDirections"),w.clearDisplay(),h=p.getUnavailableRouteWaypointIndexes(),h.length>0&&p.stoppoints.length>=2?t.getCredentials(g,r(w,function(n){f=w._permalinkHelper.generateGetDirectionsLink(h,p.stoppoints,n),e=t.convertPermalinkDictionaryToPermalink(f),u=b.directionsService+e;var i=[];i[0]=h,i[1]=p.getAllStoppointIds(),o=r(w,uu),t.toggleTaskProgressIndicator(!0,p),ut=nt.getObjectAsync(u,o,i,er,t.GetUniqueNetworkRequestId(u)),tr(p.stoppoints)})):(wi(),pt.end("Directions Completed-cache","setDirections"),n.invoke(rt,"directionsUpdated",{routeSummary:p.summary,route:p.routes}))):s.transitOptions.showTransitStopSchedule&&s.transitOptions.showTransitStopSchedule.length?t.getCredentials(g,r(w,function(n){var i=s.transitOptions.showTransitStopSchedule;w.clearDisplay(),f=w._permalinkHelper.generateGetTransitScheduleLink(i,n),e=t.convertPermalinkDictionaryToPermalink(f),u=b.directionsService+e,o=r(w,hu),t.toggleTaskProgressIndicator(!0,p),ut=nt.getObjectAsync(u,o,null,er,t.GetUniqueNetworkRequestId(u))})):it||kt()},w._setViewPortForSelectedRoute=function(n){var i=p.getOptions(),t,r;g&&p.summary&&(i.autoUpdateMapView||n)&&!ki()&&(t=p.summary[i.routeIndex],t&&(r=oi.fromEdges(t.northEast.latitude,t.southWest.longitude,t.southWest.latitude,t.northEast.longitude),g.setView({bounds:r})))},w.clearDisplay=function(){kt(),gt()},w.resetDirections=function(n){w.clearDisplay(),p.resetDirectionState(n)},w.addWaypoint=function(n,t){if(n instanceof ft){var i=p.getOptions();i.routeMode===o.transit&&p.removeEmptyWaypoints(),p.stoppoints.length>=dt&&i.routeMode!==o.transit||p.stoppoints.length>=2&&i.routeMode===o.transit?yt(h.exceedMaxWaypointLimit):(p.addStoppoint(n,t),nt.isRequestCompleted(ut)||(nt.abortRequest(ut),w.setDirections()))}},w.removeWaypoint=function(n,t){var i=null;i=typeof n=="number"?p.getStoppointByIndex(n):n,i instanceof ft&&(nt.isRequestCompleted(ut)?p.removeStoppoint(i._uniqueId,t):(nt.abortRequest(ut),p.removeStoppoint(i._uniqueId,t),p.stoppoints.length>=2&&w.setDirections()))},w.setOptions=function(n,t){nt.isRequestCompleted(ut)?p.setOptions(n,t):(nt.abortRequest(ut),p.setOptions(n,t),w.setDirections())},w.setRenderOptions=function(n){w.setOptions(null,n)},w.setRequestOptions=function(n){w.setOptions(n,null)},w.getWaypointInput=function(n){var t=null,r;return n&&(r=p._getPrefixId()+"WaypointInput"+n._uniqueId,t=i(p.getOptions().itineraryContainer).select("#"+r)[0]),t},w.getPanel=function(){return y(p._getPrefixId()+"Panel")},w.getNearbyArterials=function(n,t,i,r){n instanceof l&&t&&ti.getNearbyArterialsResults(g,n,t,i,r,w._permalinkHelper)},w.reverseGeocode=function(n,t,i,r){n instanceof l&&t&&ti.reverseGeocode(g,n,t,i,r,w._permalinkHelper)},w._getState=function(){return p},ni="ST.Direction",rr=["TS_bc","TS_rsth","TS_hr","TS_prc","TS_mvrc",],w.dispose=function(){kt(),ut!=-1&&(nt.abortRequest(ut),ut=-1),at&&(at.dispose(),at=null),k&&(k.dispose(),k=null),it&&(it.dispose(),it=null),bi(null),g&&(wt&&(wt.dispose(),wt=null),tt&&tt.dispose(),et.dispose(),si&&si.dispose()),p&&(p.dispose(),p=null)}}function eu(o,s,h,c,a,v){function it(o){var h=o.getDisambiguationResult(),l=h.locationSuggestions.length>0,ot=l?h.locationSuggestions.length:h.businessSuggestions.length,a,s,k,vt,d,yt,it,ut;if(b){b.innerHTML="",et&&(a="",a=ei?u.getString("L_DisambiguationGeneralMessageb2b_Text").replace("{0}",o.getAddress()):ht?o._uniqueId===g.stoppoints[0]._uniqueId?u.getString("L_DisambiguationMessageFromMbing_Text"):u.getString("L_DisambiguationMessageToMbing_Text"):u.getString("L_DisambiguationGeneralMessage_Text"),ot>1?f("span",p+"DisambiguationMessage2"+o._uniqueId,"headerText",b,a):ot>0?f("span",p+"DisambiguationMessage"+o._uniqueId,"headerText",b,a):f("span",p+"DisambiguationMessage"+o._uniqueId,"headerText",b,h.headerText));var v=e(p+"DisambiguationChoicesPanel"+o._uniqueId,"",b),pt=f("ul","","",v,""),c=0;for(h.businessSuggestions.length>0&&(c=h.businessSuggestions[0].index),s=0;s<ot;s++)k=f("li",p+"DisambiguationAddress_"+o._uniqueId+"_"+s,"",pt,""),vt="dd_DisambgStepLetter",s+1+c>=10&&(vt+=" dd_TwoDigitsDisambgPushPin"),f("span",p+"DisambiguationPushpin_"+o._uniqueId+"_"+s,vt,k,(c+1+s).toString()),d=e(p+"DisambiguationAddressContainer"+o._uniqueId,l?"dd_LocDisambgAddressContainer":"dd_BizDisambgAddressContainer",k),yt=t._addAnchorElementWithEncodeOption(p+"DisambiguationAddressLink"+o._uniqueId+s,"",d,l?h.locationSuggestions[s].formattedSuggestion:h.businessSuggestions[s].name,"",!1),i(yt).add_event("click",r(w,at),!1),l||(f("div","","",d,h.businessSuggestions[s].address),h.businessSuggestions[s].isApproximate&&f("div","","disambgLocationApprox",d,u.getString("L_ApproximateLocation_Text"))),it=i(k),it.add_event("mouseenter",r(w,lt),!0).add_event("mouseleave",r(w,ct),!0),it.set_attr("WaypointUniqueId",o._uniqueId).set_attr("SuggestionsIndex",s.toString()),it.select("*").set_attr("WaypointUniqueId",o._uniqueId).set_attr("SuggestionsIndex",s.toString());h.businessSuggestions.length>0&&(c>0&&rt(!0,v,o._uniqueId,!1,c-tu),h.hasMoreSuggestions&&(c>0&&f("span","","",v,"|"),rt(!1,v,o._uniqueId,!c,c+tu)))}tt&&y&&y.createDisambiguationPushpin&&(y.removeDisambiguationPushpins(o),y.createDisambiguationPushpin(o),nt=n.addHandler(y,"selected",r(w,ft))),ni&&ni.makeDummyRequest&&(ut={},ut.query=o.getAddress(),ut.queryType=l?"L":"B",ni.makeDummyRequest(st,!0,ut))}function ct(n){ut(n.target,!1)}function lt(n){ut(n.target,!0)}function rt(n,t,f,e,o){var s=k(n?p+"DisambiguationPreviousLink":p+"dd_DisambgNextLink",n?"dd_DisambgPreviousLink":e?"dd_DisambgNextLinkFirstPage":"dd_DisambgNextLink",t,n?u.getString("L_Previous_Text"):u.getString("L_Next_Text"),"#");s.setAttribute("StartingIndex",o),s.setAttribute("WaypointUniqueId",f),i(s).add_event("click",r(w,vt),!1)}function ut(n,t){var f=i(n),e=p+"DisambiguationPushpin",o=p+"DisambiguationAddress",r=f.get_attr("WaypointUniqueId"),u=parseInt(f.get_attr("SuggestionsIndex"));t?i("#"+e+"_"+r+"_"+u).add_class("dd_DisambgStepLetterHover"):i("#"+e+"_"+r+"_"+u).remove_class("dd_DisambgStepLetterHover"),y&&y.displayHoverPushpin(g.DisambiguationPinPrefixId+r+"_"+u,t)}function at(n){var u;n.preventDefault();var t=n.target,i="",r=-1;d(n.target.getAttribute("shapeId"))?(d(n.target.getAttribute("WaypointUniqueId"))&&(t=t.parentNode),i=t.getAttribute("WaypointUniqueId").toString(),r=t.getAttribute("SuggestionsIndex")):(u=t.getAttribute("shapeId").split("_"),i=u[1],r=parseInt(u[2])),ft({waypointId:parseInt(i),suggestionsIndex:parseInt(r)})}function ft(t){var e=t.suggestionsIndex,o=t.waypointId,f=null,u=g.getStoppointById(parseInt(o)),r,i;u&&(r=u.getDisambiguationResult(),r&&r.locationSuggestions&&r.locationSuggestions.length>0?(i=r.locationSuggestions[e],f={address:i.suggestion,location:new l(i.location.latitude,i.location.longitude),geoLocation:new l(i.location.latitude,i.location.longitude)}):(i=r.businessSuggestions[e],f={address:i.address,location:new l(i.location.latitude,i.location.longitude),geoLocation:new l(i.location.latitude,i.location.longitude),businessDetails:{website:i.website,phoneNumber:i.phoneNumber,businessName:i.name,entityId:i.entityId}})),y&&y.removeDisambiguationPushpins&&y.removeDisambiguationPushpins(u),n.invoke(w,"selected",{waypoint:u,newWaypointOptions:f})}function vt(n){n.preventDefault();var i=n.target.getAttribute("WaypointUniqueId"),u=g.getStoppointById(parseInt(i)),t=n.target.getAttribute("StartingIndex");t<0&&(t=0),ti.resolveWaypoint(ot,u,r(w,yt),t,null,v)}function yt(n){tt&&y&&y.removeDisambiguationPushpins&&y.removeDisambiguationPushpins(n),it(n)}var w=this,nt,y=s,et=h,tt=c,g=a,ot=o,st=v,p=g._getPrefixId(),b=null;w.addDisambiguationControl=function(n,t){b=n,it(t)},w.dispose=function(){y&&y.removeDisambiguationPushpins&&y.removeDisambiguationPushpins(),n.removeHandler(nt),nt=null}}function ci(t,i,u){function c(n){var t=f._state.cloneOptions(f._state.getOptions().stepPushpinOptions);return t.id=f._state.SteppinPrefixId+n,t.visible=!0,t}function a(n){var t=f._state.stoppoints,u=!1,e=!1,i,r;return t&&t.length>1&&(u=t[t.length-1]._uniqueId===n._uniqueId,e=!u&&t[0]._uniqueId!==n._uniqueId),i=f._state.getOptions(),r=fi.getDefaultWaypointOption(f._state,n),r.id=f._state.StoppointPinPrefixId+n._uniqueId,u&&i.lastWaypointIcon&&(r.icon=i.lastWaypointIcon),e&&i.middleWaypointIcon&&(r.icon=i.middleWaypointIcon),r}function v(n){var t=f._state.cloneOptions(f._state.getOptions().viapointPushpinOptions);return t.id=f._state.StoppointPinPrefixId+n._uniqueId,t}function y(n){var t=n.target;t.setOptions({icon:t._hoverIcon})}function w(n){var t=n.target;t.setOptions({icon:t._originalIcon})}function b(t){n.invoke(f,"drag",t)}function k(t){n.invoke(f,"drop",t)}function l(t){for(var r=e.length;r--;){var i=e[r].target,i=i instanceof ct||i instanceof ri?i:i.getPushpin(),u=i._uniqueId?i._uniqueId:i.getId();t&&u.indexOf(t)!==0||(n.removeHandler(e[r]),e.pop(e[r]))}}var f=this,e,h,s;f._map=t,f._state=i,e=[],f._handlers=e,h=u,s=null,f.createAllPushpins=function(n,t){f.removeAllPushpins(),f.createPushpins(t),f._state.getOptions().routeMode===o.transit&&f.createTransitStepPushpins&&f.createTransitStepPushpins(n)},f.displayStepPushpin=function(n,t){if(s){s.setLocation(n);var i=c(t);s.setOptions(i)}else s=new ct(n,c(t)),f._map.entities.push(s)},f.hideStepPushpin=function(){s&&s.setOptions({visible:!1})},f.createPushpins=function(t){for(var u,c,a,i,s,l,o=0;o<t.length;o++)(u=t[o],u.getLocation())&&(c=f._state.StoppointPinPrefixId+u._uniqueId,a=f._getEntityById(c),a||(i=u.getPushpin(),i?i.setLocation(u.getLocation()):(s=f.getDefaultOptions(u),i=new ct(u.getLocation(),s),s.hoverIcon&&(i._hoverIcon=s.hoverIcon,f._attachHoverBehavior(i))),i._uniqueId=c,f._map.entities.push(i),p.WaypointDragging&&typeof cr!="undefined"&&i.getDraggable()&&typeof cr!="undefined"&&(l=new cr(i,f._map,h),e.push(n.addHandler(l,"drag",r(f,b))),e.push(n.addHandler(l,"drop",r(f,k))))))},f.displayHoverPushpin=function(n,t){var i=f._getEntityById(n);i&&i.setOptions({icon:t?i._hoverIcon:i._originalIcon})},f.removeAllPushpins=function(){f._removePushpins("")},f._attachHoverBehavior=function(t){t._hoverIcon&&(t._originalIcon=t.getIcon(),e.push(n.addHandler(t,"mouseover",r(f,y))),e.push(n.addHandler(t,"mouseout",r(f,w))))},f._removePushpins=function(n){var e,u,i,r;for(l(n),e=f._map.entities,u=0;u<e.getLength();u++)i=e.get(u),i&&(i instanceof ct||i instanceof ri)&&(i.getId&&i.getId()||i._uniqueId)&&(r=i._uniqueId?i._uniqueId:i.getId(),(n&&r.indexOf(n)===0||!n&&(r.indexOf(f._state.SteppinPrefixId)===0||r.indexOf(f._state.StoppointPinPrefixId)===0||r.indexOf(f._state.DisambiguationPinPrefixId)===0||r.indexOf(f._state.TransitStepPinPrefixId)===0))&&(t.entities.remove(i),u--,r.indexOf(f._state.SteppinPrefixId)===0&&(s=null)))},f._isLightColorPopupRequired=function(){var n=!1,t=f._map.getImageryId();switch(t){case"Aerial":case"EnhancedBirdseye":case"NativeBirdseye":n=!0;break;default:n=!1}return n},f.getDefaultOptions=function(n){return n.isViapoint()?v(n):a(n)},f._getEntityById=function(n){for(var r=f._map.entities,u=r.getLength(),t,i=0;i<u;i++)if(t=r.get(i),t&&(t._uniqueId&&t._uniqueId===n||t.getId&&t.getId()===n))return t;return null},f.getPushpin=function(n){var t=f._state.StoppointPinPrefixId+n._uniqueId;return f._getEntityById(t)},f.dispose=function(){l(""),f._removePushpins(""),s=null}}function ou(i,f,e,s,c,a){function vt(t){var u=v.getOptions(),i;u.routeMode!==o.transit&&!t.tempararyPolyline&&u.routeDraggable&&(i=new bt(tt,t.polyline,ft,v),y.push(n.addHandler(i,"dragMove",r(p,kt))),y.push(n.addHandler(i,"dragEnd",r(p,dt))))}function yt(t){for(var i=y.length,r,u;i--;)y[i]instanceof bt&&(r=y[i].target,u=r.getPolyline(),t.polyline.getId()===u.getId()&&(n.removeHandler(y[i]),y.pop(y[i]),r.dispose()))}function pt(n){if(v.getOptions().routeMode===o.transit||!v.routes||v.routes.length===0){k=!0;return}var t=parseInt(n.id),i=v.getPreviousStopPoint(t),r=v.getNextStoppoint(t),u=v.getStoppointById(t);ct(n.location,u,i,r)}function wt(n){var i=parseInt(n.id),t=v.getStoppointById(i),r,u;(!v.routes||v.routes.length===0)&&t?(t.clear(),t.setOptions({location:n.location})):(r=v.getPreviousStopPoint(i),u=v.getNextStoppoint(i),lt(n.location,t,r,u))}function kt(n){var i=n.location,r=n.polyline,u=r.getId().split("_")[1],t=u.split("~"),f=v.getStoppointById(parseInt(t[1])),e=v.getStoppointById(parseInt(t[2]));ct(i,null,f,e)}function dt(n){var i=n.location,r=n.polyline,u=r.getId().split("_")[1],t=u.split("~"),f=v.getStoppointById(parseInt(t[1])),e=v.getStoppointById(parseInt(t[2]));lt(i,null,f,e)}function ct(n,i,u,f){var o,e;if(k||(rt=0),!(nu>0)||!(rt>=nu)){if(o=d(i),!k){if(o&&v.getViapointCountInLeg(u)>=iu)return;ut=null}++rt,k=!0,e=[],e[0]=ii(i,u,f,o),e[1]=++at,e[2]=n,e[3]=i&&v.stoppoints[0]._uniqueId===i._uniqueId,e[4]=o,t.getCredentials(tt,r(p,function(o){var h=ot.generateDragAndDropStopPointLink(i,u,f,n,!0,null,o),c=t.convertPermalinkDictionaryToPermalink(h),s=b.directionsService+c,l=r(p,gt);nt.getObjectAsync(s,l,e,-1,t.GetUniqueNetworkRequestId(s))}))}}function gt(n,t){var u,l,et,ot,st,a,y,s,it,e,i,p,h,c,r,ft;if((--rt,u=t.userData,l=u[1],!(l<ht))&&(ht=l,k&&t&&t.success&&n&&(a=u[0],!d(n.subLegs)))){y=n.subLegs[0],s=y.length,ut=u[2];var ct=u[4],b=[],f=[],lt=!ct||s===1?s:s-1,nt=v.getOptions();for(i=0;i<a.length;i++)i<lt?b[b.length]=a[i]:f[f.length]=a[i];for(g.clearRoute(b,!0),it=v.cloneOptions(nt.routeMode===o.walking?nt.walkingPolylineOptions:nt.drivingPolylineOptions),i=0;i<s;i++)e=y[i],w.decodeRoute(e.routePath,!0),e.routePath.decodedRegions=ri(e.routePath.decodedLatitudes.length),e.routePath.zoomLevels=tt.getZoom().toString(),r=l+"_"+i,ft=g.addPolyline(r,e.routePath,it,!0,null,r);for(et=f.length,i=0;i<et;i++)if(!g._displayedRoutes[f[i]])for(ot=v.currentRouteLegs.length,p=0;p<ot;p++)for(h=v.currentRouteLegs[p],st=h.subLegs.length,c=0;c<st;c++)(r=h.subLegs[c].subLegKey,r===f[i])&&(ft=g.addPolyline(f[i],h.subLegs[c].routePath,it,!1,h.legKey,r));ni(y,u[3])}}function ni(n,i){for(var o=0,s=0,y=i?n[0].startDescription:n[0].endDescription,l,h=v.currentRouteLegs.length,c,e,f,a,r=0;r<h;r++)for(c=v.currentRouteLegs[r],l=c.subLegs.length,e=0;e<l;e++)f=c.subLegs[e],g._displayedRoutes[f.subLegKey]&&f.summary&&(o+=f.summary.distance,s+=f.summary.time);for(h=n.length,r=0;r<h;r++){if(r>=2)break;d(n[r].summary)||(o+=n[r].summary.distance,s+=n[r].summary.time)}a=u.getString("L_DragSummaryToolTip_Text").replace("{0}",y).replace("{1}",o.toFixed(1)).replace("{2}",v.getOptions().distanceUnit===it.miles?u.getString("L_DistanceUnitMilesShortText_Text"):u.getString("L_DistanceUnitKm_Text")).replace("{3}",t._getDurationFormattedTime(s)),ft.setToolTip(a)}function lt(n,i,u,f){if((ft.setVisibility(!1),k)&&(k=!1,i||!(v.getViapointCountInLeg(u)>=iu))){var a=!i||i.isViapoint(),s=null,h=null;a?(s=u.isViapoint()?v.getPreviousWaypoint(u._uniqueId):u,h=f.isViapoint()?v.getNextWaypoint(f._uniqueId):f):(s=v.getPreviousWaypoint(i._uniqueId),h=v.getNextWaypoint(i._uniqueId));var o=[],e=[],c=v.getOptions();!i||i.isViapoint()?e[e.length]=c.routeIndex+"~"+s._uniqueId+"~"+h._uniqueId:(s&&(e[e.length]=c.routeIndex+"~"+s._uniqueId+"~"+i._uniqueId),h&&(e[e.length]=c.routeIndex+"~"+i._uniqueId+"~"+h._uniqueId)),o[0]=e,o[1]=n,o[2]=i?i._uniqueId:"",u&&(o[3]=u._uniqueId),o[4]=++st,t.toggleTaskProgressIndicator(!0,v),!a&&i&&n&&(i._geoLocation=new l(n.latitude,n.longitude)),t.getCredentials(tt,r(p,function(e){var h=ot.generateDragAndDropStopPointLink(i,u,f,n,!1,ut,e),c=t.convertPermalinkDictionaryToPermalink(h),s=b.directionsService+c,l=r(p,ti);nt.getObjectAsync(s,l,o,er,t.GetUniqueNetworkRequestId(s))}))}}function ti(i,r){var c=r.userData,it=c[4],f,a,w,e,tt,s,u,d,b,g;if(!(it<st)&&!k)if(t.toggleTaskProgressIndicator(!1,v),r&&r.success&&i){var y=c[0],p=c[1],nt=i.routeResults;if(nt&&(f=nt[0],f.routeResponseCode===h.success)){if(a=c[2],v.getOptions().routeMode===o.transit){a&&(e=v.getStoppointById(a),e.clear(),e._geoLocation=new l(p.latitude,p.longitude)),v.addInlineImages(f.inlineImageCache),v.addRoutes(null,f.routes),v.setOptions({routeIndex:0}),n.invoke(this,"dropCompleted",{failed:!1});return}if(f.routes[0].routeLegs.length!==y.length){n.invoke(this,"dropCompleted",{failed:!0});return}for(w=y.length,u=0;u<w;u++)v.removeLeg(y[u]);for(a?(e=v.getStoppointById(a),e.clear(),e._geoLocation=new l(p.latitude,p.longitude)):typeof v.addNewViapoint!="undefined"&&v.addNewViapoint(c[3]),w=f.routes.length,s=0;s<w;s++)for(tt=f.routes[s].routeLegs.length,u=0;u<tt;u++)d=y[u],b=f.routes[s].routeLegs[u],b.legKey=d,g=d.split("~"),b.startWaypointLocation=v.getStoppointById(parseInt(g[1])).getLocation(),b.endWaypointLocation=v.getStoppointById(parseInt(g[2])).getLocation(),v.addLegAndUpdateWaypoints(f.routes[s].routeLegs[u],s)}n.invoke(this,"dropCompleted",{failed:!1})}else r&&!r.success?n.invoke(this,"dropCompleted",{failed:!0}):n.invoke(this,"dropCompleted",{failed:!0})}function ii(n,t,i,r){var l=r||n.isViapoint(),e=null,c,f;e=l?i.isViapoint()?v.getNextWaypoint(i._uniqueId):i:v.getNextWaypoint(n._uniqueId);for(var o=[],s=d(t)?n._uniqueId:t._uniqueId,a=d(e)?n._uniqueId:e._uniqueId,h=s,u=0;u<v.stoppoints.length;u++)if(f=v.stoppoints[u],f._uniqueId===s)break;for(c=v.getOptions(),u=u+1;u<v.stoppoints.length;u++)if(f=v.stoppoints[u],o[o.length]=c.routeIndex+"~"+h+"~"+f._uniqueId,h=f._uniqueId,f._uniqueId===a)break;return o}function ri(n){var i=[],r=[],u=new hi(tt.getBounds(),null,null),t;for(u.indexes=new Array(n),t=0;t<n;t++)u.indexes[t]=t;return r[r.length]=u,i[i.length]=r,i}var p=this,tt=s,v=e,et=i,g=f,ot=c,y=[],k=!1,at=0,st=0,ht=0,rt=0,ut=null,ft=a;y.push(n.addHandler(et,"drag",r(p,pt))),y.push(n.addHandler(et,"drop",r(p,wt))),y.push(n.addHandler(g,"polylineAdded",r(p,vt))),y.push(n.addHandler(g,"polylineRemoved",r(p,yt))),p.dispose=function(){for(var t=y.length;t--;)n.removeHandler(y[t]);y=[]}}function su(n){function u(){if(r){var n={visible:!1,offset:new tt(uu,uu*-1),htmlContent:""};t=new ri(r.getCenter(),n),r.entities.push(t)}}var i=this,r=n,t=null;u(),i.setLocation=function(n){t.setLocation(n)},i.setVisibility=function(n){t.setOptions({visible:n})},i.setToolTip=function(n){t.setOptions({htmlContent:'<div id="MicrosoftMapsDragToolTip" class="dd_DirectionsDragToolTip">'+n+"<\/div>"}),i.setVisibility(!0)},i.dispose=function(){r&&r.entities.remove(t)}}function cr(t,i,f){function b(){a=!0,e.push(n.addThrottledHandler(c,"mousemove",r(o,it),100)),v=c.getWidth(),y=c.getHeight()}function k(n){if(a){var t=n.entity;w(!0),p.setLocation(t.getLocation())}}function d(t){var i,r;for(a=!1,i=e.length;i--;)if(e[i].eventName==="mousemove"){n.removeHandler(e[i]),e.pop(e[i]);break}r=t.entity,w(!1)}function g(n){if(n){var t=n.target;p.setLocation(t.getLocation()),p.setToolTip(u.getString("L_DragToolTip_Text"))}}function nt(){a||p.setVisibility(!1)}function it(n){if(a){var t=n.getX()+v/2,i=n.getY()+y/2,u=0,f=0;t<50?u=Math.min(50-t,25):t>v-50&&(u=Math.max(v-50-t,-25)),i<50?f=Math.min(50-i,25):i>y-50&&(f=Math.max(y-50-i,-25)),u||f?(l=new tt(u,f),h===-1&&(h=window.setInterval(r(o,rt),250))):(l=new tt(0,0),window.clearInterval(h),h=-1)}}function rt(){var n,t,i;a&&(l.x||l.y)?(n=c.tryLocationToPixel(s.getLocation()),n&&(t=c.tryPixelToLocation(new tt(n.x-l.x,n.y-l.y)),s.setLocation(t),i={center:c.getCenter(),centerOffset:l,animate:!1},c.setView(i),w(!0))):h!==-1&&(window.clearInterval(h),h=-1)}function w(i){var u=s._uniqueId?s._uniqueId:s.getId(),r={id:u.split("_")[1],location:t.getLocation()};i?n.invoke(o,"drag",r):n.invoke(o,"drop",r)}var o=this,s=t,c=i,a=!1,v,y,l,h,e=[],p=f;e.push(n.addHandler(s,"dragstart",r(o,b))),e.push(n.addThrottledHandler(s,"drag",r(o,k),250)),e.push(n.addHandler(s,"dragend",r(o,d))),e.push(n.addHandler(s,"mouseover",r(o,g))),e.push(n.addHandler(s,"mouseout",r(o,nt))),o.getPushpin=function(){return s},o.dispose=function(){for(var t=e.length;t--;)n.removeHandler(e[t]);e=[],h!==-1&&(window.clearInterval(h),h=-1)}}function yt(n,t,i,r){cc_sb_ie?n.attachEvent("on"+t,i):n.addEventListener(t,i,r)}function hu(n){return cc_sb_ie?event.srcElement:n.target}function cu(n){cc_sb_ie?event.returnValue=!1:n.preventDefault()}function lr(n){cc_sb_ie?n.cancelBubble=!0:n.stopPropagation()}function di(){}function wf(t){function s(t){t.preventDefault();var i=t.target.getAttribute("mode").toString();i===o.transit&&r.stoppoints.length>2||i===r.getOptions().routeMode||(r.setOptions({routeMode:i}),r.saveSessionRouteMode(),typeof VEShell!="undefined"&&t.currentTarget&&VEShell.Logging.get_instance().logSubmit(t.currentTarget.id),n.invoke(h,"modeChanged",{mode:i}))}var h=this,r=t,f=t._getPrefixId()+ai;h.createModeSwitchingIcons=function(n){var h=0,w=r.getOptions(),c=e("","modeSwitchInnerContainer",null),l,t,y;if(p.DrivingDirectionsEnabled&&(l=k(f+"SwitchToCar","modeSwitch "+(w.routeMode===o.driving?"carModeSwitchSelected":"carModeSwitch"),c,"","#"),l.title=u.getString("L_CarModeToolTip_Text"),l.setAttribute("mode",o.driving),i(l).add_event("click",s),h++),p.TransitDirectionsEnabled){var a="transitModeSwitch",b="transitModeSwitchDisabled",d="transitModeSwitchSelected",g=u.getString("L_TransitModeToolTip_Text");if(v==="en-gb")var a="tubeModeSwitch",b="tubeModeSwitchDisabled",d="tubeModeSwitchSelected",g=u.getString("L_TubeModeToolTip_Text");t=k(f+"SwitchToTransit","modeSwitch "+a,c,"","#"),r.stoppoints.length>2?i(t).swap_class(a,b):w.routeMode===o.transit&&i(t).swap_class(a,d),t.title=g,t.setAttribute("mode",o.transit),i(t).add_event("click",s),h++}p.WalkingDirectionsEnabled&&(y=k(f+"SwitchToWalking","modeSwitch "+(w.routeMode===o.walking?"walkingModeSwitchSelected":"walkingModeSwitch"),c,"","#"),y.title=u.getString("L_WalkingModeToolTip_Text"),y.setAttribute("mode",o.walking),i(y).add_event("click",s),h++),h>=1&&n.appendChild(c),r.saveSessionRouteMode()},h.dispose=function(){i("#"+f+"SwitchToCar").remove_event("click",s),i("#"+f+"SwitchToTransit").remove_event("click",s),i("#"+f+"SwitchToWalking").remove_event("click",s)}}function bf(h){function w(n){var t=y("hourInput"),i=y("minuteInput"),r=y("amPmSwitch");t&&(t.disabled=n),i&&(i.disabled=n),r&&(r.disabled=n)}function d(t){var r=c.getOptions().transitOptions,i=null;t.selectedIndex?t.selectedIndex===1?(w(!1),i=et.arrival):t.selectedIndex===2&&(w(!0),i=et.lastAvailable):(w(!1),i=et.departure),i&&r.timeType!==i&&c.setOptions({transitOptions:{timeType:i}}),n.invoke(l,"optionsChanged",{updateDirections:!1})}function g(){n.invoke(l,"optionsChanged",{updateDirections:!1})}function nt(n){var i=e(a+"WalkingOptionsDiv","collapsibleRouteOptions routeOptionsContainer",n),o=f("fieldset","","routeOptions",i,""),s=t._addCheckBox(a+"RoundTrip",o,u.getString("L_DirectionsMenuRoundtrip_Text"),!1,r(l,b));l.addCollapsibleHeader(null,u.getString("L_RouteOptions_Text"),s,!1)}function tt(n){var i=c.getOptions(),p=e(a+"CarOptionsDiv","",n),o=f("fieldset","","routeOptions",p,""),h=(i.routeAvoidance&s.avoidLimitedAccessHighway)===s.avoidLimitedAccessHighway||(i.routeAvoidance&s.minimizeLimitedAccessHighway)===s.minimizeLimitedAccessHighway,y=u.getString("L_AvoidHighways_Text");v==="en-gb"&&(y=u.getString("L_AvoidMotorways_Text")),t._addCheckBox(a+"AvoidHighways",o,y,h,r(l,it)),h=(i.routeAvoidance&s.avoidToll)===s.avoidToll||(i.routeAvoidance&s.minimizeToll)===s.minimizeToll,t._addCheckBox(a+"AvoidTolls",o,u.getString("L_AvoidTolls_Text"),h,r(l,rt)),t._addCheckBox(a+"RoundTrip",o,u.getString("L_DirectionsMenuRoundtrip_Text"),!1,r(l,b)),l.addCollapsibleHeader(null,u.getString("L_RouteOptions_Text"),o,!1)}function b(t){var i=t.target,r,u,f,e;!i.checked&&c.stoppoints.length>2&&(r=c.stoppoints[c.stoppoints.length-1],c.removeStoppoint(r._uniqueId,!0)),u=c.getAllWaypoints(),f=c.getOptions().routeMode===o.transit?or:dt,i.checked&&u.length<f&&(e=c.addRoundTripWapoint()),n.invoke(l,"optionsChanged",{updateDirections:!0})}function it(t){var r=t.target,i=c.getOptions().routeAvoidance;(i&s.avoidLimitedAccessHighway)===s.avoidLimitedAccessHighway&&(i=i-s.avoidLimitedAccessHighway),(i&s.minimizeLimitedAccessHighway)===s.minimizeLimitedAccessHighway&&(i=i-s.minimizeLimitedAccessHighway),r.checked&&(i=i|s.avoidLimitedAccessHighway),c.setOptions({routeAvoidance:i}),n.invoke(l,"optionsChanged",{updateDirections:!0})}function rt(t){var r=t.target,i=c.getOptions().routeAvoidance;(i&s.avoidToll)===s.avoidToll&&(i=i-s.avoidToll),(i&s.minimizeToll)===s.minimizeToll&&(i=i-s.minimizeToll),r.checked&&(i=i|s.avoidToll),c.setOptions({routeAvoidance:i}),n.invoke(l,"optionsChanged",{updateDirections:!0})}function ut(o){var ut=c.getOptions().transitOptions,it=f("fieldset",a+"TransitCollapsible","routeOptions",o,""),lt=e("","optionPickerContainer",it),v=f("select",a+"TransitDepartArrive","transitDateTimeBox transitDepartArrive",lt,""),h,st,k,ht,nt,tt,w,b;if(f("option","","departArriveOption",v,u.getString("L_TransitOptionDepartAt_Text")),f("option","","departArriveOption",v,u.getString("L_TransitOptionArriveBy_Text")),p.LastTrainOption&&f("option","","lastTrainOption",v,u.getString("L_TransitOptionLastTrain_Text")),ut.timeType===et.arrival?v.selectedIndex=1:ut.timeType===et.departure?v.selectedIndex=0:ut.timeType===et.lastAvailable&&(v.selectedIndex=2),i(v).add_event("change",r(l,function(){d(v)})),fu(c,"TransitDate",it,g),p.TransitAdvancedOptions){var y=c.getOptions(),rt=e(a+"TransitAdvancedOptionsContainer","transitAdvancedOptionsContainer",it),ct=e(a+"TransitSortByDiv","",rt);f("span",a+"TransitSortByLabel","transitAdvancedOptionsLabel",ct,u.getString("L_TransitSortByLabel_Text")),h=f("select",a+"TransitSortBy","transitSortBySelectBox",ct,""),f("option","","",h,u.getString("L_TransitSortByOptionMinimizeTime_Text")),f("option","","",h,u.getString("L_TransitSortByOptionMinimizeMoney_Text")),f("option","","",h,u.getString("L_TransitSortByOptionMinimizeTransfers_Text"));switch(y.routeOptimization){case ot.shortestTime:h.selectedIndex=0;break;case ot.minimizeMoney:h.selectedIndex=1;break;case ot.minimizeTransfers:h.selectedIndex=2}i(h).add_event("change",r(l,function(){var t=c.getOptions().routeOptimization;switch(h.selectedIndex){case 0:t=ot.shortestTime;break;case 1:t=ot.minimizeMoney;break;case 2:t=ot.minimizeTransfers}c.setOptions({routeOptimization:t}),n.invoke(l,"optionsChanged",{updateDirections:!0})})),st=e(a+"ExcludeAirLineDiv","",rt),k=t._addInputElement(a+"ExcludeAirLine","",st,"","checkbox",""),f("label",a+"AirLineLabel","",st,u.getString("L_TransitExcludeAirLineLabel_Text")),k.checked=y.routeAvoidance&s.avoidAirline,k.setAttribute("defaultChecked",k.checked),ht=e(a+"ExcludeExpressDiv","",rt),nt=t._addInputElement(a+"ExcludeExpressTrain","",ht,"","checkbox",""),f("label",a+"ExpressLabel","",ht,u.getString("L_TransitExcludeExpressLabel_Text")),nt.checked=y.routeAvoidance&s.avoidExpressTrain,nt.setAttribute("defaultChecked",nt.checked),tt=e(a+"BulletTrainDiv","transitBulletTrainDiv",rt),w=t._addInputElement(a+"IncludeBulletTrainRadio","",tt,"fewestTime","radio","bulletTrainRadio"),f("label",a+"IncludeBulletTrainLabel","",tt,u.getString("L_TransitIncludeBulletTrain_Text")),w.checked=!(y.routeAvoidance&s.avoidBulletTrain),w.setAttribute("defaultChecked",w.checked),w.disabled=y.routeAvoidance&s.avoidExpressTrain,b=t._addInputElement(a+"ExcludeBulletTrainRadio","",tt,"fewestTransfer","radio","bulletTrainRadio"),f("label",a+"ExcludeBulletTrainLabel","",tt,u.getString("L_TransitExcludeBulletTrain_Text")),b.checked=y.routeAvoidance&s.avoidBulletTrain,b.setAttribute("defaultChecked",b.checked),b.disabled=y.routeAvoidance&s.avoidExpressTrain,ft(k,nt,w,b)}l.addCollapsibleHeader(null,"",it,!1)}function ft(t,u,f,e){i(t).add_event("click",r(l,function(){var i=c.getOptions().routeAvoidance;(i&s.avoidAirline)===s.avoidAirline&&(i=i-s.avoidAirline),t.checked&&(i=i|s.avoidAirline),c.setOptions({routeAvoidance:i}),n.invoke(l,"optionsChanged",{updateDirections:!0})})),i(u).add_event("click",r(l,function(){var t=c.getOptions().routeAvoidance;(t&s.avoidExpressTrain)===s.avoidExpressTrain&&(t=t-s.avoidExpressTrain),u.checked?(t=t|s.avoidExpressTrain,f.disabled=!0,e.disabled=!0):(f.disabled=!1,e.disabled=!1),c.setOptions({routeAvoidance:t}),n.invoke(l,"optionsChanged",{updateDirections:!0})})),i(f).add_event("click",r(l,function(){var t=c.getOptions().routeAvoidance;(t&s.avoidBulletTrain)===s.avoidBulletTrain&&(t=t-s.avoidBulletTrain),c.setOptions({routeAvoidance:t}),n.invoke(l,"optionsChanged",{updateDirections:!0})})),i(e).add_event("click",r(l,function(){var t=c.getOptions().routeAvoidance;(t&s.avoidBulletTrain)!==s.avoidBulletTrain&&(t=t|s.avoidBulletTrain),c.setOptions({routeAvoidance:t}),n.invoke(l,"optionsChanged",{updateDirections:!0})}))}var l=this,c=h,a=c._getPrefixId();l.showRouteOptionsForCurrentMode=function(n,t){var r=y(a+"optionsContainer"),i=e(a+"optionsContainer","optionsContainer",null);r?(r.parentNode.removeChild(r),n.insertBefore(i,y(a+"RouteSettingsDiv"))):n.appendChild(i);switch(c.getOptions().routeMode){case o.driving:case null:tt(i);break;case o.transit:ut(t);break;case o.walking:nt(i)}return i},l.addCollapsibleHeader=function(n,r,f,o){var s,h,a,l;o?(s=c.getOptions(),h=s.routeMode,s.OptionsControlExpandedState=s.OptionsControlExpandedState||{},s.OptionsControlExpandedState[h]==="undefined"&&(s.OptionsControlExpandedState[h]=!1),n||(n=e("","directionsSettingExpanderClosed routeOptionsHeader",null),a=k("optionsHeader","",n,r,"#"),i(a).add_event("click",function(n){n.preventDefault()})),f.parentNode.insertBefore(n,f),t.toggleInline(i(f)),l=function(){var r=i(n),e=y("optionsHeader");r.has_class("directionsSettingExpanderClosed")?(r.swap_class("directionsSettingExpanderClosed","directionsSettingExpanderOpen"),e.innerHTML=t.htmlEncode(u.getString("L_HideOptions_Text"))):(r.swap_class("directionsSettingExpanderOpen","directionsSettingExpanderClosed"),e.innerHTML=t.htmlEncode(u.getString("L_ShowOptions_Text"))),t.toggleInline(i(f))},i(n).add_event("click",function(){l(),s.OptionsControlExpandedState[h]=!s.OptionsControlExpandedState[h]}),s.OptionsControlExpandedState[h]&&l()):i(f).set_attr("display","block")},l.dispose=function(){}}var u=window[$MapsNamespace].Maps.Resources,ei=!1,ht=!1,a=window[$MapsNamespace].Maps,yr,o,it,s,ot,et,pr,p,si,h,ut,hr,hi,t,k,f,e,d,gt,y,r,fi,vt,lt,ti,w,ii,wt,pf,bt,gi,ar;a.Directions=a.Directions||{},DirectionPublicNamespace=a.Directions;var i=a.Gimme,b=a.Globals,tt=a.Point,n=a.Events,oi=a.LocationRect,l=a.Location,li=a.Color,ct=a.Pushpin,ri=a.Infobox,lu=a.Polyline,at=a.InternalNamespaceForDelay;at.Directions=at.Directions||{};var vr=at.Directions,nt=at.Network,kf=at.Size,pt=at.PRF,kt=at.Quirks,dt=b.directionsMaxWaypoints||25,v=kt.useXHR?Windows.ApplicationModel.Resources.Core.ResourceManager.current.defaultContext.languages[0].toLowerCase():b.locale.toLowerCase();typeof yr=="undefined"&&(yr={}),o={driving:"driving",transit:"transit",walking:"walking"},a.Directions=a.Directions||{},a.Directions.RouteMode=o,it={kilometers:0,miles:1},a.Directions=a.Directions||{},a.Directions.DistanceUnit=it,s={none:0,minimizeLimitedAccessHighway:1,minimizeToll:2,avoidLimitedAccessHighway:4,avoidToll:8,avoidExpressTrain:16,avoidAirline:32,avoidBulletTrain:64},a.Directions=a.Directions||{},a.Directions.RouteAvoidance=s,ot={shortestTime:0,shortestDistance:1,minimizeMoney:2,minimizeTransfers:3,minimizeWalking:4},a.Directions=a.Directions||{},a.Directions.RouteOptimization=ot,et={departure:"departure",arrival:"arrival",lastAvailable:"lastAvailable"},a.Directions=a.Directions||{},a.Directions.TimeType=et,pr={unknown:0,whereOnly:1,whatAndWhere:2,whatOnly:3},p=function(){var b=o.driving,s=!1,n=!1,r=!1,h=!1,c=!1,l=!1,a=!1,t="m/d/yyyy",y=!0,u="d/m/yyyy",e="yyyy-m-d",p="d-m-yyyy",w,f;return v==="ja-jp"&&(n=!0,h=!0,c=!0,a=!0,t="yyyy/m/d",r=!0),v==="de-de",v==="en-ca"&&(n=!0,t=u),v==="en-au"&&(n=!0,t=u),v==="es-es"&&(n=!0,t=u),v==="es-mx"&&(n=!0,t=u),v==="en-us"&&(n=!0,r=!0,s=!0),v==="es-us"&&(n=!0,r=!0,s=!0),v==="fr-be"&&(n=!0,t=e),v==="fr-ca"&&(n=!0,r=!0,t=e),v==="fr-fr"&&(n=!0,t=u),v==="en-gb"&&(n=!0,r=!0,s=!0,t=u),v==="it-it",v==="nb-no"&&(n=!0,t="d.m.yyyy"),v==="nl-be"&&(n=!0,t=e),v==="nl-nl"&&(n=!0,t=p),v==="pl-pl"&&(n=!0,t=e),v==="pt-br"&&(n=!0,t=u,r=!0),v==="sv-se"&&(n=!0,t=e),w=v.substring(0,2),v==="es-mx"||v==="es-us"||!i.Helper.contains(["fr","de","es","it","pt","nb","nl","sv","pl","ru","tr","ko"],w)||(y=!1),f=v.substring(3),(f==="us"||f==="in"||f==="au"||f==="ca"||f==="mx")&&(l=!0),f==="in"&&(t=p),{WaypointDragging:!0,DefaultMode:b,DistanceUnitMiles:s,DrivingDirectionsEnabled:!0,WalkingDirectionsEnabled:!0,TransitDirectionsEnabled:n,TrafficAwareDirections:r,LastTrainOption:h,TransitAdvancedOptions:c,TransitTimeUse12Hour:l,TransitShowRouteCost:a,TransitDateFormat:t,RadixPointDecimal:y}}(),DirectionPublicNamespace.DirectionsManager=wr,directionsManagerPrototype=DirectionPublicNamespace.DirectionsManager.prototype,directionsManagerPrototype._getTask=function(){return this._task||(this._task=new ni(this._map,this,this._sessionState)),this._task},directionsManagerPrototype.calculateDirections=function(){this._getTask().setDirections()},directionsManagerPrototype.setMapView=function(){this._getTask()._setViewPortForSelectedRoute(!0)},directionsManagerPrototype.clearDisplay=function(){this._getTask().clearDisplay()},directionsManagerPrototype.resetDirections=function(n){this._getTask().resetDirections(n)},directionsManagerPrototype.addWaypoint=function(n,t){this._getTask().addWaypoint(n,t)},directionsManagerPrototype.removeWaypoint=function(n,t){this._getTask().removeWaypoint(n,t)},directionsManagerPrototype.getNearbyMajorRoads=function(n,t,i,r){this._getTask().getNearbyArterials(n,t,i,r)},directionsManagerPrototype.reverseGeocode=function(n,t,i,r){this._getTask().reverseGeocode(n,t,i,r)},directionsManagerPrototype.getMap=function(){return this._map},directionsManagerPrototype.getRouteResult=function(){return this._getTask()._getState().routes},directionsManagerPrototype.getAllWaypoints=function(){return this._getTask()._getState().stoppoints},directionsManagerPrototype.getRenderOptions=function(){return this._getTask()._getState().getRenderOptions()},directionsManagerPrototype.getRequestOptions=function(){return this._getTask()._getState().getRequestOptions()},directionsManagerPrototype.setRenderOptions=function(n){this._getTask().setRenderOptions(n)},directionsManagerPrototype.setRequestOptions=function(n){this._getTask().setRequestOptions(n)},directionsManagerPrototype.getWaypointInput=function(n){return this._getTask().getWaypointInput(n)},directionsManagerPrototype.getPanel=function(){return this._getTask().getPanel()},directionsManagerPrototype.dispose=function(){this._getTask().dispose(),this._task=null};var nr=182,br=51,kr=51,dr=255,au=51,vu=51,yu=255,pu=!1,wu=400,tr=4,bu=5280,ku=1e3,gr=.15,du=6,ir=new li(1,204,204,204),rr=new li(1,17,17,17),ur=new li(1,0,0,0),fr=new li(1,230,230,230),gu=204,ai="_LPanel",vi="_RPanel",yi="_SPanel",nf="veDDstep$",tf="DDWaypointPushpin$",rf="DDDisambiguationPushpin$",pi=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],uf="veTransitStep$",ff="DDRouteSublegPolyline$",nu=3,er=15e3,or=2,wi="resolvedWaypoints",sr="NearbyArterials",tu=5,iu=10,ef=15,of="du",bi="mi",sf="km",ru="reverseGeocodeResults",uu=25,ki="{0}_{1}",hf=128,cf="DD_SL",lf="MicrosoftMapsDirections_",c=6,af="DDStart",vf="DDEnd",rt={none:0,other:1,auto:2,ferry:3,walk:4,bus:5,train:6,airline:7,tube:8};DirectionPublicNamespace.IconType=rt,si={none:0,unknown:1,departStart:2,departIntermediateStop:3,departIntermediateStopReturning:4,arriveFinish:5,arriveIntermediateStop:6,turnLeft:7,turnRight:8,turnBack:9,uTurn:10,turnToStayLeft:11,turnToStayRight:12,bearLeft:13,bearRight:14,keepToStayLeft:15,keepToStayRight:16,keepToStayStraight:17,keepLeft:18,keepRight:19,keepStraight:20,take:21,takeRampLeft:22,takeRampRight:23,takeRampStraight:24,keepOnRampLeft:25,keepOnRampRight:26,keepOnRampStraight:27,merge:28,continueRoute:29,roadNameChange:30,enterRoundabout:31,exitRoundabout:32,turnRightThenTurnRight:33,turnRightThenTurnLeft:34,turnRightThenBearRight:35,turnRightThenBearLeft:36,turnLeftThenTurnLeft:37,turnLeftThenTurnRight:38,turnLeftThenBearLeft:39,turnLeftThenBearRight:40,bearRightThenTurnRight:41,bearRightThenTurnLeft:42,bearRightThenBearRight:43,bearRightThenBearLeft:44,bearLeftThenTurnLeft:45,bearLeftThenTurnRight:46,bearLeftThenBearRight:47,bearLeftThenBearLeft:48,rampThenHighwayRight:49,rampThenHighwayLeft:50,rampToHighwayStraight:51,enterThenExitRoundabout:52,bearThenMerge:53,turnThenMerge:54,bearThenKeep:55,transfer:56,wait:57,takeTransit:58,walk:59,transitDepart:60,transitArrive:61},DirectionPublicNamespace.Maneuver=si,h={success:0,unknownError:1,cannotFindNearbyRoad:2,tooFar:3,noSolution:4,dataSourceNotFound:5,cacheMiss:6,noAvailableTransitTrip:7,transitStopsTooClose:8,walkingBestAlternative:9,outOfTransitBounds:10,timeout:11,waypointDisambiguation:12,hasEmptyWaypoint:13,exceedMaxWaypointLimit:14,atleastTwoWaypointsRequired:15,firstOrLastStoppointIsVia:16,searchServiceFailed:17,invalidCredentials:18},DirectionPublicNamespace.RouteResponseCode=h,ut={info:0,minor:1,moderate:2,major:3,ccZoneEnter:4,ccZoneExit:5},DirectionPublicNamespace.StepWarningStyle=ut,hr=function(){},hr.prototype={parentLegKey:null,subLegKey:null,polylineIds:null,temporaryRoute:!1},hi=function(n,t,i){this.boundingRectangle=n,this.childRegions=i,this.indexes=t},ft.prototype={_address:"",_shortAddress:"",_location:null,_geoLocation:null,_businessName:"",_phoneNumber:"",_exactLocation:!0,_uniqueId:null,_isViapoint:!1,_disambiguation:null,_disambiguationContainer:null,_entityId:null,_entityLink:null,_locationIdentifier:null,_website:null,_inputType:null,_pushpin:null,isViapoint:function(){return this._isViapoint},getPushpin:function(){return this._pushpin},getAddress:function(){return this._address},getShortAddress:function(){return this._shortAddress},getLocation:function(){return this._location},getGeoLocation:function(){return this._geolocation},isExactLocation:function(){return this._exactLocation},getDisambiguationResult:function(){return this._disambiguation},getDisambiguationContainer:function(){return this._disambiguationContainer},getBusinessDetails:function(){var n={};return this._businessName&&(n.businessName=this._businessName),this._phoneNumber&&(n.phoneNumber=this._phoneNumber),this._website&&(n.website=this._website),this._entityId&&(n.entityId=this._entityId),this._entityLink&&(n.entityLink=this._entityLink),n},dispose:function(){}},ft._isBusinessWaypoint=function(n){var t=n.getBusinessDetails();return t.entityId||t.businessName&&n.getAddress()},ft._uniqueWaypointId=1,a.Directions=a.Directions||{},a.Directions.Waypoint=ft,t=function(){},t.RemoveDomElement=function(n){var t=y(n);t&&t.parentNode&&t.parentNode.removeChild(t)},t.removeBehavior=function(n){var t,r,i;if(n&&window.Sys&&window.Sys.UI&&window.Sys.UI.Behavior&&(t=Sys.UI.Behavior.getBehaviors(n),t&&t.length>0))for(r=t.length,i=0;i<r;i++)t[i].dispose()},t.getCredentials=function(n,t){t("")},t.toggleTaskProgressIndicator=function(n,t){if(t!=null){var i=t.getOptions().directionsTask;i&&i.setIsLoading&&i.setIsLoading(n)}},t.toggleInline=function(n){n.set_style({display:n.get_style("display")!=="none"?"none":"block"})},k=t.addAnchorElement=function(n,i,r,u,f){return t._addAnchorElementWithEncodeOption(n,i,r,u,f,!0)},t._addAnchorElementWithEncodeOption=function(n,i,r,u,f,e){var o=document.createElement("a");return n&&(o.id=n),o.href=f,i&&(o.className=i),o.innerHTML=e?t.htmlEncode(u):u,d(r)||r.appendChild(o),o},f=t.addDOMElement=function(n,t,i,r,u){var f=document.createElement(n);return t&&(f.id=t),u&&(kt.useXHR?MSApp.execUnsafeLocalFunction(function(){f.innerHTML=u}):f.innerHTML=u),i&&(f.className=i),r&&(kt.useXHR?MSApp.execUnsafeLocalFunction(function(){r.appendChild(f)}):r.appendChild(f)),f},e=t.addDivElement=function(n,t,i){var r=document.createElement("div");return n&&(r.id=n),t&&(r.className=t),i&&i.appendChild(r),r},t._addHtmlEncodedDivElementWithText=function(n,i,r,u){var f=e(n,i,r);return f.innerHTML=t.htmlEncode(u),f},t._addInputElement=function(n,t,i,r,u,f){var e=null;if(gt(f))e=document.createElement("input");else try{e=document.createElement("<input name='"+f+"'>")}catch(o){e=document.createElement("input"),e.name=f}return e.id=n,e.className=t,e.type=u,e.value=r,d(i)||i.appendChild(e),e},t._addCheckBox=function(n,r,u,o,s){var h=e("","",r),c=f("span","","checkbox",h,""),l=t._addInputElement(n,"",c,"","checkbox",""),a=f("label","","",c,u);return n&&a.setAttribute("for",n),o&&i(l).set_attr("checked","checked"),i(l).add_event("click",s),h},t._getInlineImage=function(n,t){var r=t,u,i;return kt.isIE7OrEarlier||(u=t.substring(t.indexOf("?")+1).replace(/=/g,"").replace(/&/g,""),i=n.inlineImagesCache[u],i&&(r="data:image/png;base64,"+i)),r},t._reRenderDirectionsPanel=function(n){var f;if(kt.isIE8OrEarlier&&n){var r="0",u="0",t=null,e=i("#"+n+"_LPanel").element(),o=i("#"+n+"_RPanel").element();e&&(r=i(e).get_style("height"),t=e.parentElement),o&&(u=i(o).get_style("height"),t=o.parentElement),ei||(f=0,r&&r.indexOf("px")>0&&(f=parseInt(r.substring(0,r.indexOf("px")),10)),u&&u.indexOf("px")>0&&(f+=parseInt(u.substring(0,u.indexOf("px")),10)),t&&f>0&&i(t).set_style({height:f})),t&&(t.className=t.className)}},t.getInputDisplayText=function(n){var t=n.getBusinessDetails();return t&&t.businessName?t.businessName:n.getAddress()},t._getFormattedDistance=function(n,t){n=parseFloat(n);var i;return i=t===it.miles?n<.1?(n*bu).toFixed(0)+" "+u.getString("L_DistanceUnitFeetShort_Text"):n.toFixed(1)+" "+u.getString("L_DistanceUnitMilesShortText_Text"):n<.1?(n*ku).toFixed(0)+" "+u.getString("L_DistanceUnitMeters_Text"):n.toFixed(1)+" "+u.getString("L_DistanceUnitKm_Text"),p.RadixPointDecimal||(i=i.replace(".",",")),i},t._getDurationFormattedTime=function(n){var i="",t=Math.round(n/60),r,f;return t<1?i=u.getString("L_TimeLessThanOneMin_Text"):t<60?i=u.getString("L_TimeLessThanOneHr_Text").replace("{0}",t.toFixed(0)):t>=60&&(r=Math.floor(t/60).toFixed(0),f=Math.floor(t%60),i=f?u.getString("L_TimeMoreThanOneHr_Text").replace("{0}",r).replace("{1}",f.toFixed(0)):u.getString("L_TimeInHr_Text").replace("{0}",r)),i},t._parseCustomDateTime=function(n){var u=null,t,i,r;return n&&(t=n.split("T"),t&&t.length===2&&(i=t[0].split("-"),r=t[1].split(":"),i.length===3&&r.length===3&&(u=new Date(parseInt(i[0],10),parseInt(i[1],10)-1,parseInt(i[2],10),parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10))))),u},t._isTransitTrainLineAgencyId=function(n){return n>=-999&&n<=-500},t._addTransitTrainLineLinkElements=function(n,t,i){var e,r,o,s;return i=i||"",e=f("span","","dd_transitTrainLineText",n,""),r=u.getString("L_BuyTickets_Text").split("{0}"),r[0].length>0&&e.appendChild(document.createTextNode(r[0])),o=b.transitTrainLineComBuyTicketsUriFormat.replace("{0}",t),s=k(i,"",e,u.getString("L_TransitTrainLineCom_Text"),o),s.target="_blank",r.length>1&&r[1].length>0&&e.appendChild(document.createTextNode(r[1])),e},t._getTransitFormattedCost=function(n){return u.getString("L_TransitCostWithCurrency_Text").replace("{0}",t._formatCurrency(n))},t._formatCurrency=function(n){var e=n<0,t,i,u,f,r;for(n=Math.abs(n),n=Math.round(n*100)/100,t=n.toString(),i=t.indexOf("."),i<0&&(i=t.length+1),u=[],f=0,r=(i-1)%3;r<i;r+=3)r>0&&(u[u.length]=t.substring(f,r),f=r);return t=i<t.length?u.join(",")+t.substr(i):u.join(","),e&&(t="-"+t),t},t._getFormattedColor=function(n){return"#{0}{1}{2}".replace("{0}",(n.r<16?"0":"")+n.r.toString(16)).replace("{1}",(n.g<16?"0":"")+n.g.toString(16)).replace("{2}",(n.b<16?"0":"")+n.b.toString(16))},t._getFormattedTime=function(n){var i=n.getHours(),r="",u;return p.TransitTimeUse12Hour?(u=i>=12,i=t._convert24HourTo12Hour(i),r=i+":"+(n.getMinutes()<10?"0":"")+n.getMinutes()+(u?"PM":"AM")):r=i+":"+(n.getMinutes()<10?"0":"")+n.getMinutes(),r},t._convert24HourTo12Hour=function(n){return n>=12&&(n-=12),n||(n=12),n},t._convert12HourTo24Hour=function(n,t){return n===12&&(n=0),t&&(n+=12),n},t._getParentElementWithAttribute=function(n,t){for(var i=n.target,r;!d(i);)if(r=i.getAttribute(t),d(r))i=i.parentNode;else break;return i},t.isUndefined=function(n){return typeof n=="undefined"||typeof n=="unknown"},d=t.isNullOrUndefined=function(n){return t.isUndefined(n)||n===null},gt=t.isNullOrEmpty=function(n){return typeof n=="undefined"||typeof n=="unknown"||n===null||n===""},t.GetUniqueNetworkRequestId=function(n){var r="",t,i;return n.indexOf("{jsono}")===-1&&(t=n.indexOf("jsonso="),i=-1,t>-1&&(t=t+7,i=n.indexOf("&",t),r=i>-1?n.substr(t,i-t):n.substr(t))),r},t.convertPermalinkDictionaryToPermalink=function(n){var i="",r=!0,t;for(t in n)r||(i+="&"),i+=t+"=",t==="jsonso"?i+=n[t]:d(n[t])||(i+=encodeURIComponent(n[t].toString())),r=!1;return i},y=t.getElementById=function(n){return document.getElementById(n)},t.htmlEncode=function(n){var t=document.createElement("div"),i=document.createTextNode(n);return t.appendChild(i),t.innerHTML},t.parseQueryString=function(){var n,t;if(gt(window.location.search))return{};var u=window.location.search.substr(1),i=u.split("&"),r={},f=i.length;for(n=0;n<f;n++)t=i[n].split("="),r[t[0].toLowerCase()]=t[1];return r},r=t.createDelegate=function(n,t){return function(){if(t)return t.apply(n,arguments)}},t.extend=function(n,t){function i(){}i.prototype=t.prototype,n.prototype=new i,n.prototype.constructor=n,n.baseConstructor=t,n.superClass=t.prototype},t.getDateInSupportedFormat=function(n){var t=p.TransitDateFormat;return t.replace("m",n.getMonth()+1).replace("d",n.getDate()).replace("yyyy",n.getFullYear())},t.getDateFromStringInSupportedFormat=function(n,t){var r=null,u=null,f=null,e=t.replace(/[/.-]/ig,""),i=n.split(/[/.-]/ig);switch(e){case"dmyyyy":u=i[0],r=i[1],f=i[2];break;case"yyyymd":f=i[0],r=i[1],u=i[2];break;default:r=i[0],u=i[1],f=i[2]}return new Date(f,r-1,u)},t.getLuminance=function(n){return n.r*.212671+n.g*.71516+n.b*.072169},vr.Helper=t,DirectionPublicNamespace.Helper=t,vr.PermalinkHelper=ui,st._uniquePrefixId=0,fi=new function(){var n=this;n.getRouteModeClass=function(n){var t="";switch(n){case o.driving:t="dd_routeModeCar";break;case o.transit:t="dd_routeModeTransit";break;case o.walking:t="dd_routeModeWalking"}return t},n.createDirectionPanel=function(t,r,u){var o=n.getRouteModeClass(u),f=i("#"+r+vi,t),s,h,c;typeof gi!="undefined"&&(s=i("#"+r+ai,t),s.element()?(s.remove_class("dd_routeModeCar dd_routeModeTransit dd_routeModeWalking"),s.add_class(o)):(h=e(r+ai,"MicrosoftMap dd_directionsPanel landing noprint "+o,null),f.element()?t.insertBefore(h,f.element()):t.appendChild(h))),c=i("#"+r+yi,t),c.element()||e(r+yi,"MicrosoftMap dd_directionsPanel schedule",t),f.element()?(f.remove_class("dd_routeModeCar dd_routeModeTransit dd_routeModeWalking"),f.add_class(o)):e(r+vi,"MicrosoftMap dd_directionsPanel dd_route "+o,t)},n.getDefaultWaypointOption=function(n,t){var f=n.getOptions(),r=n.cloneOptions(f.waypointPushpinOptions),u,i;if(!r.text)for(u=n.getAllWaypoints(),i=0;i<u.length;i++)if(u[i]._uniqueId===t._uniqueId){r.text=pi[i];break}return r}},vt=function(s,h,c,a){function vt(){var n=w._state.routes,t;return n&&n.length>0&&n[0].routeLegs&&n[0].routeLegs.length>0&&(t=n[0].routeLegs[0],t.itineraryItems&&t.itineraryItems.length>0&&t.itineraryItems[0].transitLine)?t.itineraryItems[0].transitLine.providerInfo:""}function nt(n){var e=t._getParentElementWithAttribute(n,"StepIndex"),i={};if(e){var s=e.getAttribute("StepIndex"),r=s.split(":"),o=parseInt(r[2]),u=parseInt(r[0]),h=parseInt(r[1]),f=w._state.currentRouteLegs[o].itineraryItems[u];i.stepNumber=u+h+1,i.routeLegIndex=o,i.stepIndex=u,i.routeIndex=w._state.getOptions().routeIndex,i.location=new l(f.coordinate.latitude,f.coordinate.longitude),i.step=f,i.handled=!1,i.originalEventArgs=n}return i}var w=this,at,tt,d,it,rt,et,ot,st,ct,lt;w._map=s,at=c,w._panTimer=-1,w._state=a,w._taskHostIdPrefix=a._getPrefixId();var b=!1;w._disambiguationControl=null,w._pushpinManager=h,w._directionsPanel=null,w.createResultsPage=function(){b=!1;var n=w._state.getOptions(),t=w._state._getPrefixId(),r=n.itineraryContainer;fi.createDirectionPanel(r,t,n.routeMode),w._directionsPanel=i("#"+t+vi,r).element(),w._directionsPanel&&(w._directionsPanel.innerHTML=""),w.createRouteSelectionSwitcher&&n.displayRouteSelector&&w.createRouteSelectionSwitcher(),w.createItinerary(),tt()},tt=function(){var n=e(w._taskHostIdPrefix+"ResultsFooter","clearFloat",w._directionsPanel);w._createSendTo&&VEShell.App.get_environment().isSendToLinkEnabled&&w._createSendTo(n),e("","clearFloat",n),typeof d!="undefined"&&d()},w.updateReverseGeocodedText=function(n){var r=n.getAddress(),f=n.getShortAddress(),i,t;n.isViapoint()?(t=y(w._taskHostIdPrefix+"ViaText"+n._uniqueId),t&&(t.innerHTML=u.getString("L_ViaList_Text").replace("{0}",f))):(i=y(w._taskHostIdPrefix+"WaypointText"+n._uniqueId),i.innerHTML=r)},w._createNewWaypoint=function(n,r){var c,v,s,d,g,l,a,o,b,nt,tt;if(n){c=n.getLocation(),c&&(r.setAttribute("lat",c.latitude.toFixed(6)),r.setAttribute("lon",c.longitude.toFixed(6))),v=n._uniqueId,s={},n.getPushpin()?(d=n.getPushpin(),s.text=d.getText()):w._pushpinManager?s=w._pushpinManager.getDefaultOptions(n):(g=fi.getDefaultWaypointOption(w._state,n),s.text=g.text),l=e("","",r),ht?f("span","","dd_maneuver dd_MIconarriveFinish",l,""):f("span","","dd_directionStepLetter",l,s.text);var y=ft._isBusinessWaypoint(n),o=n.getBusinessDetails(),it=w._state.stoppoints[w._state.stoppoints.length-1]._uniqueId===v,p=o&&o.businessName?o.businessName:n.getAddress(),h=e("","dd_waypointDisplayText",l);y||i(h).add_class("dd_locationWaypoint"),a=null,o=n.getBusinessDetails(),o.entityId&&y&&typeof DirectionsShell!="undefined"?(a=k("","",h,p,DirectionsShell.DirectionShellUtility.getSearchResultDetailsUrl(o.entityId)),a.target="_blank"):a=t._addHtmlEncodedDivElementWithText(w._taskHostIdPrefix+"WaypointText"+v,"",h,p?p:""),y&&(n.getAddress()&&t._addHtmlEncodedDivElementWithText("","",h,n.getAddress()),b=e("","",h),o.phoneNumber&&(nt=f("span","","",b,""),nt.innerHTML=t.htmlEncode(o.phoneNumber)),o.website&&(tt=k("","dd_ContactCardSeparator dd_Website noprint",b,u.getString("L_WebsiteLink_Text"),o.website),tt.target="_blank"))}},w._createWalkingWarning=function(){if(w._state.getOptions().displayWalkingWarning){var n=e(w._taskHostIdPrefix+"MessageContainer","dd_messageContainer dd_walkingWarning",w._directionsPanel),t=e("","dd_walkingWarningIcon",n);f("span","","dd_walkingWarningText",n,u.getString("L_WalkingDirectionsSidewalkWarning_Text"))}},d=function(){var t=w._state.getOptions(),i,n;t.displayDisclaimer&&(i=e("disclaimerDiv","clearFloat",w._directionsPanel),n="",n=v==="ja-jp"?u.getString("L_DirectionsDisclaimer_Text").replace("{0}",vt()):t.routeMode===o.transit?u.getString("L_TransitDisclaimer_Text"):u.getString("L_DirectionsDisclaimer_Text").replace("{0}",u.getString("L_TermsOfUse_Text")),n=n.replace(/{year}/,(new Date).getFullYear()),f("span",w._taskHostIdPrefix+"Disclaimer_disclaimerLabel","dd_directionsDisclaimer",i,n))},w.createViapoints=function(t,r){var f,u,e,o;if(w._state.getAllViaInLeg)for(f=w._state.getAllViaInLeg(t),u=0;u<f.length;u++)e=f[u],o=it(e,r,w._taskHostIdPrefix,u===0),i(o).add_event("click",function(t){var i=t.target.getAttribute("UniqueId");t.preventDefault(),w._state.removeStoppoint(parseInt(i),!0),n.invoke(w,"updateDirections",null)})},it=function(n,t,r,o){var s=e("","dd_viapointItemContainer",t),c,h;return o&&i(s).add_class("first"),c=f("span",r+"ViaText"+n._uniqueId,"dd_viapointText",s,""),n.getAddress()&&(c.innerHTML=u.getString("L_ViaList_Text").replace("{0}",n.getAddress())),h=k("","",s,u.getString("L_RemoveVia_Text"),"#"),h.setAttribute("UniqueId",n._uniqueId),h},w.createRouteSteps=function(t,i,r,u){var s=y(w._taskHostIdPrefix+"ItineraryContainer"+u._uniqueId),h,o,c,l;for(s?s.removeChild(s.children[0]):s=e(w._taskHostIdPrefix+"ItineraryContainer"+u._uniqueId,"dd_itinerary",w._directionsPanel),h=f("ul",w._taskHostIdPrefix+"StepItems","",s,""),o=0;o<t.itineraryItems.length;o++)c=this.itineraryStepSetup(o,r,i,h,t.itineraryItems),l={stepIndex:o,routeLegIndex:i,routeIndex:w._state.getOptions().routeIndex,containerElement:c,step:t.itineraryItems[o],prevStep:o===0?null:t.itineraryItems[o-1],lastStep:o===t.itineraryItems.length-1,handled:!1},n.invoke(w,"beforeStepRender",l)},w.itineraryStepSetup=function(n,t,u,e,o){var h=o[n],s=f("li",w._state._getPrefixId()+"StepListItem"+(n+t),"dd_singleStep",e,"");return s.setAttribute("StepIndex",n+":"+t+":"+u),s.setAttribute("lat",h.coordinate.latitude.toFixed(6)),s.setAttribute("lon",h.coordinate.longitude.toFixed(6)),i(s).add_event("mouseenter",r(w,et)),i(s).add_event("mouseleave",r(w,st)),i(s).add_event("click",r(w,ct)),s},w.addWarnings=function(n,t){var s,r,i,u,o,e;if(n.length>0&&w._state.getOptions().displayStepWarnings){for(s=f("ul",w._taskHostIdPrefix+"AnnotationList","dd_annotationList",t,""),r=0,i=0;i<n.length;i++)(n[i].style===ut.ccZoneEnter||n[i].style===ut.ccZoneExit)&&r++;for(i=0;i<n.length;i++){u="",o="dd_annotation ";switch(n[i].style){case ut.info:u="dd_info";break;case ut.minor:u="dd_minor";break;case ut.moderate:u="dd_moderate";break;case ut.major:u="dd_major";break;case ut.ccZoneEnter:r!==1||b||(o+="tollzone_ccz");break;case ut.ccZoneExit:r===1&&(o+="tollzone_ccz",b=!1)}r===1?n[i].style===ut.ccZoneEnter||n[i].style===ut.ccZoneExit?rt(n[i].style,o,s):(e=f("li","",o,s,""),f("span","",u,e,""),f("span","","",e,n[i].text)):(!r||r>1)&&n[i].style!==ut.ccZoneEnter&&n[i].style!==ut.ccZoneExit&&(e=f("li","",o,s,""),f("span","",u,e,""),f("span","","",e,n[i].text))}}},rt=function(n,t,e){var s,h,o;n===ut.ccZoneEnter?b||(o=f("li","",t,e,""),s=k("","",o,u.getString("L_CongestionChargeZoneEnter_Text"),"http://www.cclondon.com"),o.title=u.getString("L_CongestionChargeZoneTooltip_Text"),s.setAttribute("target","_blank"),i(s).add_event("click",r(w,function(n){n.stopPropagation()})),h=f("span","","",o,u.getString("L_CongestionChargeZoneEnterTwo_Text")),b=!0):n===ut.ccZoneExit&&(o=f("li","",t,e,u.getString("L_CongestionChargeZoneExit_Text")))},w._onTrafficBasedRouteClicked=function(t){t.preventDefault(),w._state.setOptions({avoidTraffic:!w._state.getOptions().avoidTraffic}),n.invoke(w,"updateDirections",null)},et=function(t){n.invoke(w,"mouseEnterStep",nt(t))},ot=function(n){var t={};t.originalEventArgs=n,w._onMouseEnterStepUnhandled(t)},w._onMouseEnterStepUnhandled=function(n){for(var f=g("li.dd_singleStep"),r,u,t=0;t<f.length;t++)r=f[t],i(r).remove_class("dd_outFocus"),r!==n.originalEventArgs.currentTarget&&i(r).add_class("dd_outFocus");u=y("dd_tripSummary"),u!==n.originalEventArgs.currentTarget?i(u).add_class("dd_outFocus"):i(u).remove_class("dd_outFocus")},st=function(t){n.invoke(w,"mouseLeaveStep",nt(t))},w._onMouseLeaveStepUnhandled=function(){for(var t=g("li.dd_singleStep"),r,n=0;n<t.length;n++)r=t[n],i(r).remove_class("dd_outFocus");i("#dd_tripSummary").remove_class("dd_outFocus")},ct=function(t){n.invoke(w,"itineraryStepClicked",nt(t))},lt=function(t){n.invoke(w,"routeSelectorClicked",w._getRouteSelectorAttibute(t))},w._getRouteSelectorAttibute=function(n){var r=t._getParentElementWithAttribute(n,"RouteIndex"),i={},u;return r&&(u=parseInt(r.getAttribute("RouteIndex").toString()),i.routeIndex=u,i.containerElement=r,i.handled=!1),i},w.createRouteSummary=function(n,s,h){var v=s>=0?!1:!0,c,d,b,a;if(i(h).add_class("dd_routeSummary"),v&&i(h).add_class("dd_routeRootSummary"),n){c=e("dd_tripSummary",v?"dd_tripSummary":"",h),c.setAttribute("RouteIndex",0),i(c).add_event("click",r(w,lt)),i(c).add_event("mouseenter",r(w,ot)),i(c).add_event("mouseleave",r(w,w._onMouseLeaveStepUnhandled)),v||(d=u.getString("L_RouteSummaryLink_Text").replace("{0}",pi[s]).replace("{1}",pi[s+1]),f("span","","directive",c,d));var l=w._state.getOptions(),y=l.routeMode,g=y===o.driving?"L_RouteOverviewDriving_Text":y===o.walking?"L_RouteOverviewWalking_Text":"L_RouteOverviewOther_Text",nt=t._getFormattedDistance(n.distance,l.distanceUnit),tt=t._getDurationFormattedTime(n.time),it=u.getString(g).replace("{0}",nt).replace("{1}",tt);f("span","","",c,it),l.displayTrafficAvoidanceOption&&v&&y===o.driving&&p.TrafficAwareDirections&&w._state.currentRouteLegs.length===1&&w._state.getViaCount()===0&&(b=e("","noprint dd_trafficTime",h),!l.avoidTraffic&&n.timeWithTraffic>=n.time?(b.innerHTML=u.getString("L_RouteTimeInCurrentTrafficCondition_Text").replace("{0}",t._getDurationFormattedTime(n.timeWithTraffic)),a=k(w._taskHostIdPrefix+"TrafficBasedRouteLink","noprint dd_avoidTraffic",h,u.getString("L_SeeTrafficBasedRoute_Text"),"#"),i(a).add_event("click",r(w,w._onTrafficBasedRouteClicked))):l.avoidTraffic&&(b.innerHTML=u.getString("L_RerouteBasedOnTraffic_Text"),a=k(w._taskHostIdPrefix+"TrafficBasedRouteLink","noprint",h,u.getString("L_GoBackToThePreviousRoute_Text"),"#"),i(a).add_event("click",r(w,w._onTrafficBasedRouteClicked))))}},w.dispose=function(){w._disambiguationControl&&w._disambiguationControl.dispose();var n=w._directionsPanel;n&&(n.parentNode&&n.parentNode.removeChild(n),n=w._directionsPanel=null)}},vt._currentHighConfidenceDisambiguationHighlightPin=null,vt.getNewResultsPage=function(n,t,i,r){var u=null;switch(r.getOptions().routeMode){case o.transit:u=new lt(n,t,i,r);break;default:u=new vt(n,t,i,r)}return u},vt._createViaEROContent=function(n){var i=f("div","","",null,"");return f("span","","dd_waypointPrefix",i,u.getString("L_WaypointViaEro_Text")),t._addHtmlEncodedDivElementWithText("","dd_waypointEroAddress",i,n.getAddress()),i},vt._getHtmlFormattedInstruction=function(n){return n&&(n=n.replace(new RegExp("(<\/ExitNumber>|<\/TurnDir>|<\/RoadName>|<\/Sign>|<\/WaypointName>)","gi"),"<\/span>"),n=n.replace(new RegExp("(<ExitNumber>|<TurnDir>|<RoadName>|<Sign>|<WaypointName>)","gi"),'<span class="instructionKeyword">'),n=n.replace(new RegExp("<\/(\\S*)>","gi"),""),n=n.replace(new RegExp("<(\\S*)>","gi"),"")),n},vt.prototype={createItinerary:function(){var i=this._state.getOptions(),s,c,w,g,nt,h,tt,r,l;i.routeMode===o.walking&&this._createWalkingWarning&&this._createWalkingWarning();var k=0,f,y=this._state.getAllWaypoints(),u={itemType:"directionsResult",itineraryContainer:i.itineraryContainer,itineraryItems:[],stepsPerDestination:[],directionsOptions:{}};for(u.directionsOptions.WayPoints={},this._createHighConfidenceDisambiguation&&this._createHighConfidenceDisambiguation(this._directionsPanel),i.routeMode!==o.transit&&(c=e(this._taskHostIdPrefix+"SummaryContainer","",null),c.style.clear="both",h={summary:this._state.summary[i.routeIndex],containerElement:c,routeLegIndex:-1,handled:!1},n.invoke(this,"beforeSummaryRender",h)),f=0;f<this._state.currentRouteLegs.length;f++){if(s=this._state.currentRouteLegs[f],this._state.currentRouteLegs.length>1&&i.routeMode!==o.transit&&(c=e(this._taskHostIdPrefix+"SummaryContainer"+f,"",null),c.style.clear="both",h={summary:s.summary,containerElement:c,routeLegIndex:f,handled:!1},n.invoke(this,"beforeSummaryRender",h)),w=y[f],!ht){var it=f===0?"dd_waypoint firstWaypoint":"dd_waypoint dd_midWaypoint",d=e("",it,this._directionsPanel),rt={waypoint:w,containerElement:d,handled:!1};n.invoke(this,"beforeWaypointRender",rt),this.createViapoints&&this.createViapoints(w._uniqueId,d)}for(this.createRouteSteps(s,f,k,w),g=s.itineraryItems.length,r=0;r<g;r++)u.itineraryItems[k+r]={coordinate:s.itineraryItems[r].coordinate,distance:t._getFormattedDistance(s.itineraryItems[r].distance,i.distanceUnit),formattedText:s.itineraryItems[r].formattedText};u.stepsPerDestination[f]=s.itineraryItems.length,k+=s.itineraryItems.length}for(ht&&i.routeMode!==o.transit||(nt=e("","dd_waypoint dd_lastWaypoint",this._directionsPanel),h={waypoint:y[f],containerElement:nt,handled:!1},n.invoke(this,"beforeWaypointRender",h)),tt=y.length,r=0;r<tt;r++){var b=y[r],v=b._address,a=b._geoLocation||b._location,ut=b._isViapoint;v.length==0&&(v=a.latitude.toFixed(6)+" "+a.longitude.toFixed(6),p.RadixPointDecimal||(v=v.replace(/\./g,","))),u.directionsOptions.WayPoints["WayPoint"+r]={Address:v,IsViaPoint:ut,Latitude:a?a.latitude:0,Longitude:a?a.longitude:0}}l="";switch(i.routeOptimization){case 0:l="Time";break;case 1:l="Distance";break;case 2:l="Money";break;case 3:l="Transfers";break;case 4:l="Walking"}u.directionsOptions.AvoidOption=i.avoidTraffic,u.directionsOptions.DistanceUnitOption=i.distanceUnit,u.directionsOptions.MaxSolutionsOptions=i.maxRoutes,u.directionsOptions.OptimizeOption=l,u.directionsOptions.RouteIndex=i.routeIndex,u.directionsOptions.RouteModeOption=i.routeMode,u.directionsOptions.TimeTypeOption=i.transitOptions.timeType,n.invoke(this,"itineraryCreated",u)},createSingleItineraryStep:function(n,i,r,u,o){var b=0,v=o.getAttribute("StepIndex"),l,a,h,y,c,p,w,s;if(v&&(l=v.split(":"),l&&l.length===3&&(b=parseInt(l[1]))),a=this._state.getOptions(),n.maneuverImageName!==""&&a.displayManeuverIcons&&(h="",i&&!ei&&(h=" dd_maneuverWithDistance"),n.isImageRoadShield?(y=f("img","","dd_maneuver"+h,o,""),y.src=n.maneuverImageName):n.maneuverImageName?f("span","","dd_maneuver dd_MIcon"+n.maneuverImageName+h,o,""):f("span","","dd_maneuver"+h,o,"")),c=e("","dd_iteneraryContainer",o),i&&(p=t._getFormattedDistance(i.distance,this._state.getOptions().distanceUnit),f("div",this._taskHostIdPrefix+"StepDistance","dd_distance",c,p)),w=f("div",this._taskHostIdPrefix+"StepInstruction","dd_instruction",c,""),f("div",this._taskHostIdPrefix+"StepInstructionMain","",w,n.formattedText),this.addWarnings(n.warnings,o),n.preIntersectionHints&&a.displayPreItineraryItemHints)for(s=0;s<n.preIntersectionHints.length;s++)f("span","","dd_intersectionHint",c,n.preIntersectionHints[s]);if(n.postIntersectionHints&&a.displayPostItineraryItemHints)for(s=0;s<n.postIntersectionHints.length;s++)f("span","","dd_intersectionHint",c,n.postIntersectionHints[s])}},lt=function(t,i,r,u){var f=this;f._state=u,f._map=t,f._routeOptionHoverTimeoutHandler=-1,f._taskHostIdPrefix=u._getPrefixId(),f._optionsControl=null,lt.baseConstructor.call(this,f._map,i,r,u),f._onRouteSelectOptionClick=function(t){n.invoke(f,"routeSelectorClicked",f._getRouteSelectorAttibute(t))},f._onRouteSelectMouseEnter=function(t){n.invoke(f,"mouseEnterRouteSelector",f._getRouteSelectorAttibute(t))},f._onRouteSelectMouseLeave=function(t){n.invoke(f,"mouseLeaveRouteSelector",f._getRouteSelectorAttibute(t))}},t.extend(lt,vt),lt.prototype={_transitStepEROOpen:!1,createItinerary:function(){var n;if(v==="ja-jp"){n=e("","dd_transitItineraryTitle",this._directionsPanel),f("div","transitItineraryRouteIndex","dd_transitItineraryRouteIndex",n,u.getString("L_TransitItineraryTitle_Text").replace("{0}",this._state.getOptions().routeIndex+1));var o=e("transitItinerarySummary","dd_transitItinerarySummary",n),i=this._state.routes[this._state.getOptions().routeIndex].routeLegs[0],r=t._getDurationFormattedTime(i.summary.time);p.TransitShowRouteCost&&i.summary.monetaryCost>0&&(r+="&nbsp;&nbsp;"+t._getTransitFormattedCost(i.summary.monetaryCost)),o.innerHTML=r}lt.superClass.createItinerary.call(this)},createTransitActionInstruction:function(n,i,r,e){var o="",s,h;n.iconType==rt.walk&&v!=="ja-jp"?(s="{0} / {1}",h=s.replace("{0}",t._getFormattedDistance(n.distance,r)).replace("{1}",t._getDurationFormattedTime(n.durationInSeconds)),o=u.getString("L_WalkingDistanceFrom_Text").replace("{0}",h)):o=i==0?n.iconType===rt.bus?u.getString("L_TakeBus_Text"):n.iconType===rt.tube?u.getString("L_TakeTube_Text"):u.getString("L_TakeTrain_Text"):u.getString("L_RideAndExitAt_Text").replace("{0}",t._getDurationFormattedTime(n.durationInSeconds)),f("div","","dd_stepDistance",e,o)},getTextBetweenTag:function(n,t){var u="",i=t.indexOf("<"+n+">"),r=t.indexOf("<\/"+n+">");return i!==-1&&r!==-1&&(i+=n.length+2,i<r&&(u=t.substring(i,r))),u},createTransitInstruction:function(n,t,r){var o="",e,s,h;n&&(e=f("div","","dd_stepText",r),n.iconType!=rt.walk?t==0&&n.transitLine?(s=f("span","","dd_stepVerboseName",e,n.transitLine.verboseName),i(s).set_style({backgroundColor:"rgb("+n.transitLine.lineColor.r+","+n.transitLine.lineColor.g+","+n.transitLine.lineColor.b+")",color:"rgb("+n.transitLine.lineTextColor.r+","+n.transitLine.lineTextColor.g+","+n.transitLine.lineTextColor.b+")"}),f("span","","",e," "+n.transitTerminus)):t!=0&&n.transitLine&&(o=this.getTextBetweenTag("TransitStop",n.childItineraryItems[t].formattedText),f("span","","",e,o)):(h=this.getTextBetweenTag("EndLocation",n.formattedText),o=u.getString("L_WalkingInstruction_Text").replace("{0}",h),f("span","","",e,o)))},createTransitArrivalDepartureTimeInstruction:function(n,i,r){var s="",e,h,o;n&&(e=n.childItineraryItems[i],n&&e&&(h=t._getFormattedTime(t._parseCustomDateTime(e.time)),e.maneuver==si.transitDepart?s=u.getString("L_ScheduledDeparture_Text").replace("{0}",h):e.maneuver==si.transitArrive&&(s=u.getString("L_ScheduledArrival_Text").replace("{0}",h)),ht&&(o=RealTimeHelper.getRealTimeMetaData(n),o&&e.maneuver===si.transitDepart&&(r=k("dd_realTimeLink","",r,"",""),r.setAttribute("stopName",o.stopName),r.setAttribute("routeTag",o.routeTag),r.setAttribute("stopId",o.stopId),r.setAttribute("routes",o.routes))))),f("div","","dd_stepText",r,s)},createSingleItineraryStep:function(n,i,r,u,o){var l=this._state.getOptions(),v=f("img","","dd_TransitIcon",o,""),s,a,c,h;if(v.src=t._getInlineImage(this._state,n.maneuverImageName),s=null,n.childItineraryItems&&n.childItineraryItems.length!=0||(s=f("div","subStepContainer","dd_transitStepContainer",o),this.createTransitActionInstruction(n,0,l.distanceUnit,s),this.createTransitInstruction(n,0,s)),p.TransitShowRouteCost&&n.monetaryCost>0&&(a=t._getTransitFormattedCost(n.monetaryCost),f("span","","dd_stepCost",s,a)),this.addWarnings(n.warnings,o),n.preIntersectionHints&&l.displayPreItineraryItemHints)for(h=0;h<n.preIntersectionHints.length;h++)f("span","","dd_intersectionHint",s,n.preIntersectionHints[h]);if(n.childItineraryItems.length>0)for(s=e("subStepContainer","dd_transitStepContainer",o),c=0;c<n.childItineraryItems.length;c++)if(this.createTransitActionInstruction(n,c,l.distanceUnit,s),this.createTransitInstruction(n,c,s),this.createTransitArrivalDepartureTimeInstruction(n,c,s),c!==n.childItineraryItems.length-1)e("","dd_substepContainer",s);else if(n.postIntersectionHints&&l.displayPostItineraryItemHints)for(h=0;h<n.postIntersectionHints.length;h++)f("span","","dd_intersectionHint",s,n.postIntersectionHints[h]);n.transitLine&&t._isTransitTrainLineAgencyId(n.transitLine.agencyId)&&t._addTransitTrainLineLinkElements(s,"MSAF","dd_itineraryBuyTickets")},createRouteSelectionSwitcher:function(){var s=e(this._taskHostIdPrefix+"routeSelectionContainer","dd_routeSelectionContainer",this._directionsPanel),h,t,c,o,l;for(f("span",this._taskHostIdPrefix+"selectorTitleBar","dd_selectorTitleBar noprint",s,u.getString("L_TransitOptionsTitle_Text")),h=this._state.routes.length,t=0;t<h;t++)c=this._state.routes[t].routeLegs[0],o=e(this._taskHostIdPrefix+"routeOption"+t,"dd_routeSelectOption",s),t===this._state.getOptions().routeIndex&&(o.className+=" dd_routeSelectOptionSelected"),o.setAttribute("RouteIndex",t),l={containerElement:o,routeLeg:c,routeIndex:t,handled:!1},n.invoke(this,"beforeRouteSelectorRender",l),i(o).add_event("click",r(this,this._onRouteSelectOptionClick)),i(o).add_event("mouseenter",r(this,this._onRouteSelectMouseEnter)),i(o).add_event("mouseleave",r(this,this._onRouteSelectMouseLeave))},createRouteSelectorItem:function(n,r,o){var nt=o===this._state.getOptions().routeIndex?"dd_optionTextContainerSelected":"dd_optionTextContainer",y=e("",nt,n),tt=t._parseCustomDateTime(r.startTime),it=t._parseCustomDateTime(r.endTime),l,s,h,k,d,g,a;y.innerHTML+=t._getDurationFormattedTime(r.summary.time),y.innerHTML+=",&nbsp;"+u.getString("L_TransitSummaryStartEndTime_Text").replace("{0}",t._getFormattedTime(tt)).replace("{1}",t._getFormattedTime(it)),p.TransitShowRouteCost&&r.summary.monetaryCost>0&&(y.innerHTML+="&nbsp;&nbsp;"+t._getTransitFormattedCost(r.summary.monetaryCost));var w=e("","dd_optionIconContainer",n),b=r.itineraryItems.length,c=0;for(l=0;l<b;l++)s=r.itineraryItems[l],h="",s.transitLine&&(h=s.transitLine.abbreviatedName,h||(h=s.transitLine.verboseName)),k=f("img","","dd_TransitRouteSelectionIcon "+(l===0?"first":""),null,""),k.src=t._getInlineImage(this._state,s.maneuverImageName),w.appendChild(k),s.circularImageName?(d=f("img","","dd_CircleIcon ",null,""),d.src=t._getInlineImage(this._state,s.circularImageName),w.appendChild(d)):h&&(g=f("span","","dd_TransitRouteSelectionIconText",w,h),i(g).set_style({backgroundColor:"rgb("+s.transitLine.lineColor.r+","+s.transitLine.lineColor.g+","+s.transitLine.lineColor.b+")",color:"rgb("+s.transitLine.lineTextColor.r+","+s.transitLine.lineTextColor.g+","+s.transitLine.lineTextColor.b+")"})),s.iconType===rt.walk&&c++;v==="ja-jp"&&(a="",c>0&&(a=u.getString("L_TransitRouteToolTipWalking_Text").replace("{0}",c)+" "),b-1>c&&(a+=u.getString("L_TransitRouteToolTipTransfer_Text").replace("{0}",b-c-1)),n.title=a),e("","dd_routeStepClearBoth",n)},dispose:function(){lt.superClass.dispose.call(this),this._optionsControl&&(this._optionsControl.dispose(),this._optionsControl=null)}},lt._getHtmlFormattedInstruction=function(n){return n&&(n=n.replace(new RegExp("(<\/TransportType>|<\/TransitLineName>|<\/TransitLineTerminus>|<\/TransitStop>|<\/StartLocation>|<\/EndLocation>|<\/ServiceProvider>|<\/Phone>|<\/Action>)","gi"),"<\/span>"),n=n.replace(new RegExp("(<TransportType>|<TransitLineName>|<TransitLineTerminus>|<TransitStop>|<StartLocation>|<EndLocation>|<ServiceProvider>|<Phone>|<Action>)","gi"),'<span class="instructionKeyword">'),n=n.replace(new RegExp("<\/(\\S*)>","gi"),""),n=n.replace(new RegExp("<(\\S*)>","gi"),"")),n},ti=new function(){function i(n,t){var i=t.userData,f,r,u;t&&t.success&&n&&n[sr]&&n[sr].length===1?(f=n[sr][0],r=i[0],r&&r(f,i[2])):(u=i[1],u&&u())}function u(n,t){var i=t.userData,r=i[0],u=i[1],f=i[2],e="";t&&t.success&&n?(n[ru]&&(e=n[ru][0]),r&&r(e,u)):f&&f(null,u)}function f(n,t){var i;if(t&&t.success&&n){var r=t.userData,u=r[0],f=r[1],e=r[2];n[wi]&&(i=n[wi][0],i&&i.length==1&&u._updateWaypoint(i[0])),f&&f(u,e)}}var n=this;n.resolveWaypoint=function(i,u,e,o,s,h){var c=[];c[0]=u,c[1]=e,c[2]=s,t.getCredentials(i,r(n,function(i){var s=h.generateResolveWaypointLink(u,null,!1,o,i),l=t.convertPermalinkDictionaryToPermalink(s),e=b.directionsService+l;nt.getObjectAsync(e,r(n,f),c,-1,t.GetUniqueNetworkRequestId(e))}))},n.reverseGeocode=function(i,f,e,o,s,h){if(f){var c=[];c[0]=e,c[1]=s,c[2]=o,t.getCredentials(i,r(n,function(n){var e=h.generateReverseGeocodeLink(f,n),o=t.convertPermalinkDictionaryToPermalink(e),i=b.directionsService+o;nt.getObjectAsync(i,r(null,u),c,-1,t.GetUniqueNetworkRequestId(i))}))}},n.getNearbyArterialsResults=function(u,f,e,o,s,h){var c=[];c[0]=e,c[1]=o,c[2]=s,t.getCredentials(u,r(n,function(u){var o=h.generateNearbyArterialsLink(f,u),s=t.convertPermalinkDictionaryToPermalink(o),e=b.directionsService+s;nt.getObjectAsync(e,r(n,i),c,-1,t.GetUniqueNetworkRequestId(e))}))}},w=function(){},w._encodedCoordinateLength=2,w._encodedFullCoordinateLength=4,w._encodedCoordinateBase=1e6,w.decodeRoute=function(n,t){if(gt(n.latitudes)||(n.decodedLatitudes=w._decodeCoordinates(n.latitudes,!0),n.latitudes=""),gt(n.longitudes)||(n.decodedLongitudes=w._decodeCoordinates(n.longitudes,!0),n.longitudes=""),!gt(n.compressedPathIndexes)&&t){var i=n.zoomLevels.split(",").length,r=w.decodePathIndexes(n.compressedPathIndexes,n.decodedLongitudes,i);n.compressedPathIndexes="",n.decodedRegions=w.createLineRegions(i,n.decodedLatitudes,n.decodedLongitudes,r)}},w.decodePathIndexes=function(n,t,i){var h=t.length,o=8,e=0,a=n.charCodeAt(0),f=new Array(0),v=1,c=0,s,r,u,l;if(i>a){for(s=new Array(0),r=0;r<h;r++)s[r]=r;f[0]=s,c=1}for(r=0;r<h;r++)for(u=c;u<i;)if(o===8&&(e=n.charCodeAt(v++),o=0),o++,e&128){e=e<<1&255;break}else(f[u]===null||f[u]===undefined)&&(f[u]=new Array(0)),l=f[u].length,f[u][l]=r,e=e<<1,u++;return f},w.createLineRegions=function(n,t,i,r){for(var f=new Array(n),u=0;u<n;u++)f[u]=w._addRegionsForZoomLevel(t,i,r[u]);return f},w._addRegionsForZoomLevel=function(n,t,i){for(var f=null,s=new Array(0),w=i.length,y=100,e=y,p=0,o=[],r,u=0;u<w;u++){e>=y&&(u>0&&(s[p++]=new hi(f,o,null),o=[]),f=oi.fromCorners(new l(n[u],t[u]),new l(n[u],t[u])),e=0),r=i[u],o[e]=r;var h=f.getNorth(),c=f.getSouth(),a=f.getEast(),v=f.getWest();n[r]>h?h=n[r]:n[r]<c&&(c=n[r]),t[r]>a?a=t[r]:t[r]<v&&(v=t[r]),f=oi.fromEdges(h,v,c,a),e++}return s[p]=new hi(f,o,null),s},w._decodeCoordinates=function(n,t){for(var c=[],p=0,e=!0,o=1,r=-1,i=0,l=0,s=w._encodedFullCoordinateLength,a,b=n.length,k=w._encodedCoordinateBase,v=w._encodedCoordinateLength,f,y,h,u=0;u<b;u++)a=s-1,f=n.charCodeAt(u)^255,r++,t&&!r&&(o=(f&128)?-1:1,f&=127),i|=f,r===a?(e||i!==32767?(y=i/k,h=o*y+l,c[p++]=h,l=h,e=!1,s=v):(e=!0,s=v+2),i=0,r=-1,o=1):i<<=8;return c},ii=function(){},ii._isLastPointAdded=function(n,t){if(n.length<1)return!1;var i=n[n.length-1];return i.latitude===t.latitude&&i.longitude===t.longitude},ii.prototype={_id:null,_regions:null,_generalizedZooms:null,_regionHeap:null,_polyline:null,_locations:null,_northLat:0,_southLat:0,_westLong:0,_eastLong:0,_map:null,_mapViewChangedHandler:null,get_polyline:function(){return this._polyline},init:function(t,i,u,f,e){var s,o;if(this._map=t,this._polyline=i,this._locations=u,this._regions=f,this._generalizedZooms=e,this._id=i.getId(),this._regions)for(this._regionHeap=[],s=this._regions.length,o=0;o<s;o++)this._regionHeap[this._regionHeap.length]=this._buildRegionHeap(this._regions[o],0,this._regions[o].length-1);this._mapViewChangedHandler=r(this,this.map_ViewChanged),n.addHandler(this._map,"viewchangeend",this._mapViewChangedHandler),this._draw(),this._polyline.setOptions({visible:!0}),this._map.entities.push(this._polyline)},dispose:function(){this._map&&n.removeHandler(this._map,"viewchangeend",this._mapViewChangedHandler)},remove:function(){this._map&&this._polyline&&this._map.entities.remove(this._polyline)},map_ViewChanged:function(){this._draw()},_draw:function(){this._computeBoundaries(),this._buildLine()},_computeBoundaries:function(){var t=this._map.getHeight(),i=this._map.getWidth(),r=t<900?900:t,u=i<900?900:i,n=this._map.getBounds();this._northLat=n.getNorth(),this._southLat=n.getSouth(),this._map.getZoom()>5?(this._westLong=n.getWest(),this._eastLong=n.getEast()):(this._westLong=-180,this._eastLong=180),this._westLong>this._eastLong&&(this._eastLong+=360)},_buildLine:function(){for(var t,i,r,u,n=0;n<this._locations.length;n++)this._locations[n].shouldUseMoveTo=!1;if(t=null,this._generalizedZooms){for(i=this._generalizedZooms.length-1,r=this._map.getZoom();parseInt(this._generalizedZooms[i])<r&&i>=0;)i--;this._regionHeap&&this._regionHeap[i]&&(t=this._getVisiblePointsFromRegion(this._regionHeap[i]))}if(!t)for(t=[],u=this._locations.length,n=0;n<u;n++)t[t.length]=this._locations[n];this._setPolyline(t)},_setPolyline:function(n){var t=n.length;t<2||this._polyline.setLocations(n)},_buildRegionHeap:function(n,t,i){var o=i-t+1,r,u,s;if(o<1)return null;if(o===1)return n[t];if(r=null,u=null,o===2?(r=n[t],u=n[i]):(s=Math.round((t+i)/2),r=this._buildRegionHeap(n,t,s),u=this._buildRegionHeap(n,s+1,i)),r&&u){var f=r.boundingRectangle,e=u.boundingRectangle,h=f.getNorth()>e.getNorth()?f.getNorth():e.getNorth(),c=f.getEast()>e.getEast()?f.getEast():e.getEast(),l=f.getSouth()<e.getSouth()?f.getSouth():e.getSouth(),a=f.getWest()<e.getWest()?f.getWest():e.getWest(),v=oi.fromEdges(h,a,l,c);return new hi(v,null,[r,u])}return r?r:u?u:null},_getVisiblePointsFromRegion:function(n){var t=[],c=new l(n.boundingRectangle.getNorth(),n.boundingRectangle.getEast()),a=new l(n.boundingRectangle.getSouth(),n.boundingRectangle.getWest()),o,f,s,i,r,u,h,e;if(this._rectangleDoesNotOverlapViewport(c,a))return t;if(n.childRegions)for(o=n.childRegions.length,f=0;f<o;f++)s=this._getVisiblePointsFromRegion(n.childRegions[f]),t=t.concat(s);else for(i=this._locations[n.indexes[0]],u=!1,this._isVisible(i.latitude,i.longitude)&&(t[t.length]=i,u=!0),h=n.indexes.length,e=1;e<h;e++)r=this._locations[n.indexes[e]],this._isVisible(r.latitude,r.longitude)?(u||ii._isLastPointAdded(t,i)||(i.shouldUseMoveTo=!0,t[t.length]=i),u=!0,t[t.length]=r):u?(u=!1,t[t.length]=r):this._rectangleDoesNotOverlapViewport(i,r)||(ii._isLastPointAdded(t,i)||(t[t.length]=i),t[t.length]=r),i=r;return t},_isVisible:function(n,t){return n>=this._southLat&&n<=this._northLat&&t>=this._westLong&&t<=this._eastLong},_rectangleDoesNotOverlapViewport:function(n,t){return n.latitude>this._northLat&&t.latitude>this._northLat||n.latitude<this._southLat&&t.latitude<this._southLat||n.longitude>this._eastLong&&t.longitude>this._eastLong||n.longitude<this._westLong&&t.longitude<this._westLong}},wt=function(){},wt._splitTransitRoutes=function(n,t){var f=[],r,e,u,i,s;if(!n)return f;var o=t.decodedLatitudes.length,h=w.decodePathIndexes(t.compressedPathIndexes,t.decodedLongitudes,t.zoomLevels.split(",").length),c=t.zoomLevels.split(",").length;for(r=0;r<n.length;r++)(e=n[r].startPathIndex,u=n[r].endPathIndex,n[r].startPathIndex<0||u<0||n[r].startPathIndex>o-1||u>o-1)||(i={},i.zoomLevels=t.zoomLevels,i.decodedLatitudes=wt._getCoordinates(e,u,t.decodedLatitudes),i.decodedLongitudes=wt._getCoordinates(e,u,t.decodedLongitudes),s=wt._getPathIndexesSubset(e,u,h),i.decodedRegions=w.createLineRegions(c,i.decodedLatitudes,i.decodedLongitudes,s),n[r].coordinate=new l(i.decodedLatitudes[0],i.decodedLongitudes[0]),f[f.length]=i);return f},wt._getCoordinates=function(n,t,i){for(var u=[],f=0,r=n;r<=t;r++)u[f++]=i[r];return u},wt._getPathIndexesSubset=function(n,t,i){for(var o=new Array(i.length),r,e,u,f=0;f<i.length;f++){for(r=new Array(0),e=i[f],r[0]=0,u=0;u<e.length;u++)if(!(e[u]<=n)){if(e[u]>t)break;r[r.length]=e[u]-n}r[r.length-1]<t-n&&(r[r.length]=t-n),o[f]=r}return o},pf={info:0,warning:1,error:2},eu.getDisambiguationCoordinates=function(n){for(var i=n.getDisambiguationResult(),f=i.locationSuggestions.length>0,r=f?i.locationSuggestions:i.businessSuggestions,e=r.length,u=[],t=0;t<e;t++)u[u.length]=new l(r[t].location.latitude,r[t].location.longitude);return u},DirectionPublicNamespace.DirectionsTask=function(t){function s(){r&&(i&&i.resetDirections(),i=new wr(r),i.setRenderOptions({itineraryContainer:o,displayLandingPage:!0,directionsTask:f}),r=t)}function c(n,t){i&&n==r||s(),h(t[af],0),h(t[vf],Math.max(1,i.getAllWaypoints().length)),i.calculateDirections()}function h(n,t){if(n){var r=null,u=DirectionPublicNamespace.Waypoint;if(n instanceof u?r=n:typeof n=="string"?r=new u({address:n}):(n.address||n.location)&&(r=new u(n)),r){for(i.removeWaypoint(t);i.getAllWaypoints().length<t;)i.addWaypoint(new u(null));i.addWaypoint(r,t)}}}function l(){i.clearDisplay()}var f=this,i=null,r=t,o=document.createElement("div"),e=!1;n.addHandler(f,"remove",l),this.setIsLoading=function(t){e!=t&&(e=t,n.invoke(f,"propertychange",{propertyName:"isLoading"}))},this.init=c,this.getTitle=function(){return u.getString("L_DirectionsTaskTitle_Text")},this.getPanel=function(){return o},this.getDirectionsManager=function(){return i},this.getIsLoading=function(){return e},s()},ci.prototype.createDisambiguationPushpin=function(t){function tt(u){var s=u.target,o=s._disambiguationMetaData,h,e;i===null&&(e={id:f._state.DisambiguationPinPrefixId+t._uniqueId+"_DisInfobox",visible:!1},i=new ri(new l(o.location.latitude,o.location.longitude),e),f._handlers.push(n.addHandler(i,"mouseenter",r(i,function(){window.clearTimeout(this._timeOutHandler),this._timeOutHandler=null}))),f._handlers.push(n.addHandler(i,"mouseleave",r(i,function(){this.setOptions({visible:!1})}))),f._map.entities.push(i)),window.clearTimeout(i._timeOutHandler),i._timeOutHandler=null,i._waypointUniqueId=s._waypointUniqueId,i._disambiguationIndex=s._disambiguationIndex,h=o.entityId?!0:!1,e=d(this,o,h),e.visible=!0,ei?h||(e.height=90):e.typeName=f._isLightColorPopupRequired()?"lightInfobox":"darkInfobox",i.setLocation(new l(o.location.latitude,o.location.longitude)),i.setOptions(e)}function d(n,t,i){var f;return i?(f={title:t.name,description:t.address,actions:[{label:u.getString("L_SelectDisambiguation_Text"),eventHandler:r(n,g)}]},t.website&&f.actions.push({label:u.getString("L_WebsiteLink_Text"),eventHandler:r(t,ut)})):f={title:t.suggestion,actions:[{label:u.getString("L_SelectDisambiguation_Text"),eventHandler:r(n,g)}]},f}function it(n){n.target instanceof ct,i=n.target._infobox}function rt(){if(i){var n=window.setTimeout(r(i,function(){this._timeOutHandler&&this.setOptions({visible:!1})}),500);i._timeOutHandler=n}}function g(t){t.preventDefault(),n.invoke(this,"selected",{waypointId:i._waypointUniqueId,suggestionsIndex:i._disambiguationIndex})}function ut(n){n.preventDefault(),this.website&&window.open(this.website)}for(var f=this,v=t.getDisambiguationResult(),p=v.locationSuggestions.length>0,s=p?v.locationSuggestions:v.businessSuggestions,y=s.length,nt=p||y===0?0:s[0].index,w=[],i=null,b=f._map.getTheme(),c,h,o,k,a,e=y-1;e>=0;e--)c=new l(s[e].location.latitude,s[e].location.longitude),w.push(c),h=b===null?f._state.getOptions().disambiguationPushpinOptions:{},h.text=(e+1+nt).toString(),h.id=f._state.DisambiguationPinPrefixId+t._uniqueId+"_DisInfobox",o=new ct(c,h),b===null?(h.hoverIcon&&(o._hoverIcon=h.hoverIcon,f._attachHoverBehavior(o)),f._handlers.push(n.addHandler(o,"mouseover",r(f,tt))),f._handlers.push(n.addHandler(o,"mouseout",r(f,rt)))):(k=s[e].entityId?!0:!1,a=d(this,s[e],k),a.id=f._state.DisambiguationPinPrefixId+t._uniqueId+"_"+e,a.pushpin=o,i=new ri(c,a),f._handlers.push(n.addHandler(o,"click",r(o,it))),i._waypointUniqueId=t._uniqueId,i._disambiguationIndex=e,f._map.entities.push(i)),f._map.entities.push(o),o._disambiguationMetaData=s[e],o._waypointUniqueId=t._uniqueId,o._disambiguationIndex=e;y>0&&n.invoke(f,"disambiguationPushpinsAdded",{cordinates:w})},ci.prototype.removeDisambiguationPushpins=function(n){var t=n?n._uniqueId:"";this._removePushpins(this._state.DisambiguationPinPrefixId+t)},ci.prototype.createTransitStepPushpins=function(i){function g(n){if(o){window.clearTimeout(o._timeOutHandler),o._timeOutHandler=null;var t=n.target,i=t._stepMetadata,r={visible:!0,offset:new tt(14,16)};o.setOptions(r),o.setLocation(t.getLocation()),o.setHtmlContent(it(i).innerHTML)}}function nt(){if(o){var n=window.setTimeout(r(o,function(){this._timeOutHandler&&this.setOptions({visible:!1})}),500);o._timeOutHandler=n}}function it(n){var h=e("","",null),i,r,a,c,o,s,l;if(i=n.childItineraryItems.length<=0?e("","dd_walkingStepPopup "+(u._isLightColorPopupRequired()?"dd_lightTransitPopup":""),h):e("","dd_transitStepPopup "+(u._isLightColorPopupRequired()?"dd_lightTransitPopup":""),h),r=n.formattedText,n.iconType!==rt.tube||gt(r)||(r=r.replace(new RegExp("<TransportType>(.+?)<\/TransportType>","gi"),"<TransportType>Tube<\/TransportType>")),a=e("",ft(n.iconType)+" dd_directionIcon",i),c=n.childItineraryItems.length<=0?f("div","","dd_popupText",i,lt._getHtmlFormattedInstruction(r)):f("div","","dd_popupText dd_popupTextHeader",i,lt._getHtmlFormattedInstruction(r)),n.childItineraryItems){for(o=0;o<n.childItineraryItems.length;o++)s=e("","dd_popupText",i),l=t._parseCustomDateTime(n.childItineraryItems[o].time),f("span","","dd_eroStepTime",s,t._getFormattedTime(l)),f("span","","",s,lt._getHtmlFormattedInstruction(n.childItineraryItems[o].formattedText));n.transitLine&&t._isTransitTrainLineAgencyId(n.transitLine.agencyId)&&t._addTransitTrainLineLinkElements(s,"MSAF","dd_transitHoverBuyTickets")}return h}function ut(n,t){for(var i in n)if(n.hasOwnProperty(i)&&n[i]==t)return i;return undefined}function ft(n){var i=u._isLightColorPopupRequired(),t=ut(rt,n);return i?"dd_"+t+"DarkIcon":"dd_"+t+"LightIcon"}function et(n,t){var i=null;return i={height:48,width:null,anchor:new tt(6,41),icon:n.transitStepIcon},i.id=u._state.TransitStepPinPrefixId+t,i}var u=this,v,w,h,y,p,c,b,o;for(u._removePushpins(u._state.TransitStepPinPrefixId),v=0,w=i.length,h=0;h<w;h++){for(y=i[h],p=y.itineraryItems.length,c=0;c<p;c++){var a=y.itineraryItems[c],h=v+c,k=new l(a.coordinate.latitude,a.coordinate.longitude),s,d=et(a,h);s=new ct(k,d),u._map.entities.push(s),s._stepMetadata=a,u._handlers.push(n.addHandler(s,s instanceof ct?"mouseover":"mouseenter",r(u,g))),u._handlers.push(n.addHandler(s,s instanceof ct?"mouseout":"mouseleave",r(u,nt)))}v+=p}b={id:u._state.TransitStepPinPrefixId+"_Infobox",visible:!1},o=new ri(new l(0,0),b),u._handlers.push(n.addHandler(o,"mouseenter",r(o,function(){window.clearTimeout(this._timeOutHandler),this._timeOutHandler=null}))),u._handlers.push(n.addHandler(o,"mouseleave",r(o,function(){this.setOptions({visible:!1})}))),u._map.entities.push(o)},ui.prototype.generateDragAndDropStopPointLink=function(n,t,i,r,u,f,e){var s={},h="",tt=!n,y=tt||n.isViapoint(),a,g,k,b,o,nt;u||(h+=r.latitude.toFixed(c)+","+r.longitude.toFixed(c),s.dw=h,h="",f&&(h+=f.latitude.toFixed(c)+","+f.longitude.toFixed(c),s.lsdw=h,h="")),s.z=this._map.getZoom(),u||y||this._state.stoppoints[0]._uniqueId!==n._uniqueId||(s.start="1");var l=[],p=null,v=null,d=this._state.getOptions();if(y?(p=t.isViapoint()?this._state.getPreviousWaypoint(t._uniqueId):t,v=i.isViapoint()?this._state.getNextWaypoint(i._uniqueId):i):(p=this._state.getPreviousWaypoint(n._uniqueId),v=this._state.getNextWaypoint(n._uniqueId)),y?(a=this._state.getRouteLegByLegKey(d.routeIndex+"~"+p._uniqueId+"~"+v._uniqueId),l[l.length]=a.legId):(p&&(a=this._state.getRouteLegByLegKey(d.routeIndex+"~"+p._uniqueId+"~"+n._uniqueId),l[l.length]=a.legId),v&&(a=this._state.getRouteLegByLegKey(d.routeIndex+"~"+n._uniqueId+"~"+v._uniqueId),l[l.length]=a.legId)),tt&!u&&(s["new"]="1"),y){for(g=0,k=!1,o=0;o<this._state.stoppoints.length;o++)if(k||this._state.stoppoints[o]._uniqueId!==p._uniqueId||(k=!0),k)if(this._state.stoppoints[o]._uniqueId===t._uniqueId)break;else g++;s.sli=g.toString()}s.m=u?"1":l.length===2?"5":y?"6":"4";var it=t?t._uniqueId:n._uniqueId,rt=v?v._uniqueId:n._uniqueId,w=0;for(o=0;o<this._state.stoppoints.length;o++){if(!u&&w>=2)break;if(w>0&&(h+="~"),b=this._state.stoppoints[o],(w>0||b._uniqueId===it)&&(n||w!==1||(h+="v."+r.latitude.toFixed(c)+","+r.longitude.toFixed(c)+"~",w++),n&&b._uniqueId===n._uniqueId?(b.isViapoint()&&(h+="v."),h+=r.latitude.toFixed(c)+","+r.longitude.toFixed(c)):h+=this._getStopPointParam(b),w++),b._uniqueId===rt)break}if(s.w=h,h="",!u)for(o=0;o<l.length;o++)s["lid"+o]=l[o];return this._addRouteOptionsLink(s,!0),u&&(s.bb=this._generateMapBoundingBoxLink()),typeof VEShell!="undefined"&&(nt=this._getQueryParam(n,r),nt&&!y&&(s.q=nt)),this._addPermalinkAdditionalParams(s,e),s},st.prototype.addNewViapoint=function(t){for(var r=this.stoppoints,u=new ft({isViapoint:!0}),i=0;i<r.length;i++)r[i]._uniqueId===t&&r.splice(i+1,0,u);return n.invoke(this,"waypointAdded",{waypoint:u}),u},st.prototype.removeAllViaPoint=function(){for(var i=this.stoppoints,r,t=0;t<i.length;t++)r=i[t],r.isViapoint()&&(i.splice(t,1),n.invoke(this,"waypointRemoved",{waypoint:r}),t--)},st.prototype.removeAllViaInLeg=function(t){for(var u=this.stoppoints,f=!1,r,i=0;i<u.length;i++){if(r=u[i],f)if(r.isViapoint())u.splice(i,1),n.invoke(this,"waypointRemoved",{waypoint:r}),i--;else break;f||r._uniqueId!==t||(f=!0)}},st.prototype.getViapointCountInLeg=function(n){return d(n)?0:(n.isViapoint()&&(n=this.getPreviousWaypoint(n._uniqueId)),this.getAllViaInLeg(n._uniqueId).length)},st.prototype.getAllViaInLeg=function(n){for(var r=[],u=!1,f=this.stoppoints,i,t=0;t<f.length;t++){if(i=f[t],u)if(i.isViapoint())r[r.length]=i;else break;u||i._uniqueId!==n||(u=!0)}return r},bt=function(t,i,f,e){function at(){var t=nt.cloneOptions(nt.getOptions().viapointPushpinOptions);o=new ct(s.getCenter(),t),s.entities.push(o),ft=n.addHandler(o,"dragstart",r(h,vt)),et=n.addThrottledHandler(o,"drag",r(h,yt),250),ot=n.addHandler(o,"dragend",r(h,pt))}function vt(){p=!0,rt=n.addHandler(s,"mousemove",r(h,gt)),k=s.getWidth(),d=s.getHeight()}function yt(t){if(p){var i=t.entity;g.setLocation(i.getLocation()),n.invoke(h,"dragMove",{location:o.getLocation(),polyline:v})}}function pt(){p=!1,n.removeHandler(rt),ut(!1),n.invoke(h,"dragEnd",{location:o.getLocation(),polyline:v})}function wt(t){var f,u,i,e,c;if(!b&&!(nt.stoppoints.length>=dt)){for(f=t,o||at(),b=!0,w=-1,u=s.tryLocationToPixel(v.getLocations()),l=[],y=[],i=0;i<u.length;i++)l[i]=u[i].x,y[i]=u[i].y;it=n.addHandler(s,"mousemove",r(h,kt)),e=f.pageY-s.getPageY(),c=f.pageX-s.getPageX(),ht(c,e)}}function kt(t){if(b&&l&&y){var i=t.getX(),r=t.getY();ht(i,r)||(l=null,y=null,p||ut(!1),n.removeHandler(it),b=!1,g.setVisibility(!1))}}function gt(n){if(p){var t=n.getX()+k/2,i=n.getY()+d/2,u=0,f=0;t<50?u=Math.min(50-t,25):t>k-50&&(u=Math.max(k-50-t,-25)),i<50?f=Math.min(50-i,25):i>d-50&&(f=Math.max(d-50-i,-25)),u||f?(a=new tt(u,f),c===-1&&(c=window.setInterval(r(h,ni),250))):(a=new tt(0,0),window.clearInterval(c),c=-1)}}function ht(n,t){var u=l.length,r,f,i;if(w>-1)for(r=Math.max(0,w-1),f=Math.min(r+1,u-1),i=r;i<=f;i++)if(lt(n,t,i))return w=i,!0;for(i=0;i<u-1;i++)if(lt(n,t,i))return w=i,!0;return!1}function ni(){var n,t,i;p&&o&&(a.x||a.y)?(n=s.tryLocationToPixel(o.getLocation()),n&&(t=s.tryPixelToLocation(new tt(n.x-a.x,n.y-a.y)),o.setLocation(t),i={center:s.getCenter(),centerOffset:a,animate:!1},s.setView(i))):c!==-1&&(window.clearInterval(c),c=-1)}function ut(n){o.setOptions({visible:n})}function lt(n,t,i){var f=l[i],e=y[i],c=l[i+1],a=y[i+1],r=bt._calculateIntersectionLineConstant(n,t,f,e,c,a);if(r<0||r>1)return!1;var v=Math.round(f+r*(c-f)),p=Math.round(e+r*(a-e)),w=bt._calculateDistanceBetweenPoints(n,t,v,p);if(w<10){var b=p,k=v,h=s.tryPixelToLocation(new tt(k,b));return h&&(o.setLocation(h),ut(!0)),g.setToolTip(u.getString("L_DragToolTip_Text")),g.setLocation(h),!0}return!1}var h=this,nt=e,s=t,w=-1,c=-1,v=i,o=null,ft=null,et=null,ot=null,it=null,rt=null,st=null,l=null,y=null,b=!1,p=!1,a=null,k=0,d=0,g=f;h.getPolyline=function(){v},st=n.addHandler(v,"mouseover",r(h,wt)),h.dispose=function(){n.removeHandler(ft),n.removeHandler(et),n.removeHandler(ot),n.removeHandler(st),n.removeHandler(it),n.removeHandler(rt),v=null,o&&(s.entities.remove(o),o=null)}},bt._calculateDistanceBetweenPoints=function(n,t,i,r){var u=i-n,f=r-t;return Math.sqrt(u*u+f*f)},bt._calculateIntersectionLineConstant=function(n,t,i,r,u,f){var e=bt._calculateDistanceBetweenPoints(u,f,i,r);return((n-i)*(u-i)+(t-r)*(f-r))/(e*e)},cc_sb_ie=!!window.ActiveXObject,cc_sb_i6=kt.isIE6,di.InitCalendar=function(n,t,i,r,f){var s=new Date,e,o,h;s.setTime(i.valueOf()),e=new Date,o=new Date,o.setUTCDate(o.getUTCDate()+730),e.setUTCDate(e.getUTCDate()-730),h=[{calParent:t,id:n,lowDate:function(){return e},highDate:function(){return o},highlightDate:function(){return s},onChange:f}],di.fc_cal({els:h,daysAbvr:u.getString("L_CalendarDays_Text").split(","),monthsAbvr:u.getString("L_CalendarMonths_Text").split(","),yearUnit:"",monthUnit:"",displayYearFirst:r?1:0})},di.fc_cal=function(n){function w(n){for(var t=0;t<i.els.length;t++)if(i.els[t].id===n)return i.els[t];return{}}function a(n){if(n&&n.setHours)return n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0),n}function c(n,t){var r,u;try{if(r=document.getElementById(n),r){if(u=i.parseDate(r.innerHTML.replace(/\<.*\>/ig,"")),!isNaN(u.valueOf()))return u;throw"not a date";}}catch(f){if(t)return new Date}return undefined}function ft(){f.style.display="block",document.getElementById(f.id)||document.getElementById(i.els[0].id).appendChild(f),cc_sb_i6&&tt()}function l(){try{f[o].display="none",u.curMonth=null}catch(n){}}function d(n,t){var u,s,l,a;if(n.changeOther)try{for(u=0;u<n.changeOther.length;u++){var f=n.changeOther[u],h=f.id,e=f.amt,r=c(h),o=new Date(t.getTime());if(f.offset&&o.setDate(o.getDate()+f.offset),e>0&&r<o||e<0&&r>o||e==0){s=w(h),r=new Date(t.getTime()),r.setDate(r.getDate()+e);try{l=g(s),a=nt(s),r<l&&(r=l),r>a&&(r=a)}catch(v){}document.getElementById(h).value=i.formatDate(r),s.setCurMonth(r)}}}catch(v){}}function g(n){var t,i;if(n.lowDate&&(t=n.lowDate()),n.lowId){if(i=c(n.lowId),n.lowIdOffset)try{i.setUTCDate(i.getUTCDate()+n.lowIdOffset)}catch(r){}(!t||i>t)&&(t=i)}return t}function nt(n){var t,i;if(n.highDate&&(t=n.highDate()),n.highId){if(i=c(n.highId),n.highIdOffset)try{i.setUTCDate(i.getUTCDate()+n.highIdOffset)}catch(r){}(!t||i<t)&&(t=i)}return t}function b(){var a=g(u),v=nt(u),y,e,w,b,n,o,t,h,l,r,p;for(v&&(y=new Date(v.getTime()),y.setMonth(y.getMonth()-1)),e=c(u.id,!0),e<a&&(e=a),e>v&&(e=v),u.highlightDate&&(w=u.highlightDate()),u.highlightId&&(b=c(u.highlightId)),n=[],cc_sb_i6&&n.push('<iframe id="fc_cal_shield" src="" style="position:absolute;z-index:1;top:-',s,";left:-",s,';margin:0;padding:0" frameborder="0"><\/iframe>','<div id="fc_cal_ie6Border" class="fc_cal_holder" style="position:absolute;z-index:2;top:-',s,";left:-",s,';"><\/div>'),u.curMonth||u.setCurMonth(e),o=new Date(u.curMonth.getTime()),t=new Date(o.getTime()),t.setDate(1),h=1;h<=i.calCnt;h++){for(n.push('<div style="z-index:1001" class="fc_cal_monthHolder',h==1?" fc_cal_month_first":"",h==i.calCnt?" fc_cal_month_last":"",(o>a||!a)?"":" fc_cal_month_lowLimit",(o<y||!y)?"":" fc_cal_month_highLimit",'"><table><tr><th colspan="7">'),h==1&&n.push('<a href="#" id="fc_cal_monthDec" class="fc_cal_monthDec fc_cal_monthChange" onclick="return false">',i.decStr,"<\/a>"),h==i.calCnt&&n.push('<a href="#" id="fc_cal_monthInc" class="fc_cal_monthInc fc_cal_monthChange" onclick="return false">',i.incStr,"<\/a>"),n.push("<div>",i.formatMonth(o),"<\/div>"),n.push('<\/th><\/tr><tr class="fc_cal_days">'),l=0;l<i.daysAbvr.length;l++)n.push("<td>",i.daysAbvr[l],"<\/td>");for(r=0,n.push("<\/tr><tr>"),p=t.getDay(),p<i.firstDay&&(p=p+7),l=i.firstDay;l<p;l++)n.push('<td class="fc_cal_blank fc_cal_disabled">&nbsp;<\/td>'),r++;while(t.getMonth()==o.getMonth())r===0&&n.push("<tr>"),t<a||t>v?n.push('<td class="',t==e?"fc_cal_selected ":"",'fc_cal_disabled">',i.formatDay(t),"<\/td>"):n.push('<td class="',t.getTime()==e.getTime()?" fc_cal_current":"",w&&t.getTime()==w.getTime()?" fc_cal_highlight":"",b&&t.getTime()==b.getTime()?" fc_cal_highlight":"",'"><a href="#" id="fc_cal_day_',t.getTime(),'" onclick="return false">',i.formatDay(t),"<\/a><\/td>"),t.setDate(t.getDate()+1),r>=6?(n.push("<\/tr>"),r=0):r++;while(r<7&&r>0)n.push('<td class="blank">&nbsp;<\/td>'),r>=6&&n.push("<\/tr>"),r++;n.push("<\/tbody><\/table><\/div>"),o.setMonth(o.getMonth()+1)}f.innerHTML=n.join(""),cc_sb_i6&&tt()}function tt(){var n,t;try{n=document.getElementById("fc_cal_shield"),n[o].height=f.offsetHeight+"px",n[o].width=f.offsetWidth+"px",t=document.getElementById("fc_cal_ie6Border"),t[o].height=f.offsetHeight-y*2+"px",t[o].width=f.offsetWidth-y*2+"px"}catch(i){}}function et(n){var f=hu(n),t=f.id,r;t.indexOf("fc_cal_day_")===0?(r=new Date(parseInt(t.substring(11),10)),document.getElementById(u.id).innerHTML=i.formatDate(r),u.setCurMonth(r),d(u,r),u.onChange&&u.onChange(),l(),lr(n)):(t=="fc_cal_monthDec"&&(u.curMonth.setMonth(u.curMonth.getMonth()-1),b()),t=="fc_cal_monthInc"&&(u.curMonth.setMonth(u.curMonth.getMonth()+1),b()),lr(n),cu(n))}function it(n){var t=hu(n);u=w(t.id),lr(n),cu(n),b(),ft(t)}function ot(n){n.keyCode==9&&l()}var i=n,u,rt,f,s,y,ut,o="style",k={holderId:"fc_cal_holder",holderClass:"fc_cal_holder",firstDay:0,curMonth:undefined,incStr:"&#187;",decStr:"&#171;",calCnt:1,parseDate:function(n){try{var i=t.getDateFromStringInSupportedFormat(n,p.TransitDateFormat);if(isNaN(i.valueOf()))throw"NaN";return i}catch(r){return undefined}},formatDate:function(n){return t.getDateInSupportedFormat(n)},formatDay:function(n){return n.getDate()},formatMonth:function(n){var t=[];return i.displayYearFirst===1?t.push(n.getFullYear(),i.yearUnit," ",i.monthsAbvr[n.getMonth()],i.monthUnit):t.push(i.monthsAbvr[n.getMonth()],i.monthUnit," ",n.getFullYear(),i.yearUnit),t.join("")}},v,e,r,h;try{rt=a(new Date);for(v in k)i[v]===undefined&&(i[v]=k[v]);for(r=0;r<i.firstDay;r++)i.daysAbvr.push(i.daysAbvr.shift());for(f=document.createElement("div"),f.id=i.holderId,f.className=i.holderClass,f[o].display="none",f[o].position="absolute",f[o].zIndex="1000",i.els[0].calParent.appendChild(f),cc_sb_i6&&(s=f.currentStyle.borderWidth,y=parseInt(s.substring(0,s.length-2),10),ut=f.currentStyle.borderColor),yt(f,"click",et,!1),e=i.els,r=0;r<e.length;r++)e[r].setCurMonth=function(n){try{this.curMonth=new Date(n.getTime()),this.curMonth.setDate(1)}catch(t){}},h=e[r].calParent,e[r].lowDate&&(e[r].lowDateSaver=e[r].lowDate,e[r].lowDate=function(){return a(this.lowDateSaver())}),e[r].highDate&&(e[r].highDateSaver=e[r].highDate,e[r].highDate=function(){return a(this.highDateSaver())}),e[r].highlightDate&&(e[r].highlightDateSaver=e[r].highlightDate,e[r].highlightDate=function(){return a(this.highlightDateSaver())}),yt(h,"click",it),yt(h,"focus",it),yt(h,"keydown",ot),yt(h,"change",l),e[r].onChange&&yt(h,"change",e[r].onChange),e[r].changeOther&&yt(h,"change",function(){var n=w(this.id),t=c(this.id);d(n,t)});yt(document,"click",l),yt(window,"resize",l)}catch(st){}},st.prototype.moveWaypoint=function(n,t){for(var f=null,r=this.stoppoints,u,i=0;i<r.length;i++)if(u=r[i],u._uniqueId===n){f=u,this.removeStoppoint(n,!0);break}if(f)if(t){for(this.removeAllViaInLeg&&this.removeAllViaInLeg(t),i=0;i<r.length;i++)if(u=r[i],u._uniqueId===t){r.splice(i+1,0,f);break}}else r.splice(0,0,f)},st.prototype.addRoundTripWapoint=function(){var r=this.stoppoints,t=r[0],u;if(t.getAddress()){u=null,t.getLocation()&&(u=t.getLocation());var i=t.getBusinessDetails(),e={address:t.getAddress(),location:u,isViapoint:!1,exactLocation:t.isExactLocation(),businessDetails:{businessName:i.businessName,phoneNumber:i.phoneNumber,entityId:i.entityId,website:i.website}},f=new ft(e);return r[r.length]=f,n.invoke(this,"waypointAdded",{waypoint:f}),f}return null},st.prototype.isRoutableLatLongAvailableForAllStopPoints=function(){var t=this.stoppoints,n,i;if(t.length<2)return!1;for(n=0;n<t.length;n++)if(i=t[n],!i.getLocation())return!1;return!0},gi=function(s,c,a,v){function bt(){var t=p.getOptions(),r=p._getPrefixId(),u=t.itineraryContainer,n;return fi.createDirectionPanel(u,r,t.routeMode),n=i("#"+r+ai,u).element(),n.innerHTML="",n}function kt(n,t){var o,c,l,a,v,s,h;if(n)return o=e(b+"WaypointContainer"+n._uniqueId,"waypointContainer firstWaypoint",null),o.setAttribute("WaypointUniqueId",n._uniqueId),t&&(w._ddInputZIndex=400),o.style.zIndex=w._ddInputZIndex,w._ddInputZIndex--,c=y(b+"AddStopDiv"),d.insertBefore(o,c),l=f("span",b+"LandingLetter"+n._uniqueId,"dd_directionStepLetter",o,""),o.appendChild(document.createTextNode("")),a=ri(o,n,t,"sw_b ddInput","sw_qbox ddInputBox"),v=i(l),v.add_event("mousedown",r(w,wi)),s=k(b+"WaypointClose"+n._uniqueId,"closeWaypoint closeWaypointLanding",a,"","#"),i(s).set_attr("WaypointUniqueId",n._uniqueId),i(s).add_event("click",r(w,nr)),t&&(h=k(b+"WaypointReverse","dd_reverseDirections",o,"","#"),h.title=u.getString("L_DirectionsMenuReverse_Text"),i(h).add_event("click",r(w,ni))),vi(n,o),o}function gt(n){var t=e(b+"AddStopDiv","addStopContainer",n);return rt=k(b+"AddStop","addStop",t,u.getString("L_AddStop_Text"),"#"),i(rt).add_event("click",r(w,ii)),yi(t),t}function ni(t){t.preventDefault(),p.reverseWaypoints(),n.invoke(w,"optionsChanged",{refreshLandingPage:!0})}function ii(t){t.preventDefault();var i=new ft({});p.addStoppoint(i),n.invoke(w,"optionsChanged",{clearResultsPage:!0,refreshLandingPage:!0})}function st(){var n=p.stoppoints[0],r=p.stoppoints[p.stoppoints.length-1],u=i("#"+b+"RoundTrip"),t=u.element();t&&(t.checked=n.getAddress()&&n.getAddress()===r.getAddress())}function ot(){t.RemoveDomElement(b+"OneClickDirectionsContainer")}function ri(n,u,f,o,s){var c=e(b+"basicWrapper"+u._uniqueId,o,n),h;return i(c).set_style({position:"static"}),h=t._addInputElement(b+"WaypointInput"+u._uniqueId,s,c,t.getInputDisplayText(u),"text",""),h.setAttribute("WaypointUniqueId",u._uniqueId),h.setAttribute("SubmitButtonId",b+"ShowDirections"),h.onChange=r(w,ct),i(h).add_event("change",r(w,hi)),i(h).add_event("keydown",r(w,oi)),c}function ui(){typeof VEShell!="undefined"&&VEShell.Logging.get_instance().logSubmit(b+"ShowDirections"),p.removeEmptyWaypoints(),p.directionsStartTime=(new Date).getTime(),n.invoke(w,"updateDirections",{needsTwoWaypoints:!0})}function ei(n){n.preventDefault()}function oi(n){var i=parseInt(n.target.getAttribute("WaypointUniqueId")),r=p.getStoppointIndex(i);r&&r!==1||ot(),yt(i),t.RemoveDomElement(b+"MessageContainer"),tr(i)}function si(n){var e=t._addInputElement(b+"WaypointClear","button clearButton",n,u.getString("L_Clear_Text"),"button",""),f;i(e).add_event("click",r(w,ht)),f=t._addInputElement(b+"ShowDirections","button goButton",n,u.getString("L_DirectionsGetDirections_Text"),"Submit",""),f.onclick=r(w,ui),i(f).add_event("click",r(w,ei))}function hi(n){ct(n.target)}function ct(t){var s=i(t).get_val().trim(),c=t.getAttribute("WaypointUniqueId").toString(),e,h,v,r,b,y;if(s===u.getString("L_DirectionsAddressCityLocation_Text")&&(s=""),e=p.getStoppointById(parseInt(c)),e){var f=null,a=t.getAttribute("serializedWaypointAddress"),o="";a&&(o=a.toString(),t.removeAttribute("serializedWaypointAddress"),o&&(h=o.indexOf(";"),h>0&&(v=o.substring(0,h),r=v.split(","),r.length===4&&(r[0]&&r[1]?f=new l(parseFloat(r[0]),parseFloat(r[1])):r[2]&&r[3]&&(f=new l(parseFloat(r[2]),parseFloat(r[3]))))))),e.clear(),b=ci(parseInt(c)),y=f?new l(f.latitude,f.longitude):null,e.setOptions({address:s,location:f,geoLocation:y}),n.invoke(w,"optionsChanged",{refreshLandingPage:!1,clearResultsPage:!0}),window.setTimeout(w._setFocus,1)}}function ci(n){var f=!1;if(p&&p.stoppoints){var e=p.getPreviousWaypoint(n),o=p.getNextWaypoint(n),s=p.getStoppointById(n),i=e?e:s,r=o?o:s;if(p.stoppoints.length>0&&i&&r&&i!==r)for(var u=0,t=p.stoppoints[u],h=!0;t&&t!==r;){if(h)t===i&&(h=!1);else if(t.isViapoint()){p.removeStoppoint(t._uniqueId,!1),f=!0,t=p.stoppoints[u];continue}t=p.stoppoints[u++]}}return f}function li(){var n=e(b+"ButtonPanel","buttonPanel",d);return si(n),n}function lt(){var r=p.getOptions().itineraryContainer,n=i("div[id*="+b+"WaypointContainer]",r),u=n.length,s=u>2?"inline":"none",v=i("a[id*="+b+"WaypointClose]",r),h,c,f,l,t,e,a;for(v.set_style({display:s}),h=i("#"+b+"ReverseRoute",r),h.set_style({display:s}),c=i("#"+b+"WaypointReverse",r),c.set_style({display:u===2?"inline":"none"}),f=i("div[id*="+b+"basicWrapper]",r),f.remove_class("waypointCloseMargin"),u>2&&f.add_class("waypointCloseMargin"),l=i("span[id*="+b+"LandingLetter]",r),n.remove_class("firstWaypoint"),n.remove_class("dd_midWaypoint"),n.remove_class("dd_lastWaypoint"),t=0;t<u;t++)e=l.element(t),e&&(e.innerHTML=pi[t]),t?t===u-1?i(n.element(t)).add_class("dd_lastWaypoint"):i(n.element(t)).add_class("dd_midWaypoint"):i(n.element(t)).add_class("firstWaypoint");rt&&(n=p.getAllWaypoints(),a=p.getOptions().routeMode===o.transit?or:dt,rt.style.display=n.length>=a?"none":"inline"),st()}function vi(){}function yi(s){var v=null,a;p.getOptions().routeMode===o.transit&&(v=e(b+"TransitOptionsDiv","collapsibleRouteOptions routeOptionsContainer",d));var ft=e(b+"RouteSettingsDiv","optionsContainer",s),h=f("fieldset",b+"RouteSettings","routeOptions",s,""),y=f("span",b+"DistanceUnit","distanceUnit",h,""),k=f("span","","radio",y,""),c=t._addInputElement(b+"mi","",k,"mi","radio","routeDistanceUnit"),rt=f("label",b+"miLabel","",k,u.getString("L_MilesSettings_Text"));rt.setAttribute("for",c.id),i(c).add_event("click",r(w,at));var nt=f("span","","radio",y,""),l=t._addInputElement(b+"km","",nt,"km","radio","routeDistanceUnit"),ut=f("label",b+"kmLabel","",nt,u.getString("L_KmSettings_Text"));ut.setAttribute("for",l.id),i(l).add_event("click",r(w,at)),p.getOptions().distanceUnit===it.miles?i(c).set_attr("checked","checked"):i(l).set_attr("checked","checked"),g||(g=new bf(p,!0)),g.addCollapsibleHeader(null,u.getString("L_ShowOptions_Text"),h,!0),a=g.showRouteOptionsForCurrentMode(h,v),tt.push(n.addHandler(g,"optionsChanged",function(t){t.updateDirections?n.invoke(w,"optionsChanged",{refreshLandingPage:!1}):n.invoke(w,"optionsChanged",{clearResultsPage:!0,refreshLandingPage:!1})})),i("label",a).add_class("optionsLabel"),i("#SaveDestinationHistory",a).add_class("dd_checkboxInput")}function at(t){p.setOptions({distanceUnit:bi===i(t.target).get_val()?it.miles:it.kilometers}),n.invoke(w,"optionsChanged",{refreshLandingPage:!1}),VEShell.Cookie.create(of,p.getOptions().distanceUnit===it.miles?bi:sf,1)}function wi(n){var t,u,f;n.stopPropagation(),w._isDragging=!0,t=n.target.parentNode,w._moveTarget=t,u=i(t),i("#"+b+"WaypointReverse").set_style({display:"none"}),i("a[id*="+b+"WaypointClose]").set_style({display:"none"}),i("#"+p._getPrefixId()).add_class("disableSelection"),ot(),u.add_class("waypointDragging"),w._waypointMeasuredHeight=u.has_class("dd_lastWaypoint")?t.offsetTop-t.previousSibling.offsetTop:t.nextSibling.offsetTop-t.offsetTop,f=i.Screen.get_mouse_pos(n).y,ut=f,w._waypointDragMouseUpHandler=r(w,di),i(document.documentElement).add_event("mouseup",w._waypointDragMouseUpHandler,!1),w._waypointDragMouseMoveHandler=r(w,ki),i(document.documentElement).add_event("mousemove",w._waypointDragMouseMoveHandler,!1),i.Events.capture_mouse(document.documentElement)}function ki(n){if(w._isDragging){var t=w._moveTarget,o=i.Screen.get_mouse_pos(n).y,f=i(t),r=o-ut,u=w._waypointMeasuredHeight,e=!1;!f.has_class("firstWaypoint")&&r<-.5*u?(t.parentNode.insertBefore(t,t.previousSibling),e=!0,r=u/2):!f.has_class("dd_lastWaypoint")&&r>.5*u&&(t.parentNode.insertBefore(t,t.nextSibling.nextSibling),e=!0,r=-u/2),e&&(lt(),i("#"+b+"WaypointReverse").set_style({display:"none"}),i("a[id*="+b+"WaypointClose]").set_style({display:"none"}),ut=o-r),f.set_style({top:r+"px"})}}function di(){var u;i.Events.release_mouse(),i(document.documentElement).remove_event("mouseup",w._waypointDragMouseUpHandler,!1),i(document.documentElement).remove_event("mousemove",w._waypointDragMouseMoveHandler,!1),w._isDragging=!1;var t=i(w._moveTarget),f=parseInt(t.get_attr("WaypointUniqueId")),r="";t.has_class("firstWaypoint")||(u=i(w._moveTarget.previousSibling),r=parseInt(u.get_attr("WaypointUniqueId"))),p.moveWaypoint(f,r),n.invoke(w,"optionsChanged",{refreshLandingPage:!0}),i("#"+p._getPrefixId()).remove_class("disableSelection"),i(".waypointDragging").set_style({top:"0px"}).remove_class("waypointDragging")}function vt(){if(!(p.stoppoints.length<=1)){var n=p.stoppoints[0],t=p.stoppoints[1].getLocation();n.getAddress()||n.getLocation()||!t||ti.getNearbyArterialsResults(wt,t,r(w,gi),null,null,pt)}}function gi(t){var c,s,d,a;if(ot(),c=p.getOptions(),t.length&&(!c||c.routeMode===o.driving)){var h=p.stoppoints[0],g=y(b+"WaypointContainer"+h._uniqueId),v=e(b+"OneClickDirectionsContainer","ddOneClickDirectionsContainer",g);for(f("span",b+"OneClickDirectionsMessage","ddOneClickDirectionsHeader",v,u.getString("L_OneClickDirectionsHeader_Text")),s=0;s<t.length;s++)d=e("","ddOneClickDirectionsArterials",v),a=k(b+"OneClickDirectionsOption"+s,"",d,t[s].address.formattedAddress,"#"),i(a).set_attr("OptionNumber",s.toString()),i(a).add_event("click",r(w,function(r){r.preventDefault();var u=parseInt(i(r.target).get_attr("OptionNumber")),f={address:t[u].address.formattedAddress,location:new l(t[u].latitude,t[u].longitude)};h.clear(),h._locationIdentifier=t[u].locationIdentifier,h.setOptions(f),n.invoke(w,"updateDirections",null)}));w._setFocus(!0)}}function nr(i){i.preventDefault();var r=i.target.getAttribute("WaypointUniqueId").toString(),u=y(b+"WaypointInput"+r);t.removeBehavior(u),p.removeStoppoint(parseInt(r),!0),typeof VEShell!="undefined"&&VEShell.Logging.get_instance().logSubmit(i.currentTarget.id),n.invoke(w,"optionsChanged",{refreshLandingPage:!0})}function tr(n){t.RemoveDomElement(b+"DisambiguationOuterContainer"+n)}function yt(n){var i=y(b+"WaypointContainer"+n),t=y(b+"WaypointBizDataContainer_"+n);t&&i.removeChild(t)}var w=this,ut=-1,et=c,pt=a,nt=null,g=null,d=null,p=v,tt=[],b=p._getPrefixId(),wt=s,rt,ht;w._createWaypointDisambiguation=function(n){var t=n.waypoint,r=y(b+"WaypointContainer"+t._uniqueId),i=e(b+"DisambiguationOuterContainer"+t._uniqueId,"",r);n.containerElement=i,e(b+"DisambiguationContainerBeak"+t._uniqueId,"disambgContainerBeak",i)},w._waypointChanged=function(n){n&&!n.getDisambiguationResult()&&(p.getStoppointIndex(n._uniqueId)===1&&vt(),st(),yt(n._uniqueId),t.RemoveDomElement(b+"MessageContainer"))},w._createLandingPage=function(t,i){var r,l,s,a,e,c;for(d=bt(),nt||(nt=new wf(p)),nt.createModeSwitchingIcons(d),tt.push(n.addHandler(nt,"modeChanged",function(){n.invoke(w,"optionsChanged",{refreshLandingPage:!0})}));p.stoppoints.length<2;)r=new ft({}),p.addStoppoint(r);for(p.stoppoints[p.stoppoints.length-1].isViapoint()&&(r=new ft({}),p.addStoppoint(r)),p.stoppoints[0].isViapoint()&&(r=new ft({}),p.addStoppoint(r,0)),l=p.getOptions().routeMode===o.transit?or:dt,p.stoppoints.length>l&&(t=u.getString("L_ExceedMaxWaypointLimitError_Text").replace("{0}",dt),i=h.exceedMaxWaypointLimit),t&&i!==h.waypointDisambiguation&&f("span",b+"MessageContainer","dd_messageContainer",d,t),s=p.stoppoints,a=null,e=0;e<s.length;e++)c=s[e],c.isViapoint()||(a=kt(c,!e),e||vt());gt(d),li(),lt()},w.updateReverseGeocodedText=function(n){var r=n.getAddress(),t=y(b+"WaypointInput"+n._uniqueId);t&&(t.value=r,i(t).remove_class("Watermark"))},w.createLandingPushpins=function(){et&&(et.removeAllPushpins(),et.createPushpins(p.getAllWaypoints()))},w._setFocus=function(n){var e=!1,t=i("a[id^="+b+"DisambiguationAddressLink]"),u,r,f;if(t.length>0)t=t[0];else{for(t=null,u=p.getAllWaypoints(),r=0;r<u.length;r++)if(!u[r].getAddress()&&!u[r].getLocation()){t=y(b+"WaypointInput"+u[r]._uniqueId),e=!0;break}t||(t=y(b+"ShowDirections"))}if(t){try{t.focus()}catch(o){}n&&e&&window.Sys&&window.Sys.UI&&window.Sys.UI.Behavior&&(f=Sys.UI.Behavior.getBehaviorByName(t,"PersonalizationBehavior"),f&&f.hideList())}},ht=function(){var t=p.getOptions(),i=t.distanceUnit;p.resetDirectionState({removeAllWaypoints:!0,resetRequestOptions:!0}),p.setOptions({distanceUnit:i,routeMode:t.routeMode}),n.invoke(w,"optionsChanged",{clearResultsPage:!0,refreshLandingPage:!0})},w.dispose=function(){var f,u;for(nt&&nt.dispose(),g&&g.dispose(),d&&(f=i("input[id*="+b+"WaypointInput]").for_each(r(w,function(n){t.removeBehavior(n)})),d.parentNode&&d.parentNode.removeChild(d),d=null),u=tt.length;u--;)n.removeHandler(tt[u]);tt=[]}},ui.prototype.addDirectionsPermalinkParameters=function(n,t){var i,e,u,r,o,f;if(this._state.stoppoints&&this._state.stoppoints.length>=2){for(i=new Sys.StringBuilder,e=this._state.stoppoints.length,u=0;u<e;u++)r=this._state.stoppoints[u],d(r.getLocation())?(i.append("adr."),i.append(IOSec.DecodeHtml(r.getAddress()))):(r.isViapoint()?i.append("v."):i.append("pos."),o=r._geoLocation?r._geoLocation:r.getLocation(),i.append(o.latitude.toFixed(c)),i.append("_"),i.append(o.longitude.toFixed(c)),i.append("_"),i.append(IOSec.DecodeHtml(r.getAddress())),r.isViapoint()||(f=r.getBusinessDetails(),i.append("_"),i.append(IOSec.DecodeHtml(f.businessName)),i.append("_"),i.append(IOSec.DecodeHtml(f.phoneNumber)),i.append("_"),i.append(IOSec.DecodeHtml(r.isExactLocation()?"e":"a")),i.append("_"),i.append(IOSec.DecodeHtml(f.entityId))),t&&(i.append("_"),i.append(r._locationIdentifier))),u!==e-1&&i.append("~");n.rtp=i,i="",this._addRouteOptionsLink(n,!1)}},ui.prototype.getDummyRequestPermalink=function(n,t){var i={},r;return i.m="2",n&&t?(d(t.query)||(i.q=t.query),d(t.queryType)||(i.t=t.queryType),i.rt="s"):(r=this._getQueryParam(null,null),d(r)||(i.q=r),i.rt="d"),this._addPermalinkAdditionalParams(i,null),i},ui.prototype.getPrintPageUrl=function(){var n,r;if(this._state.stoppoints&&this._state.stoppoints.length>=2&&this._state.summary){var u=this._state.stoppoints[0],f=this._state.stoppoints[this._state.stoppoints.length-1],i={};return this.addDirectionsPermalinkParameters(i,!0),n=new Sys.StringBuilder,this._state.getOptions().routeMode===o.transit?(i.sri=this._state.routes[this._state.getOptions().routeIndex].routeLegs[0].originalRouteIndex,n.append("&pt=pr")):n.append("&pt=pf"),r=t.convertPermalinkDictionaryToPermalink(i),n.append("&"),n.append(r),n.append("&cmw="),n.append(this._map.getWidth().toString()),n.append("&cmh="),n.append(this._map.getHeight().toString()),n.append("&u="),n.append(this._state.getOptions().distanceUnit===it.miles?"0":"1"),n.toString()}return"&pt=pb"},ni.prototype.addDirectionsPermalinkParameters=function(n,t){this._permalinkHelper.addDirectionsPermalinkParameters(n,t)},ni.prototype.getPrintPageUrl=function(){return this._permalinkHelper.getPrintPageUrl()},ni.makeDummyRequest=function(n,i,u){var e=n.getDummyRequestPermalink(i,u),o=t.convertPermalinkDictionaryToPermalink(e),f=b.directionsService+o;nt.getObjectAsync(f,r(this,null),null,-1,t.GetUniqueNetworkRequestId(f))},ar=DirectionPublicNamespace.DirectionsManager.prototype,ar.addDirectionsPermalinkParameters=function(n,t){this._getTask().addDirectionsPermalinkParameters(n,t)},ar.getPrintPageUrl=function(){return this._getTask()._permalinkHelper.getPrintPageUrl()},delete window[$MapsNamespace].Maps.initDirectionsCode,at.Dynamic&&at.Dynamic.done("Microsoft.Maps.Directions"),pt.end("Module initialized","Microsoft.Maps.Directions",{module:"Directions"})},window[$MapsNamespace].Maps.Map&&window[$MapsNamespace].Maps.initDirectionsCode&&window[$MapsNamespace].Maps.initDirectionsCode(),window.$MapsNamespace=window.$MapsNamespace||"Microsoft",window[$MapsNamespace]=window[$MapsNamespace]||{},window[$MapsNamespace].Maps=window[$MapsNamespace].Maps||{},window[$MapsNamespace].Maps.initSearch=function(){function ti(n){function r(n){n&&!n.locale&&(n.locale=s.locale)}function u(n){n&&!n.bounds&&(n.bounds=t.getBounds())}function e(n,t,r,u){var l=null,e,o,s,a,v;n&&t&&(e=rr.getIntents(n,t),n.renderOptions&&(e.directions?(o=e.intentCategories,s=f.Dragonfly,o&&s&&(a=s.instance("TaskActivator"),a.activateTask("DirectionsTask",{DDStart:o[b.from],DDEnd:o[b.to]}))):(v=(e.location||e.traffic)&&!nu(n)?h.location:e.categoryBrowse?h.categoryBrowse:e.disambiguation?h.disambiguation:(e.business||n.isBusinessDetailsQuery)&&c(t)?h.business:h.noResults,t.classification=v,t.intents=e,l=i.updateTask(n,t))),u&&(n.callback=u,u(t,r,l,e)))}function o(n,t){var r={},u=null;n&&(r.classification=h.noResults,u=i.updateTask(n,r),t&&(n.errorCallback=t,t(n,r,u)))}var l=this,t=n,i;this._initSingleton=function(){i=new uu(t),n.addComponent(w,this)},this.search=function(n){var f,s,h;t&&(u(n),r(n),f=n.count||vi,f>st&&(f=st),n.count=f,n.startIndex=n.pageNumber?(n.pageNumber-1)*f:n.startIndex||0,n.radius>0||(n.radius=yt),n.renderOptions&&i&&(s=n.callback,h=n.errorCallback,n.callback=function(t,i){e(n,t,i,s)},n.errorCallback=function(){o(n,h)}),tr.search(n,t))},this.getBusinessDetails=function(n,t,i,r){var u={additionalInfoOptions:{addressLookup:1},advanced:1,isBusinessDetailsQuery:1,query:n,errorCallback:i,userData:r};u.callback=function(n,i){var r=ir(n,u);t&&t(r,i)},this.search(u)},this.geocode=function(n){t&&(r(n),u(n),ii.geocode(n,t))},this.reverseGeocode=function(n){t&&(r(n),ii.reverseGeocode(n,t))}}function ri(n){var t=n&&(n[nt]?n[nt].ResponseSummary:n.ResponseSummary);return t?t.StatusCode===0:!1}function c(n){var i=null,t;return ri(n)&&(t=n[nt].ResultSets,t&&(i=t[0])),i}function ir(n,t,i){var u,r;i=i||{};var e=c(n),o=n&&n.brands,f=e&&e.Results||[],p=t&&t.startIndex||0,h=Math.min(f.length,i.count||f.length),l=new Array(h);for(u=0;u<h;u++){if(r=f[u],r){r.uid=r.Id||ht.newGuid(),r.displayIndex=p+u+1,ei(r,r&&r.LocationData&&r.LocationData.Locations),r.detailsUrl=s.localDetailsUrl.replace("{0}",r.Id).replace("{1}",r.Name).replace("{2}","SEARCH");var a=r.AdditionalProperties,v=r.brand=o&&o[a&&a.BrandId],y="moderate";typeof VEShell!="undefined"&&VEShell.App&&VEShell.App.get_environment().adultFilter&&(y=VEShell.App.get_environment().adultFilter),y.indexOf("strict")!=0?r.Website||(r.Website=v&&v.WebsiteUrl):r.Website=null,iu(r,t.renderOptions&&t.renderOptions.task)}l[u]=kr(r)}return l}function kr(n){var i=null,u,f,r,t;if(n){if(u=n.Address&&n.Address.FormattedAddress,f=n.PhoneNumber?'&nbsp;&#183;&nbsp;<span class="phone">'+n.PhoneNumber+"<\/span>":"",i={uid:n.uid,location:n.location,name:n.Name,address:u,phoneNumber:n.PhoneNumber,websiteUrl:n.Website,detailsUrl:n.detailsUrl,source:n,entityType:"yp",brand:n.brand},r=[u,f],t=n.brand,t){i.icon=t.PushpinIconUrlStandard;var e=t.SearchLogoUrl,o=t.CallToActionText,s=t.CallToActionUrl;e&&r.push('<img class="resultBrandIcon" src="'+e+'"><\/img>'),o&&s&&r.push('<a href="'+s+'" target="_blank">'+o+"<\/a>")}i.displayIndex=n.displayIndex,i.description=r.join("")}return i}function ui(n){var t=null;return ri(n)&&(t=n[nt].GeocodeFulfillments),t}function dr(n,t){n[nt].GeocodeFulfillments=t}function k(n){var t=null,i=c(n);return i&&(t=i.SearchRegion),t}function gr(n,t){return(typeof n!="number"||!isFinite(n)||n<-424||n>8848)&&(n=t),n}function fi(n){var t=0,i;return n=n||{},i=new y(n.Latitude||t,n.Longitude||t,gr(n.Altitude,t),0),i.calculationMethod=n.CalculationMethod,i}function ei(n,i){var u,r;if(n&&i)for(u=0;u<i[t];u++)if(r=i[u],r){r=fi(r);switch(r.calculationMethod){case"Rooftop":case"rooftop":case"Parcel":n.location=r;break;case"Interpolated":case"Interpolation":n.routableLocation=r}!n.location&&n.routableLocation?n.location=n.routableLocation:!n.routableLocation&&n.location&&(n.routableLocation=n.location)}}function lt(n){if(n)return ft.fromLocations(fi(n.Northeast),fi(n.Southwest))}function nu(n){return n&&n.additionalInfoOptions&&n.additionalInfoOptions.autoRefresh}function d(n,t){var i;if(n&&t){var f=n.query||"",u=n.where||"",e=c(t),r=e&&e.Parse;r?i={what:r.Keyword,where:r.Address&&r.Address.FormattedAddress||r.Landmark,separator:r.LocationSeparator}:(i={what:f},u&&(i.where=u)),i.rawWhat=f,i.rawWhere=u}return i}function oi(t,u){if(u instanceof ur){var f=n.createAnchor("#",r("L_NwywLink_Text"),"nwywLink");f&&(u.addContent(i.actions,n.createElement("li","nwywAction",[f])),o(f).add_event("click",function(n){n.preventDefault(),o(this).remove_event("click",arguments.callee,!1),new sr(t).load()}))}}function tu(n){var i=!1,t;return ri(n)&&(t=n[nt].ResultSetMicroPoiOptions,i=t&&t.length&&t[0]&&t[0].MicroPoiRequestIsAllowed),i}function iu(n,t){if(brand=n.brand,brand&&t&&(theme=t.getMap().getTheme(),theme)){var i={width:25,height:25,anchor:new f.Point(14,14),textOffset:new f.Point(0,5),zIndex:10,iconStyle:"brand",icons:{}},r=brand.PushpinIconUrlStandard;i.icons.dark=i.icons.light=r,r=s.bingThemeIconUrlFormat,r=r.replace("{iconStyle}",i.iconStyle).replace("{imageryStyle}","dark").replace("{state}","_h"),i.icons.dark_h=i.icons.dark_s=r,r=s.bingThemeIconUrlFormat,r=r.replace("{iconStyle}",i.iconStyle).replace("{imageryStyle}","light").replace("{state}","_h"),i.icons.light_h=i.icons.light_s=r,theme.registerIconData("pinbrand"+brand.BrandId,i)}}function ru(n){function v(){clearTimeout(i.timerId),i.callback=null,u.removeHandler(i.viewChangeStartHandler),u.removeHandler(i.viewChangeEndHandler)}function w(){clearTimeout(i.timerId)}function b(){f&&(i.timerId=window.setTimeout(k,2e3))}function k(){var t;if(i.timerId=null,t=i.callback,f&&t&&!i.skipNext){var u=i.lastLocation,r=f.getTargetCenter(),e=wi(u,r)*.6214;e>i.threshold&&(i.lastLocation=r,t&&t(n))}i.skipNext=!1}function d(){f=o&&o.getMap(),s=f?!0:!1,h=[],i={enabled:!1},f&&(l=u.addHandler(f,"viewchangeend",g),a=u.addHandler(f,"tiledownloadcomplete",nt))}function g(){f.isDownloadingTiles()||o.logMapViewComplete()}function nt(){o.logMapViewComplete()}function tt(i,e){var s,ot,b,yt,g,nt,tt,a,v,l,k,w,it;if(f&&i){var p=e.mapView,lt=!p&&e.fitView,h=e.center||p&&p.center||f.getTargetCenter(),rt=e.preserveCenter,d=[h],wt=e.drawInfoBoxes!==!1,bt=or.commands,ut=e.count||i[t];for(l=0;l<ut;l++)if(s=i[l],s&&(ot=s.uid||ht.newGuid(),b=s.location||s.routableLocation,b)){lt&&d.push(b);var at="",st=s.icon,ct="";st&&s.brand&&(ct="pinbrand"+s.brand.BrandId),(!st&&e.pinType!==vt||ct)&&(at=""+(s.displayIndex||"")),yt={icon:st,id:ot,text:at,typeName:ct||e.pinType},g=new et(b,yt),c.push(g),s.pushpin=g,wt&&(nt={actions:s.actions||[],title:s.name||"",titleIsPlaintext:!0,width:300,description:s.description||"",pushpin:g,id:ot},s.websiteUrl&&(nt.titleAction={label:r("L_ActionWebsite_Text"),eventHandler:function(){or.handleCommand(bt.website,s,n)}}),tt=new hr(b),u.invoke(f,"createsearchinfobox",{searchTask:o,entity:s,infobox:tt,infoboxOptions:nt}),tt.setOptions(nt),c.push(tt))}if(lt&&d[t]>0){for(a=h.clone(),v=h.clone(),ut=d[t],l=1;l<ut;l++)k=d[l],a.latitude=Math.min(a.latitude,k.latitude),a.longitude=Math.min(a.longitude,k.longitude),v.latitude=Math.max(v.latitude,k.latitude),v.longitude=Math.max(v.longitude,k.longitude);rt||(h=new y((a.latitude+v.latitude)/2,(a.longitude+v.longitude)/2));var pt=.1,kt=Math.max(h.latitude-a.latitude,v.latitude-h.latitude)*(1+pt*(rt?2:1)),dt=Math.max(h.longitude-a.longitude,v.longitude-h.longitude)*(1+pt*(rt?2:1));p=new ft(h,2*dt,2*kt),p.center.altitude=0,e.mapView=p}p&&(w={animate:!1,bounds:p,center:h},it=n.getRequest(),it.isPermalinkSearch&&(it.hasCenter&&(w.center=null),it.hasZoom&&(w.bounds=null)),w.center&&!y.areEqual(w.center,f.getTargetCenter())||w.bounds&&!ft.areEqual(w.bounds,f.getTargetBounds())?f.setView(w):o.logMapViewComplete())}}var e=this,o=n,s=!1,f,h,c=n.getEntities(),p,i,l,a;e.setEntities=function(n,t){s&&(t=t||{},t.append||e.clear(),h.push(n),p=t,tt(n,t))},e.clear=function(){s&&c.clear(),h=[]},e.isAutoRefreshEnabled=function(){return i&&i.enabled},e.disableAutoRefresh=function(){e.setAutoRefresh({enabled:!1})},e.setAutoRefresh=function(n){if(f&&n){var o=i.enabled,e=n.enabled,t=n.threshold,r=n.callback;o?e?t>0&&r&&(i.enabled=e,i.callback=r,i.threshold=t):v():e&&t>0&&r&&(i={enabled:!0,lastLocation:f.getTargetCenter(),callback:r,threshold:t,viewChangeStartHandler:u.addHandler(f,"viewchangestart",w),viewChangeEndHandler:u.addHandler(f,"viewchangeend",b)})}},e.skipNextAutoRefresh=function(){i&&i.enabled&&(i.skipNext=!0)},e.dispose=function(){this.clear(),v(),u.removeHandler(l),u.removeHandler(a)},d()}function ur(t){function l(n){n&&n!==i.panel&&n!==i.header&&r&&r[n]&&(r[n].innerHTML="")}function f(t,i,r){return n.createElement(r,t,null,i,p+t)}function a(){if(e){var t=s.getMap().getImageryId(),n=o(e);switch(t){case"EnhancedBirdseye":case"NativeBirdseye":n.add_class("dark be");break;case"Aerial":n.remove_class("be").add_class("dark");break;default:n.remove_class("dark be")}}}function w(n){var o,t,l,i;s=n,s&&(o=s.getRequest(),e=o&&o.renderOptions&&o.renderOptions.container,e&&(r={},t=f("spanel"),l=n.getMap().getTheme(),l&&(t.className+=" "+l.getThemeName()),e&&(r.panel=t,e.appendChild(t)),i=f("sheader",t),r.header=i,r.title=f("stitle",i,"h2"),r.subTitle=f("ssubTitle",i,"span"),r.titleActions=f("sactions",i,"ul"),r.body=f("sbody",t),r.footer=f("sfooter",t),c=!0),h=u.addHandler(s.getMap(),"imagerychanged",a),a())}function v(n,t,i){if(c&&n){var r=n.firstChild;r&&n.removeChild(r),n.appendChild(document.createTextNode(t)),i&&(n.className=i)}}var y=this,r,p="srch",s,e,c=!1,h;this.addContent=function(n,t){r&&r[n]&&r[n].appendChild(t)},this.clear=function(n){if(r)if(n)l(n);else for(var n in r)l(n)},this.setTitle=function(n,t){v(r[i.title],n,t)},this.setSubTitle=function(n,t){v(r[i.subTitle],n,t)},y.dispose=function(){this.clear(),h&&(u.removeHandler(h),h=null)},w(t)}function si(n,t,i){function ut(n,t){y&&n==e||(ft(n),y=y||g.SearchManager.getInstance(n),w=w||document.createElement("div")),t=t||{};var i=t.renderOptions||{};i.task=r,i.container=w,t.renderOptions=i,lt({TS_rsth:d()}),i.searchStartTime&&nt({TS_bc:i.searchStartTime.getTime()}),et(!0),y.search(t)}function ft(n,t,i){n&&n!=e&&(k(),e=n,s=e.getComponent("analyticsProxy"),it=u.addHandler(e,"ondispose",k),o=t,c=i,c&&ot())}function et(n){tt!=n&&(tt=n,u.invoke(r,"propertychange",{propertyName:"isLoading"}))}function a(n){var t=n.factoryName,i=rt[t]||new n(r);return rt[t]=i,i}function ot(){if(e&&c){r[p]=r[p]||new ur(r),r[l]=r[l]||new ru(r);var n=null,u=c.classification,f=d(),t="s_none",i=o.additionalInfoOptions||{};if(u===h.noResults&&o.isBusinessDetailsQuery&&i.isStructured&&i.displayQuery){o.query=i.displayQuery,o.isBusinessDetailsQuery=!1,i.isStructured=!1,ut(e,o);return}switch(u){case h.location:n=a(fr),t="s_location";break;case h.business:n=a(hi),t="s_business";break;case h.categoryBrowse:n=a(ci),t="s_category";break;case h.disambiguation:t="s_disambig";case h.noResults:n=a(er)}nt({at:t,TS_hr:f}),n&&(b=n.getEntities&&n.getEntities(c,o),r[l].clear(),n.renderTaskPanel(b),nt({TS_prc:d()}),n.renderTaskLayer?n.renderTaskLayer(b):ht()),et(!1)}}function k(){u.removeHandler(it),r[l]&&r[l].dispose(),r[p]&&r[p].dispose(),r._microManager&&r._microManager.hide(),r._microManager=null,e=null}function d(){return(new Date).getTime()}function lt(n){s&&s.beginBatchedAction(v,n)}function nt(n){s&&s.logBatchedEvent(v,n)}function at(){nt({TS_mvrc:d()}),ht()}function ht(){s&&(s.computeTotalDuration(v,st,"TS_td"),s.endBatchedAction(v))}var r=this,e,s,it,o,c,y,w,ct=new f.EntityCollection,rt={},b,tt=!0,v,st;u.addHandler(r,"deactivate",k),r.id=null,r[l]=null,r[p]=null,r.init=ut,r.getPanel=function(){return w},r.getEntities=function(){return ct},r.getSearchEntities=function(){return b},r.getIsLoading=function(){return tt},r.setResponse=function(n){c=n,ot()},r.getResponse=function(){return c},r.setRequest=function(n){o=n,r.setResponse(null)},r.getRequest=function(){return o},r.getMap=function(){return e},r.skipNextAutoRefresh=function(){var n=r[l];n&&n.skipNextAutoRefresh()},r.close=function(){k()},r.getResponseProcessor=a,v="ST.Search",st=["TS_bc","TS_rsth","TS_hr","TS_prc","TS_mvrc","TS_arc"],r.logMapViewComplete=at,ft(n,t,i)}function uu(n){var r=this,t={},i=n;this.createTask=function(n,r){var u=null;return i&&n&&r&&(u=new si(i,n,r),u.id="searchTask",t[u.id]=u),u},this.updateTask=function(n,t){var i=null;return n&&t&&(i=n.renderOptions&&n.renderOptions.task,i instanceof si?(i.setRequest(n),i.setResponse(t)):i=this.createTask(n,t)),i},this.removeTask=function(n){var i=t[n];i.dispose(),i=null,delete t[n]}}function rt(){function u(n){function r(n,t){if(n&&t){var i=t.indexOf(".");return i<0||i===t.length-1?n[t]:r(n[t.slice(0,i)],t.slice(i+1))}}var i=n.charAt(0)==="=",t=i?n.substr(1):n;this.execute=function(n,u){var e,f;return e=t==="$i"?u:t==="$@"?n:r(n,t),f=""+e,i?f:ot.encodeHtml(f)}}function o(n,t,i){var o=[],e=t&&t.parts,s,f,r;if(e)for(s=e.length,f=0;f<s;f++)r=e[f],r instanceof u&&(r=r.execute(n,i)),o.push(r);return o}function s(n){for(var f=[],t=n.template,i=t.indexOf(r),o=0,s,h;i>=0;)f.push(t.slice(o,i)),s=t.indexOf(e,i),s>i+2&&(h=t.slice(i+2,s),h.length>0&&f.push(new u(h)),o=s+2,i=t.indexOf(r,o));f.push(t.slice(o)),n.parts=f}var h=this,i={},f=/\{\%=?\w+\%\}/gim,r="{%",e="%}",n=document.createElement("div");this.setItemTemplate=function(n,t){if(n&&t){var r={template:n},u=n.search(f)>0;u&&(r.needSubstitution=u,s(r)),i[t]=r}},this.dataBind=function(r,u,f,e){var y=i[f],h,c,s,l,v,a;if(r instanceof Array&&u&&y&&(h=r[t],e=e||{},h>0))for(c=e.count,c&&c<=h&&(h=c),e.append===!1&&(u.innerHTML=""),s=0;s<h;s++)if(l=r[s],l&&(v=o(l,y,s),v&&(n.innerHTML=v.join(""),n.children&&n.children.length===1&&(a=n.children[0],a&&(u.appendChild(a),e.onItemDataBound)))))e.onItemDataBound(l,s,a)}}function su(t,i){function v(){var r=!1,n,f,t;if(u&&i.length&&s.locale==="fr-fr")for(n=0,f=i.length;n<f;n++)if(t=i[n]&&i[n].source,t&&t.AdditionalProperties&&t.AdditionalProperties.PagesJaunesId){r=!0;break}return r}function y(){var u=r("L_PartnerAttribution_Text")+" ",f=s.imagePath+"search/atrPJ"+s.locale+".png",t=n.createElement("div",c),i=n.createElement("img","logo");return i.src=f,i.alt="PagesJaunes",n.createAnchor(h,u,"link",null,t),n.createAnchor(h,i,null,null,t),p(t),t}function p(t){function b(t,i,r){var u=n.createElement("img");u.width=1,u.height=1,u.alt=i,u.src=t,r.appendChild(u)}function rt(n){var e=[],f=u.length,t,o,r;for(n.count>0&&(f=Math.min(f,n.count)),t=0;t<f;t++)o=u[t]&&i[t].source,r=o.AdditionalProperties,r&&r.PagesJaunesId&&e.push("p"+t+"="+r.PagesJaunesId);return e.join("&")}var d=Math.random()*2147483647|0,h=f.getRequest(),g=f.getResponse(),c=h.isBusinessDetailsQuery,nt=l.replace("{page}",c?o:e).replace("{reqId}",d),s,r;if(b(nt,"eStat Pro",t),s=k(g),r=lt(s&&s.GeocodeLocation&&s.GeocodeLocation.BestView),r){var v=r.getNorth(),y=r.getSouth(),p=r.getEast(),w=r.getWest(),tt=[v,w,v,p,y,w,y,p].join(","),it=a.replace("{what}",c?"":encodeURIComponent(h.query)).replace("{bounds}",tt).replace("{page}",c?o:e).replace("{busId}",rt(h));b(it,"",t)}}var f=t,u=i,e="MAPS",o="PLAN",c="pjProviderAttribution",h="http://www.pagesjaunes.fr",l="http://logc258.at.pagesjaunes.fr/hit.xiti?s=488194&s2=1&p=BING::HOME::HOME::{page}&di=&an=&ac=&rn={reqId}",a="http://www.pagesjaunes.fr/stat/bing/pagesBing.html?r1={what}&r2={bounds}&r3={page}&{busId}";return v()&&y()}var f=window[$MapsNamespace].Maps,tt=f.Resources,r=tt.getString,t="length",p="panel",l="layer",w="searchManager",g=f.Search=f.Search||{},o=f.Gimme,s=f.Globals,u=f.Events,a=f.InternalNamespaceForDelay,li=a.Network,ai=a.Quirks,ut=a.PRF,y=f.Location,ft=f.LocationRect,hr=f.Infobox,at=f.EntityState,et=f.Pushpin,ot=a.IOSec,cr=a.Search=a.Search||{},vi=10,st=20,nt="primary",vt="micro",yt=80,lr=function(n){return typeof n=="undefined"||typeof n=="unknown"},ar=function(n){return lr(n)||n===null},hu=function(n){return typeof n=="undefined"||typeof n=="unknown"||n===null||n===""},pt=function(n,t,i,r,u){ut.start(u),li.getObjectAsync(i,vr,[n,r,u],n.timeout||-1)},vr=function(n,t){var r=t.userData,i=r[0],f=i.errorCallback,e=r[1],o=r[2],u;o&&ut.end(o),t&&t.success&&n?(u=ai.useXHR||i.advanced?n:n.response,u&&e&&e(u,i,i.callback,i.userData)):f&&f({request:i})},wt=function(n,t,i,r){return ai.useXHR?n.format="json":(n.jsonso="{jsono}",n.jsonp="microsoftMapsNetworkCallback"),n.culture='"'+s.locale+'"',n.token=t?t:"",i+(r?"/"+r:"")+"?"+yr(n)},yr=function(n){var i="",r=!0,t;for(t in n)r||(i+="&"),i+=t+"=",t==="jsonso"?i+=n[t]:ar(n[t])||(i+=encodeURIComponent(n[t].toString())),r=!1;return i},bt=function(n){var s="",i,r,t;if(n&&(i=n&&n.getNorthwest(),r=n&&n.getSoutheast(),i&&r)){var u=i.latitude,f=r.longitude,e=r.latitude,o=i.longitude;u<e&&(t=u,u=e,e=t),f<o&&(t=f,f=o,o=t),s=u+", "+f+", "+e+", "+o}return s},yi=function(n){if(n&&n.NorthEastCorner&&n.SouthWestCorner){var t=n.SouthWestCorner.Latitude,i=n.NorthEastCorner.Latitude,r=n.NorthEastCorner.Longitude,u=n.SouthWestCorner.Longitude;return new ft(new y((t+i)/2,(u+r)/2,null,null),r-u,i-t)}return null},kt=/[ ,]/,pi=function(n,i){var c,o,h;if(!n||!i||s.locale!=="en-us")return ot.encodeHtml(i);for(var e=[],l=n.toLowerCase().split(kt),u=i.split(kt),f=0,a=u[t],v=l[t],r=0;r<a;r++){for(c=!1,o=0;o<v;o++)if(u[r].toLowerCase()==l[o]){c=!0;break}for(c?e.push(ot.encodeHtml(u[r])):e.push('<span class="disamhlt">'+ot.encodeHtml(u[r])+"<\/span>"),f+=u[r][t],h=i.charAt(f);f<i[t]&&kt.test(h);)f++,e.push(h),h=i.charAt(f)}return e.join("")},wi=function(n,t){var i=Math.PI/180;return 6371*Math.acos(Math.sin(n.latitude*i)*Math.sin(t.latitude*i)+Math.cos(n.latitude*i)*Math.cos(t.latitude*i)*Math.cos(n.longitude*i-t.longitude*i))},e=function(n){return n?'"'+n+'"':""},dt=function(n,t,i){var r=document.createElement("div");r.id="feedbackDiv",r&&n.addContent(t,r),i.feedbackButtonContainer=r},pr=function(){var n=locale.substring(0,2);return!(locale==="es-mx"||locale==="es-us")&&o.Helper.contains(["fr","de","es","it","pt","nb","nl","sv","pl","ru","tr","ko"],n)?!1:!0},ht=new function(){function n(){return((1+Math.random())*65536|0).toString(16).substring(1)}this.newGuid=function(){return(n()+n()+"-"+n()+"-4"+n().substr(0,3)+"-"+n()+"-"+n()+n()+n()).toLowerCase()}},n=new function(){function u(n,i){var r,s,f;if(n&&i)for(var e=n.tagName,o=e==="UL"||e==="OL",h=i[t],u=0;u<h;u++)r=i[u],r&&(s=r.ownerDocument===window.document,f=o&&document.createElement("li")||n,s?f.appendChild(r):f.innerHTML=r,o&&n.appendChild(f))}var n=this,i="div",r="input";n.createAnchor=function(t,i,r,f,e){var o=t&&i&&n.createElement("a",r,null,e);return o&&(o.href=t,o.target=f||"_blank",typeof i=="string"&&(i=document.createTextNode(i)),u(o,[i])),o},n.createElement=function(n,t,f,e,o){var s,h=n&&n.toLowerCase()||i,c,l;return h&&h.indexOf(r)===0?(s=document.createElement(r),s&&(s.type=h.split(":")[1])):s=document.createElement(h),s&&(t&&(s.className=t),o&&(s.id=o),e&&(c=s,(e.tagName==="UL"||e.tagName==="OL")&&(l=document.createElement("li"),l.appendChild(s),c=l),e.appendChild(c)),u(s,f)),s},n.createContentSection=function(t,r,u){return n.createElement(i,"section "+t,[n.createElement("span","title",[document.createTextNode(r)])],u)}},gt={none:0,good:1,ambiguous:2,upHierarchy:4,modified:8},it={high:0,medium:1,low:2,unknown:-1},bi={interpolated:0,rooftop:1},ni={none:1,display:2,route:4},h={location:1,business:2,categoryBrowse:4,disambiguation:8,noResults:16},b={traffic:16,from:4,to:8},ki={address:"Address",neighborhood:"Neighborhood",populatedPlace:"PopulatedPlace"},v={Paging:2,NWYWRelatedLoc:3,AutoRefresh:4,NWYWTwoBox:5,Disambiguation:7},ii,tr,rr,i;g.MatchCode=gt,g.MatchConfidence=it,g.LocationPrecision=bi;var wr=function(n){var i=null,t;return n&&(t=br(n.Results),t&&(i={parsedAddress:gi(n.ParsedAddress),parsedKeyword:n.parsedKeyword||"",parsedSeparator:n.parsedSeparator||"",results:t||[]})),i},ct=function(n){var i=null,t,r;return n&&(t=n.Coordinates,t&&(r=n.Precision||bi.Interpolated,i={location:new y(t.Latitude,t.Longitude),precision:r,name:n.Name})),i},di=function(n){var r=[],t,i;if(n)for(t=0;t<n.length;t++)i=ct(n[t]),i&&r.push(i);return r},gi=function(n){var t=null;return n&&(t={addressLine:n.AddressLine||"",adminDistrict:n.AdminDistrict||"",countryRegion:n.CountryRegion||"",district:n.District||"",formattedAddress:n.FormattedAddress||"",locality:n.Locality||"",postalCode:n.PostalCode||"",postalTown:n.PostalTown||""}),t},nr=function(n){var i=null;if(n&&n.Name&&n.BestLocation&&n.Locations&&n.BestView){var r=yi(n.BestView),t=ct(n.BestLocation),u=di(n.Locations);r&&t&&u&&(i={name:n.Name,location:t&&t.location,locations:u,bestView:r,matchConfidence:n.MatchConfidence||it.unknown,matchCode:n.MatchCode||gt.none})}return i},br=function(n){var r=[],t,i;if(n)for(t=0;t<n.length;t++)i=nr(n[t]),i&&r.push(i);return r};g.SearchManager=ti,ti.getInstance=function(n){var t=n.getComponent(w);return t||(t=new ti(n),t._initSingleton()),t},ii=new function(){function r(n,t,i,r){i&&n&&i(wr(n),r)}function u(n,t,i,r){if(i&&n){var f=null,u=n.Results;u&&u.length>0&&(f=nr(u[0])),i(f,r)}}function o(n,i){var u=n.count||vi,r,f;return u>st&&(u=st),r="",f={query:e(n.where),mapBounds:e(bt(n.bounds)),count:u,landmark:r,addressLine:r,locality:r,postalTown:r,adminDistrict:r,district:r,postalCode:r,countryRegion:r,currentLocation:r,curLocAccuracy:r,entityTypes:r,rankBy:r},wt(f,i,s.geocodingService,t)}function h(n,t){var r={};return r.latitude=n.latitude,r.longitude=n.longitude,wt(r,t,s.geocodingService,i)}var n=this,t="Geocode",i="ReverseGeocode";n.geocode=function(n,i){i&&n&&i.getCredentials(function(u){var f=o(n,u);pt(n,i,f,r,t)})},n.reverseGeocode=function(n,t){if(t&&n){var r=n.location;r instanceof f.Location&&t.getCredentials(function(f){var e=h(r,f);pt(n,t,e,u,i)})}}},tr=new function(){function o(n,t,i,r){i&&n&&i(a(n,t),r)}function h(n,t,i){var r=n.advanced?i.getCenter():"",o=n.count+1,u,h;return n.center instanceof f.Location&&(r=n.center),r=r&&r.latitude+","+r.longitude,u=null,u=n.advanced?c(n,o,r,i):{count:o,startingIndex:n.startIndex,mapBounds:e(bt(n.bounds)),locationcoordinates:e(r),entityType:e("Business"),sortorder:"",query:e(n.query),location:e(n.where),keyword:e(n.what)},h=n.advanced?s.restAdvancedSearchService:s.searchService,wt(u,t,h)}function c(n,t,i,r){var u=[],o,f,s;return n.query&&n.where?u.push("st"):n.isCategoryQuery?u.push("cat"):n.isBusinessDetailsQuery?u.push("bd"):n.isEntityDetailsQuery?u.push("ed"):n.isCategoryBrowse&&u.push("cb"),n.isBrandFinderQuery&&u.push("bf"),o=[],f=n.additionalInfoOptions,f&&(f.requestAds&&o.push("ads"),!f.isStructured||n.query&&n.where||u.push("st"),f.autoRefresh&&(o.push("ar"),u.push("ar")),f.addressLookup&&o.push("eal"),f.requestPostCodeBusiness&&o.push("pb")),s={q:e(n.query),wh:e(n.where),n:t,mkt:e(n.locale),cp:e(i),si:n.startIndex,ob:n.sortOrder,r:n.radius,md:e(r.getWidth()+","+r.getHeight()),z:r.getZoom(),qh:e(u.join("|")),ep:e(n.entryPoint),oj:e(n.optimizeJson),ai:e(o.join("|")),ca:e(n.categoryBrowseAction),cid:e(n.categoryId)},(!i||l(n.bounds))&&(s.bb=e(bt(n.bounds))),s}function l(n){return n&&wi(n.getNorthwest(),n.getSoutheast())<2*yt}function a(i,r){var f=null,e,o,u;return r&&r.advanced?f=i:i&&(e=n(i.SearchResults,v),o=r.count,f={searchRegion:t(i.SearchRegion),alternateSearchRegions:n(i.AlternateSearchRegions,t),parseResults:n(i.ParseResults,p),searchResults:e.splice(0,o),hasMore:e.length>o},u=i.ResponseSummary,u&&(f.responseSummary={copyright:u.Copyright||"",statusCode:u.StatusCode||0,authResultCode:u.AuthResultCode||0,errorMessage:u.ErrorMessage||null,traceId:u.TraceId||""})),f}function n(n,t){var u=[],i,r;if(n)for(i=0;i<n.length;i++)r=t(n[i]),r&&u.push(r);return u}function v(n){var i=null,t;return n&&(t=n.Location,i={entityType:n.EntityType||0,id:n.Id||"",name:n.Name||"",address:n.Address||"",city:n.City||"",state:n.State||"",postalCode:n.PostalCode||"",country:n.Country||"",phone:n.Phone||"",location:t&&new y(t.Latitude,t.Longitude),website:n.Website||"",hoursOfOperation:n.HoursOfOperation||null,userRating:n.UserRating||0,reviewCount:n.ReviewCount||0,birdsEyeSceneIndicator:n.BirdsEyeSceneIndicator||0,structuredDescription:n.StructuredDescription||null}),i}function p(n){var t=null;return n&&(t={keyword:n.Keyword||"",location:ct(n.Location),matchConfidence:n.MatchConfidence||it.unknown}),t}function t(n){var i=null,t;return n&&(t=n.MapBounds,i={mapBounds:t?{locationRect:yi(t),type:t.Type||0}:null,explicitLocation:ct(n.ExplicitLocation),source:n.Source||"",matchConfidence:n.MatchConfidence||it.unknown,matchCode:n.MatchCode||gt.none,address:gi(n.Address),geocodeLocations:di(n.GeocodeLocations)}),i}function w(n){return n.where||n.what||n.query}var i=this,r="Search2",u=1e4;i.search=function(n,t){n&&(t&&w(n)?t.getCredentials(function(i){var f=h(n,i,t);n.timeout||(n.timeout=u),pt(n,t,f,o,r)}):n.errorCallback&&n.errorCallback({request:n}))}},rr=new function(){function n(n,t){var i,u,r;if(n)for(i=0,u=n.length;i<u;i++)if(r=n[i],r&&(r.Usage&t)==t)return r;return null}function u(t){var i=n(t,ni.route)||n(t,ni.display);return i&&i.Coordinates?new y(i.Coordinates.Latitude,i.Coordinates.Longitude):null}function f(t){var i=n(t,ni.display);return i&&i.Coordinates?new y(i.Coordinates.Latitude,i.Coordinates.Longitude):null}function e(n){var r={},s;if(n.QueryParseResults&&n.QueryParseResults.length&&n.QueryParseResults[0]){var t=n.QueryParseResults[0],i=t.GeocodingResults&&t.GeocodingResults.length&&t.GeocodingResults[0]||{},o=i.MatchConfidence===it.high,e;e=o?i.Address&&i.Address.FormattedAddress||"":t.Address&&t.Address.FormattedAddress||"",t.Keyword&&e?(s=t.Separator?" "+t.Separator+" ":" ",r.Address=t.Keyword+s+e):r.Address=(t.Keyword||"")+e,!t.Keyword&&o&&i.Locations&&i.Locations.length&&(r.Location=u(i.Locations),r.LooftopLocation=f(i.Locations))}return r}function r(n){var i=n.QueryIntent,t={};switch(i){case b.from:case b.to:t=e(n)}return t}function o(n){var o={},s=ui(n),t,i,u,f,e;if(s)for(t=0;t<s.length;t++)if(i=s[t],u=i.SingleQueryFulfillments,u)for(f=0;f<u.length;f++)e=u[f],e&&(o[e.QueryIntent]=r(e));else o[i.QueryIntent]=r(i);return o}function t(n,t){return n.hasOwnProperty(t)}var i={directions:function(n,i){return t(i,b.from)||t(i,b.to)},traffic:function(n,i){return t(i,b.traffic)},location:function(n){return fr.hasIntent(n)},business:function(n){return hi.hasIntent(n)},categoryBrowse:function(n){return ci.hasIntent(n)},disambiguation:function(n){return er.hasIntent(n)}};this.getIntents=function(n,t){var r,u,e,f;n.additionalInfoOptions&&n.additionalInfoOptions.isStructured&&(r=c(t),r&&r.ListingType==="Business"&&!r.Parse&&(r.Parse={Keyword:n.query})),u={},e=o(t);for(f in i)i.hasOwnProperty(f)&&(u[f]=i[f](t,e));return u.intentCategories=e,u}},i={panel:"panel",title:"title",subTitle:"subTitle",body:"body",footer:"footer",header:"header",actions:"titleActions"},g.SearchTask=si;var fr=function(){function o(n,i){var f=!1,r=s(n),u;return r&&(i||k(n))&&(u=r.Keyword,(!u||u&&u[t]===0)&&(f=!!(r.Address||r.Landmark))),f}function s(n){var t=c(n);return t&&t.Parse}function a(n,t){var i={},r=k(n),u,c,h;if(o(n,r)){u=r&&r.GeocodeLocation,c=u.Address&&u.Address.FormattedAddress,i.address=c,i.name=t.givenName,u&&(i.name=i.name||u.DisplayName,ei(i,u.Locations));var f=ui(n),e=f&&f[0]&&f[0].QueryParseResults&&f[0].QueryParseResults[0],l=e&&e.GeocodingResults&&e.GeocodingResults[0]&&e.GeocodingResults[0].EntityId;i.uid=ht.newGuid(),i.entityId=l,i.entityType="adr",i.wikipediaInfo=v(n,l),h=s(n),i.isLandmark=!!(h&&h.Landmark),i.bestView=lt(r&&r.GeocodeLocation&&r.GeocodeLocation.BestView)}return[i]}function v(n,i){var e,r=n&&n.wikipediaInfo,u,f;if(r&&r[t]>0&&i)for(u=0;u<r[t];u++)if(f=r[u],f&&f.EntityId===i){e=f;break}return e}function h(n,t){var r=document.createElement("div"),i;return r&&(r.className="section "+n,i=document.createElement("span"),i&&(i.className="title",i.appendChild(document.createTextNode(t)),r.appendChild(i))),r}function e(e){function p(f){var l,a,ft,nt,tt,et,it,b,rt,ut,g;if(o){var e=o.panel,p=o.getResponse(),w=o.getRequest();if(e&&p&&(e.clear(),l=f&&f[0],l)){if(a={itemType:"locationpanel",searchTask:o,entity:l,panel:o.getPanel(),query:d(w,p),request:w,response:p},w.additionalInfoOptions&&w.additionalInfoOptions.isStructured||(a.searchOptions={query:a.query.rawWhat}),ft=l.location,e.setTitle(l.name),nt=r("L_LocationFormat_Text").replace("{lat}",ft.latitude.toFixed(6)).replace("{lon}",ft.longitude.toFixed(6)),pr()||(nt=nt.replace(/\,/," ").replace(/\./g,",")),e.setSubTitle(nt,"ssubLatLon"),tt=document.createElement("div"),tt.setAttribute("class","actionContainer"),et=n.createElement("ul","entityActions",null,tt),u.invoke(s,"itemdatabound",{itemType:"searchresult",searchTask:o,entity:l,element:et}),et.hasChildNodes()&&e.addContent(i.actions,tt),oi(o,e),w.renderOptions.showWikipediaInfo===!0&&(it=document.createElement("div"),it&&(e.addContent(i.body,it),new fu(it,l).load())),dt(e,i.body,a),b=c(p),b&&b.Results&&b.Results[t]>0&&(rt=h("relatedBusiness",r(l.isLandmark?"L_BusinessAtLocation_Text":"L_BusinessAtAddress_Text")),rt)){var ot=o.getResponseProcessor(hi),st=l.isLandmark,f=ot.getEntities(p,o.getRequest(),{count:st?y:0});ot.renderTaskPanel(f,{clearPanel:!1,container:rt,nwyw:!1,paging:!1,pinType:vt,setTitle:!1,titlesOnly:!st}),ot.renderTaskLayer(f,{append:!0,enableAutoRefresh:!1,pinType:vt}),e.addContent(i.body,rt)}v&&(ut=h("nearby",r("L_Nearby_Text")),ut&&(e.addContent(i.body,ut),new eu(o,ut,l).load())),g=k(p),g&&g.GeocodeLocation&&g.GeocodeLocation.EntityType&&(a.geoEntityType=g.GeocodeLocation.EntityType),a.address=b.SearchRegion.GeocodeLocation.Address,u.invoke(s,"panelrendered",a)}}}function w(n){if(o){var i=o[l];i&&(n&&n[t]>0&&(i.setEntities(n,{append:!0,mapView:n[0]&&n[0].bestView}),n[0].pushpin.setOptions({state:f.EntityState.selected})),i.disableAutoRefresh())}}var b=this,o=e,s=o.getMap(),v=f.Globals.localScoutSupported,y=3;this.getEntities=a,this.renderTaskPanel=p,this.renderTaskLayer=w}return e.hasIntent=o,e.factoryName="lsp",e}(),hi=function(){function b(n){var t=c(n);return t&&t.ListingType==="Business"&&t.Parse&&t.Parse.Keyword&&t.EstimatedMatches}function g(n,i,u,f){var c={max:-1},s=[],o,e,l,p;if(n>=0&&i>0&&f>0&&(o=Math.ceil(n/i),u>=1&&u<=o)){c.max=o;var a,v,h=1,w=Math.floor(f/2),y=Math.max(1,Math.min(Math.abs(u-w),o-f+1)),b=Math.min(o,y-1+f);for(e=y;e<=b;++e)l={startIndex:(e-1)*i,value:e},e===u&&(h=e,l.selected=1),s.push(l);s[t]>0&&(p=h-1,h>1&&(a={startIndex:(p-1)*i,value:r("L_PagePrev_Text")},s.unshift(a)),h<o&&(v={startIndex:h*i,value:r("L_PageNext_Text")},s.push(v)))}return c.pages=s,c}function e(e){function ot(t,e){var ei,w,rt,ut,st,ii,ht,at,hi,vt,ri,v,yt,gt,ui,fi,ni,ti,ot;if(b){var o=b[p],ft=b.getResponse(),l=b.getRequest();if(e=e||{},tt=it&&it.getPinIcon(e.pinType)||et.getDefaultIcon(),o&&(e.clearPanel!==!1&&o.clear(),e.setTitle!==!1&&(w=c(ft),rt=w&&w.Parse,rt?(ut=rt.Keyword,st=rt.Address&&rt.Address.FormattedAddress||rt.Landmark):(ut=l.query,st=l.where),ut&&(ei=l.isBusinessDetailsQuery&&ut.indexOf("YN")!==-1?w&&w.Results&&w.Results[0]&&w.Results[0].Name:st?r("L_WhatNearWhere_Text").replace("{what}",ut).replace("{where}",st):ut),o.setTitle(ei)),e.nwyw!==!1&&oi(b,o),ii=su(b,t),ii&&o.addContent(i.actions,n.createElement("li","providerAttr",[ii])),t)){ht="entityCache",b[ht]||(b[ht]=[]);var ct=l.count,si=l.startIndex/ct,lt=b[ht];for(lt[si]=t,t.length>ct&&lt[si].splice(ct,t.length-ct),at=[],hi=lt.length,vt=0;vt<hi;vt++)ri=lt[vt],ri&&(at=at.concat(ri));v={itemType:"businesspanel",searchTask:b,businessEntities:at,panel:b.getPanel(),query:d(l,ft),request:l,response:ft},v.searchOptions={what:v.query.what,where:v.query.where,query:v.query.rawWhat,radius:l.radius},yt=e&&e.container,gt=n.createElement("ul","searchResults",null,yt),gt&&f&&f.dataBind(t,gt,e.titlesOnly?h:s,{onItemDataBound:function(n,t,i){e.titlesOnly?wt(n,i):pt(n,i)},count:10}),yt||(o.addContent(i.body,n.createElement("div","adResults topAds hidden")),o.addContent(i.body,gt),o.addContent(i.body,n.createElement("div","adResults bottomAds hidden"))),l&&e.paging!==!1&&(ui=l.count,fi=Math.floor(l.startIndex/ui)+1,v.searchOptions.pageNumber=fi,ni=g(c(ft).EstimatedMatches,ui,fi,y).pages,ni&&ni.length>1&&(ti=n.createElement("ul","sb_pag"),ti&&(o.addContent(i.footer,ti),f&&f.dataBind(ni,ti,a,{onItemDataBound:function(n,t,i){bt(n,i)}})))),kt(o,i.footer,v),dt(o,i.footer,v),yt||(ot=k(ft),ot&&ot.GeocodeLocation&&ot.GeocodeLocation.EntityType&&(v.geoEntityType=ot.GeocodeLocation.EntityType),u.invoke(nt,"panelrendered",v))}}}function st(n){var t=!0;if(n)switch(n){case v.NWYWRelatedLoc:case v.NWYWTwoBox:case v.Disambiguation:break;default:t=!1}return t}function ht(n,i){var f,c;if(b){i=i||{};var u=b[l],r=b.getRequest(),a=b.getResponse();if(r&&u){var e=n[t],o=r.count;o>0&&o<=e&&(e=o);var s=k(a),h=lt(s&&s.GeocodeLocation&&s.GeocodeLocation.BestView),v=i.fitView||st(r.source);u.setEntities(n,{append:i.append,count:e,fitView:v,preserveCenter:!h,center:h&&h.center,pinType:i.pinType}),tu(a)&&(f=b._microManager,Microsoft.Maps.loadModule("Microsoft.Maps.MicroPOI",{callback:function(){f||(f=b._microManager=new Microsoft.Maps.MicroPOI.MicroPOIManager(nt)),f.show(r.query)}})),i.enableAutoRefresh===!1||u.isAutoRefreshEnabled()||(c=.0001,r.radius>0&&r.radius<yt&&(c=.6*r.radius),u.setAutoRefresh({enabled:!0,threshold:c,callback:ct}))}}}function ct(){ft(0,v.AutoRefresh)}function vt(n){var t=n.entity,i;t instanceof et&&(i=o("#ec_"+t.getId()),t.getState()&at.highlighted?i.add_class("hover"):i.remove_class("hover"))}function pt(t,i){var f,e,c,s,h,l;t&&i&&(f=o(i),ou.load(t.source,f.select("div.catdata")[0]),e=t.brand,e&&(c=e.SearchLogoUrl,s=c&&n.createElement("img","resultBrandIcon",null),s&&(s.src=e.SearchLogoUrl,n.createAnchor(t.websiteUrl,s,null,null,f.select(".brandImgContainer")[0])),n.createAnchor(e.CallToActionUrl,e.CallToActionText,"callToActionLink",null,i)),t.websiteUrl&&(f.select(".website")[0].href=t.websiteUrl,f.select(".website")[0].appendChild(document.createTextNode(r("L_ActionWebsite_Text")))),t.phoneNumber&&f.select(".inlineTitle")[0].appendChild(document.createTextNode(t.phoneNumber)),u.invoke(nt,"itemdatabound",{itemType:"searchresult",searchTask:b,entity:t,element:i}),h=e&&e.BrandId,h&&f.select("*").push(f[0]).set_attr("brandid",h),l=f.select(".bullet_MacroPoi"),l.add_class(tt&&tt.className||""),f.add_event("mouseover",function(n){rt(n,t,f)}).add_event("mouseout",function(n){ut(n,t,f)}))}function wt(n,t){var i,r;n&&t&&(i=o(t),u.invoke(nt,"itemdatabound",{itemType:"searchresult",searchTask:b,entity:n,element:t}),r=i.select(".bullet_MacroPoi"),r.add_class(tt&&tt.className||""),i.add_event("mouseover",function(t){rt(t,n,i)}).add_event("mouseout",function(t){ut(t,n,i)}))}function rt(n,t){var i=t.pushpin;i&&i.setOptions({state:i.getState()|at.highlighted})}function ut(n,t){var i=t.pushpin;i&&i.setOptions({state:i.getState()&~at.highlighted})}function bt(n,t){if(t&&n){var i=o(t);i.select("a").add_event("click",function(t){if(t.preventDefault(),o(this).remove_event("click",arguments.callee,!1),!n.selected){var i=n.startIndex;i>=0&&ft(i,v.Paging)}}).add_class(n.selected?"sb_pagS":"")}}function ft(n,t){var e=nt.getComponent(w),s,i;if(e){var i=b.getRequest(),u=c(b.getResponse()),f=u&&u.Parse&&u.Parse.Keyword,r,o=i&&i.isCategoryQuery;o&&(s=i.query,r=i.categoryId,r&&(f=s||r)),f&&(i={query:f,where:" ",advanced:!0,isCategoryQuery:o,categoryId:r,startIndex:n||0,source:t,renderOptions:{task:b},additionalInfoOptions:{isStructured:!0,autoRefresh:t===v.AutoRefresh}},e.search(i))}}function kt(n,t,i){var r=document.createElement("div");r.id="businessListingDiv",n.addContent(t,r),i.businessListingContainer=r}var gt=this,b=e,nt=b.getMap(),it=nt.getTheme(),tt,ni=[u.addHandler(b.getEntities(),"entitychanged",vt)];this.getEntities=ir,this.renderTaskPanel=ot,this.renderTaskLayer=ht}var s="et",h="met",a="plt",y=5,f=new rt;return f.setItemTemplate('<li id="ec_{%uid%}" index="{%$i%}" class="ypEntity"><a class="bullet_MacroPoi" id="{%uid%}_number" href="#"><div class="bullet_text">{%displayIndex%}<\/div><\/a><div class="ypEntityCntr"><div class="brandImgContainer"><\/div><a class="entityTitle" href="#">{%name%}<\/a><div class="ratingsInfo"><\/div><div class="catdata"><\/div><h5 class="entitySubTitle">{%address%}<\/h5><h5 class="entitySubTitle inlineTitle"><\/h5><a class="website" target="_blank"><\/a><\/div><ul class="entityActions"><\/ul><div class="floatClear"><\/div><\/div><\/li>',s),f.setItemTemplate('<li id="ec_{%uid%}" index="{%$i%}" class="ypEntity"><a class="bullet_MacroPoi" id="{%uid%}_number" href="#"><div class="bullet_text">{%displayIndex%}<\/div><\/a><div class="ypEntityCntr"><a class="entityTitle" href="#">{%name%}<\/a><div class="floatClear"><\/div><\/div><\/li>',h),f.setItemTemplate('<li id="pl_{%$i%}"><a href="#" startIndex="{%startIndex%}">{%value%}<\/a><\/li>',a),e.hasIntent=b,e.factoryName="bsp",e}(),ci=function(){function c(n){return n&&n.intent===9}function a(){return null}function f(f){function k(){var r,n,l,f,a,w,b,k,o;c&&(r=c[p],n=c.getResponse(),r&&n&&n.primary&&(l=n.primary.category,r.clear(),r.setTitle(l.Id===v.Id?v.Name:l.Name),f=n.primary.categoryPaths,f&&(f.unshift(v),f[t]>1&&(a=f[t]-1,w=y(s,s,n.primary.categoryPaths,h,a,r,i.subTitle),w&&(b=f[a],k=b&&b.Name,k&&(o=document.createElement("li"),o&&(o.appendChild(document.createTextNode(k)),w.appendChild(o)))))),y(e,e,n.primary.children,u,null,r,i.body)))}function d(){if(c){var n=c[l];n&&n.disableAutoRefresh()}}function g(n,t,i,r){return y(n,t,i,u,r)}function y(t,i,r,u,f,e,o){var s=document.createElement("ul");return s.id=t,s.className=i,n&&n.dataBind(r,s,u,{onItemDataBound:function(n,t,i){nt(n,i)},count:f}),e&&o&&e.addContent(o,s),s}function nt(n,t){t&&n&&o(t).add_event("click",function(t){t.preventDefault(),o(this).remove_event("click",arguments.callee,!1),tt(n)})}function tt(n){var i=b.getComponent(w),t;n&&i&&(t={query:n.Name,categoryId:n.Id,advanced:!0,renderOptions:{task:c}},n.IsLeaf?t.isCategoryQuery=!0:(t.isCategoryBrowse=!0,t.categoryBrowseAction="h"),i.search(t))}var it=this,c=f,b=c.getMap(),v={Id:1e4,Name:r("L_AllCategories_Text")};this.getEntities=a,this.renderCategoryList=g,this.renderTaskPanel=k,this.renderTaskLayer=d}var e="categoryList",s="categorybc",u="et",h="bct",n=new rt;return n.setItemTemplate('<li id="cb_{%Id%}" index={%$i%}><a href="#" class="categoryName" catId={%Id%}>{%Name%}<\/a><\/li>',u),n.setItemTemplate('<li id="cbbc_{%Id%}"><a href="#" class="categoryName" catId={%Id%}>{%Name%}<\/a><\/li>',h),f.hasIntent=c,f.factoryName="cbp",f}(),er=function(){function p(n){var r=c(n),u=k(n),f=!1,i;return!r||u&&u.GeocodeLocation||(i=r[a],f=i&&i[t]>1),f}function b(n,i){var h=c(n),o=h&&h[a],l=d(i,n),r,f,s;if(l){var v=e(i,l),y=o&&o[t],u=0;for(u;u<y;u++)r=o[u],r&&(f=r.GeocodeLocation||{},r.displayIndex=u+1,s=r.name=f.Address&&f.Address.FormattedAddress||f.DisplayName,s&&(r.highlightedName=pi(v,s)),r.uid=r.uid||ht.newGuid(),r.location||ei(r,f.Locations),r.entityType="adrDisambi")}return o}function e(n,t){return n.additionalInfoOptions&&n.additionalInfoOptions.displayQuery||t.where||t.rawWhere||t.rawWhat}function s(s){function tt(t,o){var l,b,k,rt,g,nt,tt;if(a){var v=a.getRequest(),w=a.getResponse(),c=d(v,w),s=a.panel;s&&c&&(w.classification!==h.noResults&&t?t&&((!o||o&&o.clearPanel!==!1)&&s.clear(),(!o||o&&o.setTitle===!0)&&(l=c&&e(v,c),l&&s.setTitle(l)),(!o||o&&o.nwyw===!0)&&oi(a,s),b=o&&o.container,k=c.what,rt=k?r("L_DisambigBusinessSuggestion_Text").replace("{q}",k):r("L_DisambigLocationSuggestion_Text"),g=n.createContentSection("disambLocSection",rt,b),nt=n.createElement("ul","disamblocs",null,g),nt&&f&&f.dataBind(t,nt,y,{onItemDataBound:function(n,t,i){it(n,i)}}),b||s.addContent(i.body,g)):(s.clear(),l=c&&e(v,c),l&&s.setTitle(l),new sr(a).load(!0)),tt={itemType:"disambigpanel",searchTask:a,panel:a.getPanel(),query:c,request:v,response:w},dt(s,i.footer,tt),u.invoke(p,"panelrendered",tt))}}function it(n,t){var i,r;n&&t&&(i=o(t),i.select("a").add_event("click",function(t){t.preventDefault(),o(this).remove_event("click",arguments.callee,!1),nt(n)}),r=i.select(".bullet_MacroPoi"),r.add_class(g&&g.className||""))}function nt(n){var ut=p.getComponent(w),k=n&&n.GeocodeLocation,g=lt(k&&k.BestView),i=a.getResponse(),et=a.getRequest(),ft=d(et,i),nt,r,u,e,o,s,y,f,b,rt;if(ut&&ft)if(g&&p.setView({bounds:g}),nt=ft.what,nt)ut.search({query:nt,advanced:!0,source:v.Disambiguation,bounds:g,renderOptions:{task:a}});else if(i){if(i.classification=h.location,r=c(i),r)for(r.SearchRegion=n,u=ui(i),e=u&&u[t]||0;e-->0;){var tt=!1,it=u[e],l=it&&it.QueryParseResults;for(s=l[t]||0;s-->0;){for(y=l[s],f=y&&y.GeocodingResults,o=f&&f[t]||0;o-->0;)if(b=f[o],rt=b&&b.Address,rt&&rt.FormattedAddress===k.DisplayName){r.Parse=r.Parse||{},r.Parse.Address=b.Address,tt=!0;break}if(tt){y.GeocodingResults=f.splice(o,1).concat(f),it.QueryParseResults=l.splice(s,1).concat(l),dr(i,u.splice(e,1).concat(u));break}}if(tt)break}a.setResponse(i)}}function rt(n){var e,s,u,o,i,f;if(a)if(e=a.getResponse(),s=a.getRequest(),s&&e&&e.classification!==h.noResults){if(u=a[l],o=n&&n[t],u&&o>0){for(i=0,i;i<o;i++)f=n[i],f&&(f.actions=[{label:r("L_DisambigSelectLink_Text"),eventHandler:function(n){n&n.preventDefault(),nt(f)}}]);u.setEntities(n,{fitView:!0}),u.disableAutoRefresh()}}else a.logMapViewComplete()}var ut=this,a=s,p=a.getMap(),k=p.getTheme(),g=k&&k.getPinIcon()||et.getDefaultIcon();this.getEntities=b,this.renderTaskPanel=tt,this.renderTaskLayer=rt}var a="AlternateSearchRegions",y="et",f=new rt;return f.setItemTemplate('<li id="dl_{%$i%}" class="dsambloc"><a class="bullet_MacroPoi" href="#"><div class="bullet_text">{%displayIndex%}<\/div><\/a><div><a class="disambloc" href="#">{%=highlightedName%}<\/a><\/div><div class="floatClear"><\/div><\/li>',y),s.hasIntent=p,s.factoryName="dp",s}();cr.Repeater=rt;var or=new function(){function i(){}function t(){}function r(){}function u(){}function f(){}function e(){}function o(){}var n=this;n.commands={directions:"dd",send:"send",sendMobile:"sendm",zoom:"zoom",details:"details",streetSide:"ss",save:"stoc",website:"ws"},n.handleCommand=function(s,h,c){if(s&&h&&c){var l=n.commands;switch(s){case l.directions:i(h,c);break;case l.send:t(h,c);break;case l.sendMobile:t(h,c,!0);break;case l.zoom:r(h,c);break;case l.details:u(h,c);break;case l.streetSide:f(h,c);break;case l.save:e(h,c);break;case s.website:o(h,c)}}}},fu=function(t,i){function e(i){i&&(u.className="wikiData",n.createElement("p","",[document.createTextNode(i.Description)],t),n.createAnchor(i.HyperlinkTarget,document.createTextNode(i.HyperlinkText),"","",t))}function o(n,t){ut.end(f),t&&t.success&&n}var u=t,r=i,f="WikiData";this.load=function(){if(u&&r){var n=r.id;!r.wikipediaInfo&&n?(ut.start(f),li.getObjectAsync(s.wikiDataUrl.replace("{0}",n),o,500)):e(i.wikipediaInfo)}}},cu=function(n,t){function f(n){var f=r.getResponseProcessor(ci),t=f.renderCategoryList(u,u,n);i&&t&&i.appendChild(t)}var i=t,r=n,u="nearbyCategories";this.load=function(){var t,u,e,o;i&&r&&(t=r.getResponse(),u=t&&t.popularCategories,u?f(u):(e=n.getRequest(),o=n.getMap().getComponent(w),o&&o.search({query:"pc",advanced:!0,isCategoryBrowse:!0,categoryBrowseAction:"pc",locale:e&&e.locale,timeout:3e3,callback:function(n){n&&n.primary&&f(n.primary)}})))}},eu=function(n,t,i){function r(n,t,i,r,u){var s={type:"LocalScoutTask",state:{action:n,sortBy:t,entityName:r,location:u}},e=document.createElement("li"),f=document.createElement("a");return f.setAttribute("href","#"),f.setAttribute("data-task",o.Internals.stringify(s)),f.appendChild(document.createTextNode(i)),e.appendChild(f),e}var u=t,f=n,e=i;this.load=function(){var n,t,i;u&&f&&(n=document.createElement("ul"),n.className="nearbyCategories",t=f.getRequest().query,i=e.location,n.appendChild(r(1,2,tt.getString("L_LocalScout_SeeDoMenuText"),t,i)),n.appendChild(r(2,2,tt.getString("L_LocalScout_EatDrinkMenuText"),t,i)),n.appendChild(r(3,2,tt.getString("L_LocalScout_ShopMenuText"),t,i)),n.appendChild(r(4,2,tt.getString("L_LocalScout_ForYouMenuText"),t,i)),u.appendChild(n))}},ou=new function(){function f(i,f){var o,e;i.reservationUrl&&(i.id===t?(e=n.createElement("img"),e.src=u,e.alt=r("L_BookItAlt_Text"),o=n.createAnchor(i.reservationUrl,e,"bookItLink")):o=n.createAnchor(i.reservationUrl,"Reservations","menuLink")),n.createElement("ul",null,[i.Price,i.menuUrl&&n.createAnchor(i.menuUrl,"Menu","menuLink"),o],f)}var i="11168",t="13344",u=s.imagePath+"/search/bookit.gif";this.load=function(n,r){if(n&&r){var e=n&&n.CategorySpecificProperties,o=e[i]&&e[i].Properties,u=e[t]&&e[t].Properties,s;o?s={id:i,menuUrl:o.MenuUrl,price:o.Price,reservationUrl:o.ReservationUrl||u&&u.ReservationUrl}:u&&(s={id:t,className:u.Class,reservationUrl:u.ReservationUrl}),s&&f(s)}}},sr=function(u){function a(t,i,r){var u=n.createElement("input:text","text");return r&&(u.value=r),n.createElement("div","titledText "+i,[n.createElement("span","inputTitle",[t]),u])}function b(i,u,f,c){var w=null,b,d,ut,tt,g;if(u){var it=i.additionalInfoOptions&&i.additionalInfoOptions.displayQuery,rt=(u.rawWhat+" "+u.rawWhere).trim(),ft=u.what,et=u.where;if(w=n.createElement("div","nwywpnl"),n.createElement("h3","nwywMsg",[c],w),b=n.createContentSection("nwywSrchCtl",r("L_DisambigChangeSearch_Text"),w),n.createElement("div","sectionContent",[a(r("L_DisambigSearchFor_Text"),"what",ft&&it||ft),a(r("L_DisambigSearchWhere_Text"),"where",et&&it||et),n.createElement("input:button","higButton"),n.createElement("div","floatClear")],b),d=nt(f),ut=d&&d[t],ut){for(b=n.createContentSection("nwywSuggestions",r("L_DisambigSuggestions_Text"),w),tt=0;tt<ut;tt++)d[tt].highlightedName=pi(u.where,d[tt].name);l.dataBind(d,b,h,{onItemDataBound:function(n,t,i){k(n,i)}})}b=n.createContentSection("nwywRelated",r("L_DisambigScopeList_Text"),w),n.createAnchor("#",r("L_DisambigLocationScopeFormat_Text").replace("{q}",it||rt),"relLocs",null,b),n.createAnchor(s.logoBingSearchUrl.replace("{0}",encodeURIComponent(rt)),r("L_DisambigWebsiteScopeFormat_Text").replace("{q}",it||rt),"relWebs",null,b),g=o(w),g.select(p).set_val(r("L_DisambigSearchButton_Text")).add_event("click",function(n){n.preventDefault(),o(this).remove_event("click",arguments.callee,!1),y(g)}),g.select("input.text").add_event("keydown",function(n){n.which===13&&(n.preventDefault(),n.stopPropagation(),y(g))}),g.select(".relLocs").add_event("click",function(n){n.preventDefault(),o(this).remove_event("click",arguments.callee,!1),e(null,rt,v.NWYWRelatedLoc)})}return w}function y(n){e(n.select(".what > .text").get_val(),n.select(".where > .text").get_val(),v.NWYWTwoBox)}function k(n,t){if(n&&t){var i=o(t);i.select("a").add_event("click",function(t){t.preventDefault(),o(this).remove_event("click",arguments.callee),g(n)})}}function g(n){var i=f.getResponse(),r=f.getRequest(),t=d(r,i);t&&n&&e(t.what,n.name,v.NWYWRelatedLoc)}function nt(n){for(var o=[],s=c(n),f=s&&s.AlternateSearchRegions,h=f&&f[t]||0,e,i,r,u=0;u<h;u++)if(e=f[u],i=e&&e.GeocodeLocation,i){if(i.EntityType!=ki.neighborhood&&i.EntityType!=ki.populatedPlace)continue;r={},r.name=i.DisplayName,i.Address&&(r.address=i.Address,r.name=r.address.FormattedAddress||r.name),r.type=i.EntityType,o.push(r)}return o}function e(n,t,i){var r=f&&f.getMap(),u=r&&r.getComponent(w);u&&u.search({query:n,where:t,advanced:!0,source:i,renderOptions:{task:f},additionalInfoOptions:{isStructured:!0}})}var tt=this,f=u,p=".higButton",h="et",l=new rt;l.setItemTemplate('<div><a class="disambloc" href="#">{%=highlightedName%}<\/a><\/div>',h),this.load=function(n){var u=f.getRequest(),e=f.getResponse(),t=f.panel,s,o;u&&e&&t&&(s=r(n?"L_NwywNoResults_Text":"L_NwywManual_Text"),o=b(u,d(u,e),e,s),o&&(t.clear(i.body),t.clear(i.actions),t.clear(i.footer),t.addContent(i.body,o)))}};delete window[$MapsNamespace].Maps.initSearch,a&&a.Dynamic&&a.Dynamic.done("Microsoft.Maps.Search"),a&&a.PRF.end("Module initialized","Microsoft.Maps.Search",{module:"Search"})},window[$MapsNamespace].Maps.Map&&window[$MapsNamespace].Maps.initSearch&&window[$MapsNamespace].Maps.initSearch()